<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.81.0" />

  <title>GDP Growth Chart (animated) &middot; Len Kiefer</title>

    

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="http://lenkiefer.com/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="http://lenkiefer.com/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="http://lenkiefer.com/css/blackburn.css">

  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">

  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet" type="text/css">

  
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/androidstudio.min.css">
  <script async src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="http://lenkiefer.com/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="http://lenkiefer.com/">Len Kiefer</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="http://lenkiefer.com/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="http://lenkiefer.com/post/"><i class='fa fa-list fa-fw'></i>Archive</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="http://lenkiefer.com/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/@lenkiefer" rel="me" target="_blank"><i class="fab fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/leonard-kiefer-51175331" rel="me" target="_blank"><i class="fab fa-linkedin fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/lenkiefer" rel="me" target="_blank"><i class="fab fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2021. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


       <meta name="twitter:card" content="summary">
       <meta name="twitter:image" content="http://lenkiefer.com/img/logo/logo.png" >
    
    <meta property="og:title" content="GDP Growth Chart (animated)">
    <meta property="og:description" content="R statistics dataviz quantmod">

<div class="header">
  <h1>GDP Growth Chart (animated)</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>2017/01/28</time>
  </div>

  

  

  

</div>

  


<p>IN THIS POST I WANT TO SHARE WITH YOU some code to create an animated plot of annual growth rates in U.S. Real Gross Domestic Product (GDP).</p>
<p>As in most of my posts, we’ll be creating these graphs in <a href="https://www.r-project.org/">R</a>.</p>
<div id="gdp-plot" class="section level1">
<h1>GDP Plot</h1>
<p>On Friday the U.S. Bureau of Economic Analysis (BEA) <a href="https://www.bea.gov/newsreleases/national/gdp/gdpnewsrelease.htm">released</a> the “advance” or first estimate of GDP growth for the fourth quarter of 2016. With that advance estimate we now have estimates for full-year 2016 economic growth. For more on the GDP release, check out <a href="http://www.wsj.com/articles/u-s-gdp-grew-1-9-in-fourth-quarter-1485524015">this article</a> from the Wall Street Journal that has several interesting data visualizations.</p>
<p>Per the advance release, full year 2016 GDP growth was 1.6 percent. Note these calculations are made by comparing the average of GDP for each of the four quarters in 2016 to the average of GDP for each of the four quarters of 2015. Sometimes analysts like to compare Q4/Q4 measures, which will often give you different estimated growth rates.</p>
<p>If you go to <a href="https://www.bea.gov/newsreleases/national/gdp/2017/txt/gdp4q16_adv.txt">text and full release</a> you can find estimates for full year 2014, 2015 and 2016 GDP growth in Table 1. We could also download the GDP data for all years using the BEA’s <a href="https://www.bea.gov/iTable/index_nipa.cfm">interactive tables</a>. However, for this exercise I decided to go a different route.</p>
<div id="get-the-data" class="section level2">
<h2>Get the data</h2>
<p>For this plot, I chose to use the <a href="https://cran.r-project.org/web/packages/quantmod/index.html">quantmod</a> package to get the data from the St. Louis Federal Reserve Economic Database (<a href="https://fred.stlouisfed.org/">FRED</a>).</p>
<p>Getting the data into R is very straightforward using quantmod:</p>
<pre class="r"><code>library(quantmod)
gdp = getSymbols(&#39;GDPC96&#39;,src=&#39;FRED&#39;, auto.assign=F) 
gdp.df = data.frame(date=time(gdp), coredata(gdp) )</code></pre>
<p>The quarterly Real GDP series is named <em>GDPC96</em> and using <code>getSymbols()</code> we can download the data directly from FRED. Then we turn the returned data into a data frame.</p>
<p>Next we’ll need to compute the annual average growth rates. I’m going to do it using the <a href="https://cran.r-project.org/web/packages/data.table/index.html">data.table</a> library:</p>
<pre class="r"><code>library(data.table) #load package

dt&lt;-data.table(gdp.df) #convert to data table

dt[,year:=year(date)]  # add year variable

dt.y&lt;-dt[, lapply(.SD, mean, na.rm=TRUE), by=year ]  # compute annual average

dt.y[,gdp.g:=GDPC96/shift(GDPC96,1,fill=NA)-1] #compute annual growth rate</code></pre>
<p>Let’s take a look at the GDP series and its annual growth rates:</p>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## Loading tidyverse: ggplot2
## Loading tidyverse: tibble
## Loading tidyverse: tidyr
## Loading tidyverse: readr
## Loading tidyverse: purrr
## Loading tidyverse: dplyr</code></pre>
<pre><code>## Conflicts with tidy packages ----------------------------------------------</code></pre>
<pre><code>## between():   dplyr, data.table
## filter():    dplyr, stats
## first():     dplyr, data.table, xts
## lag():       dplyr, stats
## last():      dplyr, data.table, xts
## transpose(): purrr, data.table</code></pre>
<pre class="r"><code>ggplot(data=dt.y,aes(x=date,y=GDPC96))+geom_line()+
  scale_y_log10(label=scales::comma,breaks=c(2500,5000,7500,10000,15000))+
  theme_minimal()+theme(plot.caption=element_text(hjust=0))+
  labs(x=&quot;&quot;,y=&quot;&quot;,title=&quot;Real GDP (2009 $ Billions)&quot;,
       subtitle=&quot;Annual Average, log scale&quot;,
       caption=&quot;@lenkiefer Source: U.S. Burea of Economic Analysis via St Louis Fed FRED database&quot;)</code></pre>
<p><img src="http://lenkiefer.com/post/2017-01-28-gdp-plots_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<pre class="r"><code>library(tidyverse)
ggplot(data=dt.y,aes(x=date,y=gdp.g))+geom_col()+
  scale_y_continuous(label=scales::percent)+
  theme_minimal()+theme(plot.caption=element_text(hjust=0))+
  labs(x=&quot;&quot;,y=&quot;&quot;,title=&quot;Real GDP Growth&quot;,
       subtitle=&quot;Percent Change of Annual Average&quot;,
       caption=&quot;@lenkiefer Source: U.S. Burea of Economic Analysis via St Louis Fed FRED database&quot;)</code></pre>
<pre><code>## Warning: Removed 1 rows containing missing values (position_stack).</code></pre>
<p><img src="http://lenkiefer.com/post/2017-01-28-gdp-plots_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
<div id="add-some-stylin-and-some-motion" class="section level2">
<h2>Add some stylin’ and some motion</h2>
<p>Now we’re going to add a bit of styling and some animation to make the plot.</p>
<p>For smooth animations we’ll use <a href="https://cran.r-project.org/web/packages/tweenr/index.html">tweenr</a>. See my earlier <a href="../../../../2016/05/29/improving-R-animated-gifs-with-tweenr">post about tweenr</a> for an introduction to tweenr, and more examples <a href="../../../../2016/05/30/more-tweenr-animations">here</a> and <a href="../../../../2016/06/26/week-in-review">here</a>.</p>
<pre class="r"><code>library(animation)
library(tweenr)

# function to drop observations for all years by y
myf&lt;-function(y){
  dt2&lt;-copy(dt.y)[year&gt;1979 &amp; year&lt;2017]
  dt2&lt;-dt2[year &gt; y ,gdp.g:=0]
  dt2$yearf&lt;-factor(dt2$year)
  dt2$p&lt;-factor(round(dt2$gdp.g*100,1))
  dt2$y&lt;-factor(y)
  return(as.data.frame(dt2))
}

#use tweenr
my.list2&lt;-lapply(c(2016,seq(1980,2016,1)),myf)

#my.list2&lt;-lapply(c(2016,2008,2016),myf)
tf &lt;- tween_states(my.list2, tweenlength= 2, statelength=3, 
                   ease=rep(&#39;cubic-in-out&#39;,200), nframes=240)
tf&lt;-data.table(tf)

#create animation:
oopt = ani.options(interval = 0.1)
saveGIF({for (i in 1:max(tf$.frame)) {
  g&lt;-
    ggplot(data=tf[.frame==i],
           aes(x=year,y=gdp.g,frame=year,fill=gdp.g,color=gdp.g))+
    geom_col()+
    
    geom_text(data=tf[.frame==i &amp; yearf==y,],x=2010,y=0.06,
              aes(label=paste(yearf,&quot;:&quot;,p,&quot;%&quot;)),family=&quot;Arial Black&quot;,size=14,alpha=0.75)+
    scale_color_viridis(option=&quot;D&quot;,end=0.9)+
    geom_col(data=dt.y[year&lt;2017 &amp; year&gt;1979,],alpha=0,color=NA)+
    theme_minimal()+scale_fill_viridis(option=&quot;D&quot;,end=0.9)+scale_y_continuous(label=percent)+
    labs(x=&quot;&quot;,y=&quot;&quot;,title=&quot;Real GDP percent change from a year ago&quot;,
         caption=&quot;@lenkiefer Source: U.S. Bureau of Economic Analysis&quot;)+
    theme(plot.caption=element_text(hjust=0),
          plot.title=element_text(face=&quot;bold&quot;,size=14),
          plot.subtitle=element_text(face=&quot;italic&quot;,size=12),
          legend.position=&quot;none&quot;)
  print(g)
  ani.pause()
  print(paste(i,&quot;out of&quot;,max(tf$.frame)))
}
},movie.name=&quot;GDP growth.gif&quot;,ani.width = 840, ani.height =450)</code></pre>
<p>Run that and you’ll get:</p>
<p><img src="../../../../img/charts_jan_28_2017/GDP growth.gif" ></p>
</div>
</div>

  
  <h4><i class="fas fa-share-alt" aria-hidden="true"></i>&nbsp;Share!</h4>
<ul class="share-buttons">
	<li><a href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2flenkiefer.com%2f2017%2f01%2f28%2fgdp-growth-chart-animated%2f" target="_blank" title="Share on Facebook"><i class="fab fa-facebook" aria-hidden="true"></i><span class="sr-only">Share on Facebook</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://twitter.com/intent/tweet?source=http%3a%2f%2flenkiefer.com%2f2017%2f01%2f28%2fgdp-growth-chart-animated%2f" target="_blank" title="Tweet"><i class="fab fa-twitter" aria-hidden="true"></i><span class="sr-only">Tweet</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://plus.google.com/share?url=http%3a%2f%2flenkiefer.com%2f2017%2f01%2f28%2fgdp-growth-chart-animated%2f" target="_blank" title="Share on Google+"><i class="fab fa-google-plus" aria-hidden="true"></i><span class="sr-only">Share on Google+</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.tumblr.com/share?v=3&u=http%3a%2f%2flenkiefer.com%2f2017%2f01%2f28%2fgdp-growth-chart-animated%2f" target="_blank" title="Post to Tumblr"><i class="fab fa-tumblr" aria-hidden="true"></i><span class="sr-only">Post to Tumblr</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://pinterest.com/pin/create/button/?url=http%3a%2f%2flenkiefer.com%2f2017%2f01%2f28%2fgdp-growth-chart-animated%2f" target="_blank" title="Pin it"><i class="fab fa-pinterest-p" aria-hidden="true"></i><span class="sr-only">Pin it</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.reddit.com/submit?url=http%3a%2f%2flenkiefer.com%2f2017%2f01%2f28%2fgdp-growth-chart-animated%2f" target="_blank" title="Submit to Reddit"><i class="fab fa-reddit-alien" aria-hidden="true"></i><span class="sr-only">Submit to Reddit</span></a>
	</li>
</ul>


<style>
	ul.share-buttons{
	  list-style: none;
	  padding: 0;
	}

	ul.share-buttons li{
	  display: inline;
	}

	ul.share-buttons .sr-only{
	  position: absolute;
	  clip: rect(1px 1px 1px 1px);
	  clip: rect(1px, 1px, 1px, 1px);
	  padding: 0;
	  border: 0;
	  height: 1px;
	  width: 1px;
	  overflow: hidden;
	}
</style>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="http://lenkiefer.com/2017/01/26/converting-a-tableau-dashboard-to-a-flexdashboard/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="http://lenkiefer.com/2017/01/26/converting-a-tableau-dashboard-to-a-flexdashboard/">Converting a Tableau dashboard to a Flexdashboard</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="http://lenkiefer.com/2017/01/29/fun-with-plotly/">Fun with Plotly</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="http://lenkiefer.com/2017/01/29/fun-with-plotly/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>


  
  
  
  

  

</div>

</div>
</div>
<script src="http://lenkiefer.com/js/ui.js"></script>
<script src="http://lenkiefer.com/js/menus.js"></script>




<script>
  
  if (window.location.hostname != "localhost") {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-66905937-1', 'auto');
    ga('send', 'pageview');
  }
</script>





<script src="http://lenkiefer.com/js/math-code.js"></script>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  


</body>
</html>

