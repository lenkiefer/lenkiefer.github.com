<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.52" />

  <title>House price visualizations &middot; Len Kiefer</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="/img/favicon.PNG" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="/">Len Kiefer</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/post/"><i class='fa fa-list fa-fw'></i>Archive</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/@lenkiefer" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/leonard-kiefer-51175331" target="_blank"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/lenkiefer" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2015-2018. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


       <meta name="twitter:card" content="summary">
       <meta name="twitter:image" content="http://lenkiefer.com/img/logo/logo.png" >
    
    <meta property="og:title" content="House price visualizations">
    <meta property="og:description" content="I AM JUST GOING TO DROP OFF A COUPLE OF housing data animated gifs here. And add a little bit of code for data wrangling.
In earlier posts I described how to make these using R in greater detail. We’re going to be visualizing the Freddie Mac House Price Index.
Updated geo tourWe talked about how to build something like this in our Grand Tour of House Prices post">

<div class="header">
  <h1>House price visualizations</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>2017/05/02</time>
  </div>

  

  

  

</div>

  


<p>I AM JUST GOING TO DROP OFF A COUPLE OF housing data animated gifs here. <em>And add a little bit of code for data wrangling.</em></p>
<p>In earlier posts I described how to make these using <a href="https://www.r-project.org/">R</a> in greater detail. We’re going to be visualizing the <a href="http://www.freddiemac.com/finance/house_price_index.html">Freddie Mac House Price Index</a>.</p>
<div id="updated-geo-tour" class="section level2">
<h2>Updated geo tour</h2>
<p>We talked about how to build something like this in our <a href="../../../../2017/02/20/house-price-tour">Grand Tour of House Prices post</a></p>
<p><img src="../../../../img/charts_may_02_2017/geo tween 05 02 2017.gif" ></p>
</div>
<div id="dot-chart" class="section level2">
<h2>Dot chart</h2>
<p>And for this one, you have to go way back to my <a href="../../../../2016/05/08/visual-meditations-on-house-prices-part2">Visual Meditation on House Prices Part 2</a>. <em>But I’ve updated the code for this below.</em></p>
<p><img src="../../../../img/charts_may_02_2017/geo tween 05 02 2017 dotrace.gif" ></p>
<div id="a-little-bit-of-data-manipulation" class="section level3">
<h3>A little bit of data manipulation</h3>
<p>Oh all right, I’ll post a little bit of code. Last month we <a href="../../../../2017/04/20/global-hpi-readxl">talked about</a> using <a href="http://readxl.tidyverse.org/index.html">readxl</a> to wrangle some data in Excel spreadsheets.</p>
<p>Last year <a href="../../../../2016/05/08/visual-meditations-on-house-prices-part1">we saw</a> how to manipulate data in Excel. Below, we’ll use readxl to get our data read for plotting.</p>
<p>You can download the Excel spreadsheet with state house price index values <a href="http://www.freddiemac.com/finance/fmhpi/current/excel/states.xls">here</a>. Note that this code is based on the release with data through March, 2017, future releases may shift the exact location of the cells. Using the <code>range</code> argument of readxl we can reach into the spreadsheet and get our data ready. Let’s try it:</p>
<pre class="r"><code>library(zoo,quietly=T,warn.conflicts = F)      # used for rolling window operations
library(readxl,quietly=T,warn.conflicts=F)
library(ggplot2,quietly=T,warn.conflicts=F)
library(tidyr,quietly=T,warn.conflicts=F)
library(dplyr,quietly=T,warn.conflicts=F)
library(lubridate,quietly=T,warn.conflicts=F)
library(data.table,quietly=T,warn.conflicts=F) # for the shift function
library(viridis,quietly=T,warn.conflicts=F)    # for the colors
library(scales,quietly=T,warn.conflicts=F)    # for labels
###############################################################################
#### Read in HPI data  
###############################################################################

df&lt;-read_excel(&quot;data/states.xls&quot;, 
               sheet = &quot;State Indices&quot;,  # name of sheet
               range=&quot;B6:BB513&quot; )        # range where data lives

###############################################################################
#### Set up dates from January 1975 to March 2017
###############################################################################

df$date&lt;-seq.Date(as.Date(&quot;1975-01-01&quot;),as.Date(&quot;2017-03-01&quot;),by=&quot;1 month&quot;)
df.state&lt;-df %&gt;% gather(geo,hpi,-date) %&gt;% mutate(type=&quot;state&quot;)</code></pre>
<p>Now that our data is loaded we can do some manipulations</p>
<pre class="r"><code>###############################################################################
#### Transform data
#### Needs library zoo for the rolling window operations
###############################################################################
df.state&lt;-
  df.state %&gt;% group_by(geo) %&gt;% 
  mutate(hpa=hpi/shift(hpi,12)-1,
         hpilag12=shift(hpi,12,fill=NA),
         hpimax12=zoo::rollmax(hpi,13,align=&quot;right&quot;,fill=NA),
         hpimin12=-zoo::rollmax(-hpi,13,align=&quot;right&quot;,fill=NA)) %&gt;% ungroup()

# Get a list of dates
dlist&lt;-unique(filter(df.state,year(date)&gt;1999)$date)

###############################################################################
#### Plotting function
###############################################################################
myplot1 &lt;- function (i) {
  g&lt;-
    ggplot(data=filter(df.state,date==dlist[i] &amp; 
                         !(geo %in% 
                         c(&quot;United States not seasonally adjusted&quot;,
                            &quot;United States seasonally adjusted&quot; ))),
         aes(x=hpi, y=geo, label=paste(&quot; &quot;,geo,&quot;&quot;),
             color=hpa,hjust=ifelse(hpa&gt;0,0,1)))+
    geom_text() +
    geom_point()+
    scale_x_log10(limits=c(70,352), breaks=c(75,100,125,150,200,250,350))+
    geom_segment(aes(xend=hpimin12,x=hpimax12,y=geo,yend=geo),alpha=0.7)+
    theme_minimal()  +
    theme(legend.position=&quot;bottom&quot;,
          axis.text.y=element_blank(),
          legend.key.width=unit(4,&quot;line&quot;),
          panel.grid.major.y=element_blank(),
          plot.caption=element_text(hjust=0),
          plot.title=element_text(face=&quot;bold&quot;,size=18))+
    scale_color_viridis(end=0.85,option=&quot;C&quot;,limits=c(-.4,.4),
                        name=&quot;12-month % change     \nin house price index     \n&quot;,
                        label=percent)+
    labs(y=&quot;&quot;, x=&quot;House price index (log scale, Dec 2000 =100, NSA)&quot;,
       title=&quot;State house price dynamics&quot;,
       subtitle=as.character(dlist[i],format=&quot;%B, %Y&quot;),
       caption=&quot;@lenkiefer Source: Freddie Mac house price index, each dot a state, lines trailing 12-month min-max&quot;)
  return(g)
  }

N&lt;-length(dlist)  #get number of observations in filtered data
myplot1(N)</code></pre>
<p><img src="/post/2017-05-02-house-price-viz_files/figure-html/05-02-2017-readxl-plot1-1.png" width="672" /></p>
</div>
<div id="add-animation" class="section level3">
<h3>Add animation</h3>
<p>With our function, we can easily add some animation and create gif.</p>
<pre class="r"><code>oopt = ani.options(interval = 0.15)
saveGIF({for (i in seq(3,N,1)) {
  g&lt;-myplot1(i)
  print(g)
  print(paste(i,&quot;out of&quot;,N))
  ani.pause()}
  for (i in 1:5)
  {print(g)
    print(i)}
},movie.name=&quot;geo tween 05 02 2017 dotrace.gif&quot;,ani.width = 550, ani.height = 550)</code></pre>
</div>
</div>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="/2017/04/26/housing-data-uncertainty/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="/2017/04/26/housing-data-uncertainty/">Visualizing uncertainty in housing data</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="/2017/05/03/house-price-emp-trends/">House price growth and employment trends</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="/2017/05/03/house-price-emp-trends/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  

</div>
<footer class="post-footer clearfix">
    

    <div class="share">
        
            <a class="icon-twitter" href="https://twitter.com/share?url=http://lenkiefer.com%2f2017%2f05%2f02%2fhouse-price-viz%2f&text=House%20price%20visualizations via %40lenkiefer"
                onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fa fa-twitter"></i>
                <span class="hidden">Twitter</span>
            </a>
        

        
            <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://lenkiefer.com%2f2017%2f05%2f02%2fhouse-price-viz%2f"
                onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                <i class="fa fa-facebook"></i>
                <span class="hidden">Facebook</span>
            </a>
        


        
    </div>
</footer>
</div>
</div>
<script src="/js/ui.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66905937-1', 'auto');
  ga('send', 'pageview');

</script>






</body>
</html>

