<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.27.1" />

  <title>Consumer prices, household debt &middot; Len Kiefer</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="/img/favicon.PNG" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="/">Len Kiefer</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/post/"><i class='fa fa-list fa-fw'></i>Archive</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/@lenkiefer" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/leonard-kiefer-51175331" target="_blank"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/lenkiefer" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2015-2018. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


       <meta name="twitter:card" content="summary">
       <meta name="twitter:image" content="http://lenkiefer.com/img/logo/logo.png" >
    
    <meta property="og:title" content="Consumer prices, household debt">
    <meta property="og:description" content="LET’S TAKE A LOOK AT RECENT TRENDS IN CONSUMER PRICES AND HOUSEHOLD DEBT. Along the way we’ll refresh some visualizations of consumer prices (see here) and household debt (see here) we made last year, as well as think up some new ones.
As usual we’ll use R to generate the plots and I’ll share the code below. But before we get into the details of constructing the charts, let’s just look at two plots to help set the stage.">

<div class="header">
  <h1>Consumer prices, household debt</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>2017/05/21</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="/tags/r">R</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/dataviz">dataviz</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/economy">economy</a>
    
  </div>
  
  

</div>

  <p>LET’S TAKE A LOOK AT RECENT TRENDS IN CONSUMER PRICES AND HOUSEHOLD DEBT. Along the way we’ll refresh some visualizations of consumer prices (see <a href="../../../../2016/11/21/consumer-price-viz">here</a>) and household debt (see <a href="../../../../2016/08/09/trends-in-credit">here</a>) we made last year, as well as think up some new ones.</p>
<p>As usual we’ll use <a href="https://www.r-project.org/">R</a> to generate the plots and I’ll share the code below. But before we get into the details of constructing the charts, let’s just look at two plots to help set the stage.</p>
<div id="two-possibly-related-charts" class="section level2">
<h2>Two possibly related charts</h2>
<p>First, let’s examine trends in U.S. consumer prices since the year 2000. We’ll get into the data details later, but these data are from the U.S. Bureau of Labor Statistics <a href="https://www.bls.gov/">BLS.gov</a>. The Consumer Price Index (CPI) <a href="https://www.bls.gov/cpi/">LINK</a> tracks “changes in the prices paid by urban consumers for a representative basket of goods and services”.</p>
<p>The BLS provides very detailed measures (<a href="https://www.bls.gov/opub/hom/pdf/homch17.pdf">it’s 5 o’clock somewhere so feel free to read</a>) down to individual price categories. They also aggregate into various aggregate categories.</p>
<p>Let’s look at a few of them:</p>
<p><img src="/post/2017-05-21-consumer-price-household-debt_files/figure-html/05-21-2017-plot-1-1.png" width="672" /></p>
<p>These data are normalized so that January 2000 is equal to 100. The trend lines compare how the seasonally-adjusted price indices have evolved since then. In case you didn’t notice, I’ve made the education line thicker to call attention to it. From January 2000 to April 2017 (latest data available) the CPI for all items was up 44 percent (144 in the chart) vs 129 percent (229 in the chart) for the education index.</p>
<p>There are important niceties <a href="https://www.bls.gov/cpi/cpifacct.htm">see again the BLS</a> about how the index is constructed and what it really measures. The important point is education costs are up a lot more than overall prices since 2000.</p>
<p>On a possibly related note, consider this chart showing household debt trends using data from the New York Federal Reserve Bank/Equifax’s consumer credit panel <a href="https://www.newyorkfed.org/microeconomics/databank.html">LINK</a>.</p>
<p><img src="/post/2017-05-21-consumer-price-household-debt_files/figure-html/05-21-2017-plot-2-1.png" width="672" /></p>
<p>Got it? Price up, debt up. Let’s start building some more visualizations of these data and explore these trends in more detail.</p>
</div>
<div id="step-1-get-the-data" class="section level1">
<h1>Step 1: get the data</h1>
<p>The data for these plots are conveniently made available by the BLS and the New York Fed.</p>
<p>A quick note on data manipulation. I have been cycling between using a <a href="https://cran.r-project.org/web/packages/data.table/index.html">data.table</a> based approach for data wrangling and a <a href="https://cran.r-project.org/web/packages/dplyr/index.html">dplyr</a>/<a href="http://tidyverse.org/">tidyverse</a> based approach. Both seem to work. For the CPI data I’ll mostly use data.table and for the household debt data I’ll mostly use dplyr.</p>
<div id="consumer-price-data" class="section level2">
<h2>Consumer price data</h2>
<p>First, we’ll follow my <a href="../../../../2016/11/21/consumer-price-viz">CPI post</a> to get the Consumer Price data.</p>
<pre class="r"><code>###############################################################################
#### Load libraries
###############################################################################
library(data.table,quietly=T,warn.conflicts=F)
library(tidyverse,quietly=T,warn.conflicts=F)

###############################################################################
#### Read in data from BLS
#### See: for readme https://download.bls.gov/pub/time.series/cu/cu.txt
###############################################################################

# get data
cpi1&lt;-fread(&#39;http://download.bls.gov/pub/time.series/cu/cu.data.2.Summaries&#39;)

# Get item names
cpi.item&lt;-fread(&quot;http://download.bls.gov/pub/time.series/cu/cu.item&quot;,
                header=FALSE,col.names=c(&quot;item.code&quot;,&quot;item.name&quot;,&quot;display.level&quot;,
                                         &quot;selectable&quot;,&quot;sort.sequence&quot;,&quot;blank&quot;))
# get series info
cpi.series&lt;-fread(&quot;http://download.bls.gov/pub/time.series/cu/cu.series&quot;,
                  col.names=c(&quot;series_id&quot;,&quot;area_code&quot;,&quot;item_code&quot;,&quot;seasonal&quot;,
                              &quot;periodicity_code&quot;,&quot;base_code&quot;,&quot;base_period&quot;,
                            &quot;footnote_codes&quot;,&quot;begin_year&quot;,&quot;begin_period&quot;,
                            &quot;end_year&quot;,&quot;end_period&quot;,&quot;blank&quot;),header=F)
# merge
cpi2&lt;-merge(cpi.item,cpi.series,by.x=&quot;item.code&quot;,by.y=&quot;item_code&quot;)

setkeyv(cpi1,&quot;series_id&quot;)            
setkeyv(cpi2,&quot;series_id&quot;)
cpi3&lt;-cpi2[cpi1]
# create date
cpi3&lt;-cpi3[,month:=as.numeric(substr(cpi3$period,2,3))]
cpi3$date&lt;- as.Date(ISOdate(cpi3$year,cpi3$month,1) )

# subset data
cpi4&lt;-cpi3[area_code==&quot;0000&quot; &amp; seasonal==&quot;S&quot; &amp; item.code!= &quot;SAA1&quot; &amp; item.code !=&quot;SAA2&quot;]
# get January 2000 data 
bdata&lt;-cpi4[year==2000 &amp; month==1,]
bdata&lt;-dplyr::rename(bdata, value00=value)
bdata&lt;-bdata[, c(&#39;value00&#39;,&#39;series_id&#39;), with = FALSE]
cpi5&lt;-merge(cpi4,bdata,by=&quot;series_id&quot;)

# reindex data so that 2000 = 100
cpi5&lt;-cpi5[,cpi00:=100*value/value00]
cpi6&lt;-cpi5[year&gt;1999]
xlim&lt;-c(min(cpi6$date),max(cpi6$date))
dd&lt;-unique(cpi6$date)


# Originally, had Education combined with communication (as BLS reports it)
# let&#39;s just get education
# Series id: CUSR0000SAE1

  cpi.ed&lt;-fread(&quot;http://download.bls.gov/pub/time.series/cu/cu.data.17.USEducationAndCommunication&quot;)
  cpi.ed[,month:=as.numeric(substr(cpi.ed$period,2,3))]
  cpi.ed$date&lt;- as.Date(ISOdate(cpi.ed$year,cpi.ed$month,1) )
  cpi.ed$item.name&lt;-&quot;Education&quot;
  cpi.ed&lt;-cpi.ed[series_id==&quot;CUSR0000SAE1&quot;]
  bdata.ed&lt;-cpi.ed[year==2000 &amp; month==1,]
  bdata.ed&lt;-dplyr::rename(bdata.ed, value00=value)
  bdata.ed&lt;-bdata.ed[, c(&#39;value00&#39;,&#39;series_id&#39;), with = FALSE]
  cpi.ed&lt;-merge(cpi.ed,bdata.ed,by=&quot;series_id&quot;)
  cpi.ed[,cpi00:=100*value/value00]</code></pre>
</div>
<div id="household-debt-data" class="section level2">
<h2>Household debt data</h2>
<p>The household debt data is available in an Excel spreadsheet. We’ll have to use <em>readxl</em> (see this <a href="../../../../2017/04/20/global-hpi-readxl">post for more on wrangling Excel data with R</a>). Let’s start by assuming that you have downloaded the latest credit panel summary data (available here <a href="https://www.newyorkfed.org/medialibrary/interactives/householdcredit/data/xls/HHD_C_Report_2017Q1.xlsx">.xlsx file</a>) and saved it as <em>HHD_C_Report_2017Q1.xlsx</em> in a data directory.</p>
<p>Now in order to get this data useable, we have to use <em>readxl</em> to reach into the files and extract the useful information. I had originally been doing some manual manipulation in Excel, but <em>ewww gross</em>, let’s try to do it all with R.</p>
<p>It’s going to involve understanding the structure of the Excel file and using some of <a href="https://cran.r-project.org/web/packages/readxl/index.html">readxl</a>’s nice <a href="https://blog.rstudio.org/2017/04/19/readxl-1-0-0/">features</a>.</p>
<p>This spreadsheet is-sigh-well, set up like spreadsheets are wont to be. The data we want is in the “Page 3 Data” sheet, organized with variables in rows and data in columns. The row titles we want are not contiguous with the data (there’s a gap of a couple columns). We’ll have to import the data and try to beat it into tidy submission so we can actually work with it.</p>
<pre class="r"><code># We&#39;ll use the tidyverse here
library(readxl,quietly=T,warn.conflicts=F)
library(tidyr,quietly=T,warn.conflicts=F)
library(dplyr,quietly=T,warn.conflicts=F)
library(purrr,quietly=T,warn.conflicts=F)

# data is range D4: BH10, we&#39;ll get the data values from row 3
# the row titles are in column A, so we&#39;ll get it and then delete blanks

df&lt;-read_excel(&quot;data/HHD_C_Report_2017Q1.xlsx&quot;, 
               sheet = &quot;Page 3 Data&quot;,  # name of sheet
               range=&quot;A3:BH10&quot; )        # range where data lives

## we&#39;ve got blank columns in positions 2 &amp; 3 (drop them)
## then we&#39;ll gather the data and rename X__1 as &quot;type&quot;

df2&lt;-df %&gt;% select(-X__2,-X__3) %&gt;% gather(datec,debt,c(2:58)) %&gt;% rename(type=X__1)

#now create a date variable using the datec string:

df2&lt;- df2 %&gt;% 
  mutate(year=2000+as.numeric(substr(datec,1,2)),
         month=as.numeric(substr(datec,5,5))*3) %&gt;%
  # create date variable
  mutate(date=as.Date(ISOdate(year,month,1))) %&gt;% 
  # drop unneeede variables
  select(type,date,debt)</code></pre>
<p>Hey, not so bad. Let’s make a table looking at the last quarter of data (2017 Q1).</p>
<pre class="r"><code># Make a table for 2017 Q1:

htmlTable(
  df2 %&gt;% filter(date==&quot;2017-03-01&quot;) %&gt;%
    arrange(-debt) %&gt;%
    map_if(is.numeric,scales::dollar) %&gt;% as.data.frame(),
  col.rgroup = c(&quot;none&quot;, &quot;#F7F7F7&quot;),
  caption=&quot;Aggregate Household Debt ($ Trillions, 2017 Q1)&quot;,
  tfoot=&quot;Source: FRBNY Consumer Credit Panel/Equifax&quot;)</code></pre>
<table class='gmisc_table' style='border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;' >
<thead>
<tr><td colspan='4' style='text-align: left;'>
Aggregate Household Debt ($ Trillions, 2017 Q1)</td></tr>
<tr>
<th style='border-bottom: 1px solid grey; border-top: 2px solid grey;'> </th>
<th style='border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;'>type</th>
<th style='border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;'>date</th>
<th style='border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;'>debt</th>
</tr>
</thead>
<tbody>
<tr>
<td style='text-align: left;'>1</td>
<td style='text-align: center;'>Total</td>
<td style='text-align: center;'>2017-03-01</td>
<td style='text-align: center;'>$12.72</td>
</tr>
<tr style='background-color: #f7f7f7;'>
<td style='background-color: #f7f7f7; text-align: left;'>2</td>
<td style='background-color: #f7f7f7; text-align: center;'>Mortgage</td>
<td style='background-color: #f7f7f7; text-align: center;'>2017-03-01</td>
<td style='background-color: #f7f7f7; text-align: center;'>$8.63</td>
</tr>
<tr>
<td style='text-align: left;'>3</td>
<td style='text-align: center;'>Student Loan</td>
<td style='text-align: center;'>2017-03-01</td>
<td style='text-align: center;'>$1.34</td>
</tr>
<tr style='background-color: #f7f7f7;'>
<td style='background-color: #f7f7f7; text-align: left;'>4</td>
<td style='background-color: #f7f7f7; text-align: center;'>Auto Loan</td>
<td style='background-color: #f7f7f7; text-align: center;'>2017-03-01</td>
<td style='background-color: #f7f7f7; text-align: center;'>$1.17</td>
</tr>
<tr>
<td style='text-align: left;'>5</td>
<td style='text-align: center;'>Credit Card</td>
<td style='text-align: center;'>2017-03-01</td>
<td style='text-align: center;'>$0.76</td>
</tr>
<tr style='background-color: #f7f7f7;'>
<td style='background-color: #f7f7f7; text-align: left;'>6</td>
<td style='background-color: #f7f7f7; text-align: center;'>HE Revolving</td>
<td style='background-color: #f7f7f7; text-align: center;'>2017-03-01</td>
<td style='background-color: #f7f7f7; text-align: center;'>$0.46</td>
</tr>
<tr>
<td style='border-bottom: 2px solid grey; text-align: left;'>7</td>
<td style='border-bottom: 2px solid grey; text-align: center;'>Other</td>
<td style='border-bottom: 2px solid grey; text-align: center;'>2017-03-01</td>
<td style='border-bottom: 2px solid grey; text-align: center;'>$0.37</td>
</tr>
</tbody>
<tfoot><tr><td colspan='4'>
Source: FRBNY Consumer Credit Panel/Equifax</td></tr></tfoot>
</table>
</div>
</div>
<div id="step-2-make-some-awesome-charts" class="section level1">
<h1>Step 2: make some awesome charts</h1>
<p>Now that we’ve got our data, we can start making some awesome charts. Or maybe I should say continue making awesome charts, because we never really stop do we?</p>
<p>Let’s get to it.</p>
<div id="venerable-line-charts" class="section level2">
<h2>Venerable line charts</h2>
<p>We’ll get crazy I promise but let’s start simple with the venerable line chart. The code below will recreate the plots we started with.</p>
<div id="cpi-line-chart" class="section level3">
<h3>CPI line chart</h3>
<pre class="r"><code>library(ggrepel,quietly=T,warn.conflicts=F) # for the labels (avoid overplotting)


# dd is a list of dates, we&#39;ll set i = max date for labels
xlim&lt;-c(min(cpi6$date),max(cpi6$date))
dd&lt;-unique(cpi6$date)
i&lt;- length(dd)

ggplot(data=cpi6[ 
  #drop some items for clarity
  ! (item.name %in% c(&quot;Other goods and services&quot;,&quot;Services&quot;,
                      &quot;Education and communication&quot;))],
  aes(x=date,y=cpi00,color=item.name))+
  geom_line()+
  theme_minimal()+   theme(legend.justification=c(0,0), legend.position=&quot;none&quot;)+
  scale_y_log10(limits=c(90,250),breaks=c(90,100,120,140,160,180,200,250))+
  geom_line(data=cpi.ed[ year&gt;1999],size=1.5,color=&quot;red&quot;)+
  scale_x_date(labels= date_format(&quot;%b-%Y&quot;),
               limits = as.Date(c(&#39;2000-01-01&#39;,&#39;2018-12-31&#39;)))+
  geom_text_repel(
    data = cpi6[date==dd[i] &amp; 
                  ! (item.name %in% c(&quot;Other goods and services&quot;,&quot;Services&quot;,
                                      &quot;Education and communication&quot;))],
    aes(label = item.name), size = 3.5, nudge_x = 1) +
  geom_text(
    data = cpi.ed[date==dd[i]],color=&quot;red&quot;,
    aes(label = item.name),
    size = 3.5,nudge_x = 1,nudge_y=.01) +
  labs(x=&quot;&quot;, y=&quot;Consumer Price Index (log scale, Jan 2000=100, SA)&quot;,
       title=&quot;Consumer Prices&quot;,
       subtitle=&quot;by major category&quot;,
       caption=&quot;@lenkiefer Source: U.S. Bureau of Labor Statistics&quot;)+
  theme(plot.title=element_text(size=18),
        plot.caption=element_text(hjust=0,vjust=1),
        plot.margin=unit(c(0.25,0.25,0.25,0.25),&quot;cm&quot;))</code></pre>
<p><img src="/post/2017-05-21-consumer-price-household-debt_files/figure-html/05-21-2017-plot-1-display-1.png" width="672" /></p>
</div>
<div id="household-debt-line-chart" class="section level3">
<h3>Household debt line chart</h3>
<pre class="r"><code>ggplot(data=filter(df2,type!=&quot;Total&quot; &amp; type !=&quot;Mortgage&quot;),
       aes(x=date,y=debt,color=type,label=type))+
  geom_line(size=1.2)+theme_minimal()+
  geom_text(data=tail(filter(df2,type!=&quot;Total&quot; &amp; type !=&quot;Mortgage&quot;),5),
            nudge_x=10,nudge_y=.025)+
  coord_cartesian(xlim=c(as.Date(&quot;2003-01-01&quot;),as.Date(&quot;2017-12-31&quot;)), y=c(0,1.5))+
  theme(plot.title=element_text(size=14),
        plot.caption=element_text(hjust=0,vjust=1),
        legend.position=&quot;none&quot;)+
  labs(title=&quot;Household debt&quot;,subtitle=&quot;Trillions of dollars&quot;,x=&quot;&quot;,y=&quot;&quot;,
       caption=&quot;@lenkiefer Source: FRBNY Consumer Credit Panel/Equifax&quot;)</code></pre>
<p><img src="/post/2017-05-21-consumer-price-household-debt_files/figure-html/05-21-2017-plot-2-display-1.png" width="672" /></p>
</div>
<div id="inflation-line-chart" class="section level3">
<h3>Inflation line chart</h3>
<p>The CPI line chart compares price changes over a long horizon. Let’s focus on more recent changes. The code below generates a plot of monthly price inflation by category.</p>
<pre class="r"><code># stack education with full data
cpi7&lt;-rbind(cpi6,cpi.ed,fill=T)

# construct monthly inflation metrics
cpi7 &lt;- cpi7[order(series_id,date),]
cpi7&lt;-cpi7[, cpi.inf:= value/shift(value,1,fill=NA)-1, by=series_id]

# plot data
ggplot(data=cpi7[ 
  #drop some items for clarity
  ! (item.name %in% c(&quot;Other goods and services&quot;,&quot;Services&quot;,
                      &quot;Education and communication&quot;))],
  aes(x=date,y=cpi.inf,color=item.name))+
  geom_line()+
  geom_hline(yintercept=0,linetype=2,color=&quot;darkgray&quot;)+
  scale_y_continuous(label=scales::percent)+
  theme_minimal()+   theme(legend.justification=c(0,0), legend.position=&quot;none&quot;)+
  scale_x_date(labels= date_format(&quot;%Y&quot;),
               limits = as.Date(c(&#39;2000-01-01&#39;,&#39;2017-12-31&#39;)))+
  geom_text_repel(
    data = cpi7[date==dd[i] &amp; 
                  ! (item.name %in% c(&quot;Other goods and services&quot;,&quot;Services&quot;,
                                      &quot;Education and communication&quot;))],
    aes(label = item.name), size = 3.5, nudge_x = 1) +
  labs(x=&quot;&quot;, y=&quot;Consumer Price Inflation (Monthly % change, SA)&quot;,
       title=&quot;Consumer Price Inflation (m/m %)&quot;,
       subtitle=&quot;by major category&quot;,
       caption=&quot;@lenkiefer Source: U.S. Bureau of Labor Statistics&quot;)+
  theme(plot.title=element_text(size=18),
        plot.caption=element_text(hjust=0,vjust=1),
        plot.margin=unit(c(0.25,0.25,0.25,0.25),&quot;cm&quot;))</code></pre>
<p><img src="/post/2017-05-21-consumer-price-household-debt_files/figure-html/05-21-2017-plot-3-inflation-1.png" width="672" /></p>
<p>Wow, that’s pretty ugly, transportation is volatile and it’s hard to see what’s going on in the plot. Let’s use faceting to make a small multiple (also, let’s drop volatile transportation/commodities and recreation so we have 6 categories). Let’s also zoom in on trends since 2010.</p>
<pre class="r"><code># plot data
ggplot(data=cpi7[ 
  #drop some items for clarity
  ! (item.name %in% c(&quot;Other goods and services&quot;,&quot;Services&quot;,
                      &quot;Education and communication&quot;, &quot;Transportation&quot;,
                      &quot;Commodities&quot;,&quot;Recreation&quot;))],
  aes(x=date,y=cpi.inf,color=item.name))+
  geom_line()+
  geom_hline(yintercept=0,linetype=2,color=&quot;darkgray&quot;)+
  scale_y_continuous(label=scales::percent)+
  theme_minimal()+   theme(legend.justification=c(0,0), legend.position=&quot;none&quot;)+
  scale_x_date(labels= date_format(&quot;%Y&quot;),
               limits = as.Date(c(&#39;2010-01-01&#39;,&#39;2017-12-31&#39;)))+
  facet_wrap(~item.name)+
  labs(x=&quot;&quot;, y=&quot;Consumer Price Inflation (monthly % change, SA)&quot;,
       title=&quot;Consumer Price Inflation (m/m %)&quot;,
       subtitle=&quot;by major category&quot;,
       caption=&quot;@lenkiefer Source: U.S. Bureau of Labor Statistics&quot;)+
  theme(plot.title=element_text(size=18),
        plot.caption=element_text(hjust=0,vjust=1),
        plot.margin=unit(c(0.25,0.25,0.25,0.25),&quot;cm&quot;))</code></pre>
<p><img src="/post/2017-05-21-consumer-price-household-debt_files/figure-html/05-21-2017-plot-3-inflation-v2-1.png" width="672" /></p>
<p>Getting better. Still quite a bit of noise in some of the monthly measures. Let’s try looking at year-over-year percent changes to smooth out some of that noise.</p>
<pre class="r"><code># get 12 month inflation
cpi7&lt;-cpi7[, cpi.inf12:= value/shift(value,12,fill=NA)-1, by=series_id]

# plot data
ggplot(data=cpi7[ 
  #drop some items for clarity
  ! (item.name %in% c(&quot;Other goods and services&quot;,&quot;Services&quot;,
                      &quot;Education and communication&quot;, &quot;Transportation&quot;,
                      &quot;Commodities&quot;,&quot;Recreation&quot;))],
  aes(x=date,y=cpi.inf12,color=item.name))+
  geom_line()+
  geom_hline(yintercept=0,linetype=2,color=&quot;darkgray&quot;)+
  scale_y_continuous(label=scales::percent)+
  theme_minimal()+   theme(legend.justification=c(0,0), legend.position=&quot;none&quot;)+
  scale_x_date(labels= date_format(&quot;%Y&quot;),
               limits = as.Date(c(&#39;2010-01-01&#39;,&#39;2017-12-31&#39;)))+
  facet_wrap(~item.name)+
  labs(x=&quot;&quot;, y=&quot;Consumer Price Inflation (12-month % change, SA)&quot;,
       title=&quot;Consumer Price Inflation (y/y %)&quot;,
       subtitle=&quot;by major category&quot;,
       caption=&quot;@lenkiefer Source: U.S. Bureau of Labor Statistics&quot;)+
  theme(plot.title=element_text(size=18),
        plot.caption=element_text(hjust=0,vjust=1),
        plot.margin=unit(c(0.25,0.25,0.25,0.25),&quot;cm&quot;))</code></pre>
<p><img src="/post/2017-05-21-consumer-price-household-debt_files/figure-html/05-21-2017-plot-3-inflation-v3-1.png" width="672" /></p>
<p>Now we have a clearer picture of recent trends. Overall inflation has been rising over the past year or so (thanks largely to recovering energy prices). Both Medical Care and Education are rising at a level well above general inflation, but seem to be trending down. Housing, which measures rents and owner’s equivalent rent not house prices (see for example <a href="https://www.bls.gov/cpi/cpiqa.htm">question 2 here</a>), is on the upswing.</p>
</div>
</div>
<div id="horizon-charts" class="section level2">
<h2>Horizon charts</h2>
<p>Let’s build some horizon charts (see my <a href="../../../../2017/04/23/horizon">horizon chart post</a> for everything you want, everything you need) to analyze inflation trends. Making horizon charts was only possible due to code from <span class="citation">[@timelyportfolio]</span>(<a href="https://twitter.com/timelyportfolio" class="uri">https://twitter.com/timelyportfolio</a>), lots of cool stuff over at <a href="http://www.buildingwidgets.com/">his page</a>.</p>
<pre class="r"><code># subset data
df.cpi&lt;-cpi7[ year(date)&gt;2009 &amp;  ! 
                (item.name %in% c(&quot;Other goods and services&quot;,
                                  &quot;Services&quot;,&quot;Education and communication&quot;,
                                  &quot;Transportation&quot;,&quot;Recreation&quot;)), c(&quot;date&quot;,&quot;item.name&quot;,&quot;cpi.inf12&quot;),
  with=F]
############# magic! ##############################################################

library(htmltools)
library(DT)
library(d3horizonR)


myf3&lt;-function (s=&quot;Ohio&quot;){
  d.out&lt;- filter(df.cpi,item.name==s)$cpi.inf12
  return(d.out)
}
dt3 &lt;- data.frame(item.name=unique(df.cpi$item.name))

dt4 &lt;- dt3 %&gt;%
  mutate(x = lapply(item.name, myf3 ) )  %&gt;%
  mutate(x = lapply(x, function(dat) {
    d3horizon_chr(
      list(dat),
      options = d3horizonOptions(height=20),
      width = 400
    )
  }) )

m&lt;-
datatable(
  dt4,
    caption = &#39;Annual growth in consumer prices&#39;,
  escape = FALSE,
  colnames=c(&quot;Item&quot;,&quot;12-month % change\n in prices&quot;),
  options = list(
    columnDefs = list(list(width=&quot;400px&quot;, targets = 2:2)),
    fnDrawCallback = htmlwidgets::JS()
  )
) %&gt;%
  tagList(htmlwidgets::getDependency(&quot;d3horizon&quot;, &quot;d3horizonR&quot;)) %&gt;%
  browsable()

# save m
library(htmlwidgets)
saveWidget(m, file=&quot;m.html&quot;)</code></pre>
<iframe src="../../../../img/charts_may_21_2017/horizon DT cpi.html" height="400" width="1050">
</iframe>
<p>These widgets are cool, but I’m not doing much with them here. We’ll do more later.</p>
</div>
<div id="lollipops" class="section level2">
<h2>Lollipops</h2>
<p>Lollipop charts have been <a href="http://www.perceptualedge.com/blog/?p=2642">under fire</a> recently, but I still like them. See <a href="http://gravyanecdote.com/visual-analytics/lollipop-charts-revisited/">here</a> for a more spirited defense of the chart type from <a href="https://twitter.com/acotgreave">Andy Cotgreave</a>.</p>
<p>We’ll just go ahead and make one. If you don’t like them, the nice thing about <a href="http://ggplot2.tidyverse.org/">ggplot2</a> is it’s pretty easy to just swap in a bar.</p>
<p>Let’s make one.</p>
<pre class="r"><code>library(viridis) # for the colors!
ggplot(data=cpi7[date==dd[i] &amp; item.name != &quot;Education and communication&quot;,],
       aes(xend=100,x=cpi00,
           yend=reorder(item.name,cpi00),y=reorder(item.name,cpi00),
           color=cpi00,
           label=paste(&quot; &quot;,item.name,&quot; &quot;)))+
    geom_segment(size=0.25,linetype=2)+geom_point(size=3)+
  scale_x_log10(limits=c(75,250),breaks=seq(100,250,25))+
  theme_minimal()+
  geom_text(aes(hjust=ifelse(cpi00&gt;100,0,1)))+
  scale_color_viridis(name=&quot;Price Index&quot;,option=&quot;C&quot;,end=0.85)+
  labs(y=&quot;&quot;, x=&quot;Consumer Price Index (log scale, Jan 2000=100, SA)&quot;,
       title=&quot;Consumer Prices&quot;,
       subtitle=paste(&quot;by major category through&quot;,as.character(dd[i],format=&quot;%b-%Y&quot;)),
       caption=&quot;@lenkiefer Source: U.S. Bureau of Labor Statistics&quot;)+
  theme(plot.title=element_text(size=18),
        legend.position=&quot;none&quot;,
        axis.text.y=element_blank(),
        panel.grid.major.y=element_blank(),
        panel.grid.minor.y=element_blank(),
        plot.caption=element_text(hjust=0))</code></pre>
<p><img src="/post/2017-05-21-consumer-price-household-debt_files/figure-html/05-21-2017-plot-lolly-1-1.png" width="672" /></p>
<p>This plot compares how much prices have risen relative to 2000. Essentially, this is just the endpoint of the line plot.</p>
</div>
<div id="state-debt-trends" class="section level2">
<h2>State debt trends</h2>
<p>Let’s move over to the household debt data and look at state debt trends. In the same data file (different) worksheet we got from the New York Fed we can get a time series of per capita debt levels for the U.S. and some large states.</p>
<pre class="r"><code># data is range A3: BH10, we&#39;ll get the date values from row 3
# the row titles are in column A

df.state&lt;-read_excel(&quot;data/HHD_C_Report_2017Q1.xlsx&quot;, 
               sheet = &quot;Page 20 Data&quot;,  # name of sheet
               range=&quot;A3:BF15&quot; )        # range where data lives

## we&#39;ve got blank columns in positions 2 &amp; 3 (drop them)
## then we&#39;ll gather the data and rename X__1 as &quot;state&quot;

df.state2&lt;-df.state %&gt;% gather(datec,pcdebt,c(2:58)) %&gt;% rename(state=X__1)

#now create a date variable using the datec string:

df.state2&lt;- df.state2 %&gt;% 
  mutate(year=2000+as.numeric(substr(datec,1,2)),
         month=as.numeric(substr(datec,5,5))*3) %&gt;%
  # create date variable
  mutate(date=as.Date(ISOdate(year,month,1))) %&gt;% 
  # drop unneeede variables
  select(state,date,pcdebt)

#plot debt balance per capita

ggplot(data=df.state2,aes(x=date,y=pcdebt,color=state,
                          label=round(pcdebt,0)))+geom_line(size=1.2)+theme_minimal()+
  geom_text_repel(data=filter(df.state2,date==&quot;2017-03-01&quot;),
                  nudge_x=10,nudge_y=.025)+
    facet_wrap(~state,ncol=3)  + 
  scale_y_log10(limits=c(20,90),breaks=seq(25,90,15))+
    theme(plot.title=element_text(size=14))+theme(plot.caption=element_text(hjust=0,vjust=1,margin=margin(t=10)))+
    theme(plot.margin=unit(c(0.25,0.25,0.25,0.25),&quot;cm&quot;))+
      coord_cartesian(xlim=c(as.Date(&quot;2003-01-01&quot;),as.Date(&quot;2017-12-31&quot;)))+
    theme(legend.position=&quot;none&quot;)+
    labs(title=&quot;Per capita household debt&quot;,
         subtitle=&quot;Thousands of dollars, (Based on the population with a credit report) &quot;,
         x=&quot;&quot;,y=&quot;per capita debt (Ths $, log scale)&quot;,caption=&quot;@lenkiefer Source: FRBNY Consumer Credit Panel/Equifax&quot;)</code></pre>
<p><img src="/post/2017-05-21-consumer-price-household-debt_files/figure-html/05-21-2017-data-3-state-1.png" width="672" /></p>
<p>Debt levels are starting to rise, but remain (on a per capita basis) below pre-Great Recession levels.</p>
<div id="state-delinquency-trends" class="section level3">
<h3>State delinquency trends</h3>
<p>Let’s look at consumer delinquency trends by state. These data are in another worksheet in the same spreadsheet. Our mastery of a couple <em>readxl</em> tricks is paying off bigtime!</p>
<pre class="r"><code># data is range A3: BH10, we&#39;ll get the date values from row 3
# the row titles are in column A

df.statedq&lt;-read_excel(&quot;data/HHD_C_Report_2017Q1.xlsx&quot;, 
               sheet = &quot;Page 23 Data&quot;,  # name of sheet
               range=&quot;A3:BF15&quot; )        # range where data lives

## we&#39;ve got blank columns in positions 2 &amp; 3 (drop them)
## then we&#39;ll gather the data and rename X__1 as &quot;state&quot;

df.state3&lt;-df.statedq %&gt;% gather(datec,dqdebt,c(2:58)) %&gt;% rename(state=X__1)

#now create a date variable using the datec string:

df.state3&lt;- df.state3 %&gt;% 
  mutate(year=2000+as.numeric(substr(datec,1,2)),
         month=as.numeric(substr(datec,5,5))*3) %&gt;%
  # create date variable
  mutate(date=as.Date(ISOdate(year,month,1))) %&gt;% 
  # drop unneeede variables
  select(state,date,dqdebt)

#plot delinquency rates

ggplot(data=df.state3,aes(x=date,y=dqdebt,color=state,
                          label=round(dqdebt,1)))+
  geom_line(size=1.2)+theme_minimal()+
  geom_text_repel(data=filter(df.state3,date==&quot;2017-03-01&quot;),
                  nudge_x=10,nudge_y=.025)+
    facet_wrap(~state,ncol=3)  + 
     theme(plot.title=element_text(size=14),
           plot.caption=element_text(hjust=0))+
  coord_cartesian(xlim=c(as.Date(&quot;2003-01-01&quot;),as.Date(&quot;2017-12-31&quot;)))+
  theme(legend.position=&quot;none&quot;)+
labs(title=&quot;Percent of Balance 90+ Days Late by State&quot;,
     subtitle=&quot;Based on the population with a credit report&quot;,
     x=&quot;&quot;,y=&quot;Percent of Balance 90+ Days Late&quot;,
     caption=&quot;@lenkiefer Source: FRBNY Consumer Credit Panel/Equifax&quot;)</code></pre>
<p><img src="/post/2017-05-21-consumer-price-household-debt_files/figure-html/05-21-2017-data-4-state-1.png" width="672" /></p>
<p>After rising very high during the Great Recession and its aftermath, delinquency rates are coming down. Let’s try to rework this line chart as a dot chart.</p>
</div>
<div id="state-delinquency-dot-chart" class="section level3">
<h3>State delinquency dot chart</h3>
<p>First, we’ll compute the max and min delinquency rate for each state, and then plot the 2017Q1 value as a dot with markers to indicate the min/max. We’ll also add the U.S. <code>state=&quot;ALL&quot;&quot;</code> in our data as another reference. I’ve done these calculations before, usually the data.table way, but we’ll do it the dplyr way here.</p>
<pre class="r"><code>df.state3b&lt;-df.state3 %&gt;% 
  # group by states
  group_by(state) %&gt;%  
  # compute state specific min/max
  mutate(dq.max=max(dqdebt),
         dq.min=min(dqdebt)) %&gt;% 
  # ungroup
  ungroup() %&gt;%
  # compute US average, 
  group_by(date) %&gt;%
  mutate(dq.US=dqdebt[state==&quot;ALL&quot;]) %&gt;%
  ungroup() %&gt;%
  # compute max and min
  mutate(dq.USmax=max(dqdebt[state==&quot;ALL&quot;]),
         dq.USmin=min(dqdebt[state==&quot;ALL&quot;])
         )

ggplot(data=filter(df.state3b,date==&quot;2017-03-01&quot;),
       aes(x=dqdebt,y=state,
           color=(dqdebt-dq.min)/(dq.max-dq.min),
           label=state))+
  geom_point(size=3)+
  geom_segment(aes(xend=dq.min,x=dq.max,yend=state),size=2,alpha=0.5)+
  scale_color_viridis(option=&quot;D&quot;,direction=-1,
                      name=&quot;Delinquency rate relative\nto state min/max\n1=max,0=min max&quot;,
                      end=0.95,limits=c(0,1))+
    theme_minimal()+
  theme(legend.position=&quot;top&quot;,
        plot.title=element_text(size=14),
        plot.caption=element_text(hjust=0),
        legend.key.width=unit(3,&quot;line&quot;)) +
  geom_vline(aes(xintercept=dq.US),linetype=2,color=&quot;black&quot;)+
  labs(title=&quot;Percent of Balance 90+ Days Late by State: 2017Q1&quot;,
     subtitle=&quot;Based on the population with a credit report&quot;,
     y=&quot;&quot;,x=&quot;Percent of Balance 90+ Days Late&quot;,
     caption=&quot;@lenkiefer Source: FRBNY Consumer Credit Panel/Equifax\nlines extend from 2003Q1-2017Q1 (state specific) min to max, dotted line U.S. average&quot;)</code></pre>
<p><img src="/post/2017-05-21-consumer-price-household-debt_files/figure-html/05-21-2017-data-5-state-1.png" width="672" /></p>
</div>
<div id="improving-the-plot-with-reordering" class="section level3">
<h3>Improving the plot with reordering</h3>
<p>Ooh, I learned something else I should share. The data below are ordered according alphabetically, which isn’t the best way. Let’s reorder the data based on the current value. We can do it easily thanks to the <a href="http://forcats.tidyverse.org/">forcats</a> <code>fct_reorder</code> function.</p>
<pre class="r"><code>ggplot(data=filter(df.state3b,date==&quot;2017-03-01&quot;),
       aes(x=dqdebt,
           # use fct_reorder, we want the US (state==&quot;ALL&quot;) at the bottom,
           # so use ifelse() statement
           y=forcats::fct_reorder(state,ifelse(state==&quot;ALL&quot;,-100,dqdebt)),
           color=(dqdebt-dq.min)/(dq.max-dq.min),
           label=state))+
  geom_point(size=3)+
  geom_segment(aes(xend=dq.min,x=dq.max,yend=state),size=2,alpha=0.5)+
  scale_color_viridis(option=&quot;D&quot;,direction=-1,
                      name=&quot;Delinquency rate relative\nto state min/max\n1=max,0=min max&quot;,
                      end=0.95,limits=c(0,1))+
    theme_minimal()+
  theme(legend.position=&quot;top&quot;,
        plot.title=element_text(size=14),
        plot.caption=element_text(hjust=0),
        legend.key.width=unit(3,&quot;line&quot;)) +
  geom_vline(aes(xintercept=dq.US),linetype=2,color=&quot;black&quot;)+
  labs(title=&quot;Percent of Balance 90+ Days Late by State: 2017Q1&quot;,
     subtitle=&quot;Based on the population with a credit report&quot;,
     y=&quot;&quot;,x=&quot;Percent of Balance 90+ Days Late&quot;,
     caption=&quot;@lenkiefer Source: FRBNY Consumer Credit Panel/Equifax\nlines extend from 2003Q1-2017Q1 (state specific) min to max, dotted line U.S. average&quot;)</code></pre>
<p><img src="/post/2017-05-21-consumer-price-household-debt_files/figure-html/05-21-2017-data-5-state-factor-reorder-1.png" width="672" /></p>
<p>In this plot we can compare more easily than with the small multiple lines. Notice that the range of variation is quite different depending on which state you are looking at. Nevada (NV) had delinquency rates reach over 20 percent. Ohio (OH) on the other hand, never saw delinquency rates over 10 percent. We can also see that while the level of delinquency has declined, it’s not at a minimum for any of the states tracked.</p>
</div>
</div>
</div>
<div id="movie-versions" class="section level1">
<h1>Movie versions</h1>
<p>These data lend themself to animations.</p>
<p>Here’s some animated gifs of some of the plots:</p>
<p><img src="../../../../img/charts_may_21_2017/cpi_05_21_all_2017 with ed.gif" ></p>
<p><img src="../../../../img/charts_may_21_2017/debt balances 2017Q1 v4.gif" ></p>
<p><img src="../../../../img/charts_may_21_2017/cpi_05_21_all_2017 with ed dots.gif" ></p>
<p><img src="../../../../img/charts_may_21_2017/state dq 2017q1.gif" ></p>
</div>
<div id="wrapping-up" class="section level1">
<h1>Wrapping up</h1>
<p>Time to wrap up for today. We refreshed some old charts and introduced a couple new ones. We did some data wrangling with <a href="https://cran.r-project.org/web/packages/data.table/index.html">data.table()</a> and <a href="https://cran.r-project.org/web/packages/dplyr/index.html">dplyr</a>. We used <a href="https://cran.r-project.org/web/packages/readxl/index.html">readxl</a> to reach into Excel files and get our data. And we tried out <a href="http://forcats.tidyverse.org/">forcats</a> to reorder labels in our chart. All this enabled us wrangle our data and get it ready to use <a href="http://ggplot2.tidyverse.org/">ggplot2</a> to visualize trends in consumer prices and household debt.</p>
<p>Hope you found this useful. How could these code snippets and data visualizations work for you?</p>
</div>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="/2017/05/18/state-hpa/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="/2017/05/18/state-hpa/">State house price growth trends: animated ribbon dataviz</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="/2017/05/22/geo-my-facet/">Facet my geo!</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="/2017/05/22/geo-my-facet/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  

</div>
<footer class="post-footer clearfix">
    
        <p class="post-tags">
            <span>Tagged:</span>
            
            
                <a href="/tags/r/">R</a>, 
            
                <a href="/tags/dataviz/">dataviz</a>, 
            
                <a href="/tags/economy/">economy</a>
            
        </p>
    

    <div class="share">
        
            <a class="icon-twitter" href="https://twitter.com/share?url=http://lenkiefer.com%2f2017%2f05%2f21%2fconsumer-prices-household-debt%2f&text=Consumer%20prices%2c%20household%20debt via %40lenkiefer"
                onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fa fa-twitter"></i>
                <span class="hidden">Twitter</span>
            </a>
        

        
            <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://lenkiefer.com%2f2017%2f05%2f21%2fconsumer-prices-household-debt%2f"
                onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                <i class="fa fa-facebook"></i>
                <span class="hidden">Facebook</span>
            </a>
        


        
    </div>
</footer>
</div>
</div>
<script src="/js/ui.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66905937-1', 'auto');
  ga('send', 'pageview');

</script>






</body>
</html>

