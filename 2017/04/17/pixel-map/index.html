<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.52" />

  <title>Let&#39;s Pixelate America &middot; Len Kiefer</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="/img/favicon.PNG" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="/">Len Kiefer</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/post/"><i class='fa fa-list fa-fw'></i>Archive</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/@lenkiefer" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/leonard-kiefer-51175331" target="_blank"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/lenkiefer" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2015-2018. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


       <meta name="twitter:card" content="summary">
       <meta name="twitter:image" content="http://lenkiefer.com/img/logo/logo.png" >
    
    <meta property="og:title" content="Let&#39;s Pixelate America">
    <meta property="og:description" content="LET’S PIXELATE AMERICA. This morning I happened across a fun blog post on how to generate Pixel maps with R via R weekly.
The basic code is so easy, all you need is ggplot2 (which I get from the tidyverse).
library(tidyverse)## Warning: package &#39;tidyverse&#39; was built under R version 3.5.1## -- Attaching packages -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- tidyverse 1.2.1 --## v ggplot2 3.0.0 v purrr 0.2.5## v tibble 1.">

<div class="header">
  <h1>Let&#39;s Pixelate America</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>2017/04/17</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="/tags/fun">fun</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/dataviz">dataviz</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/r">R</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/maps">maps</a>
    
  </div>
  
  

</div>

  


<p>LET’S PIXELATE AMERICA. This morning I happened across a <a href="http://colinfay.me/rstats-create-a-pixel-map-with-r/">fun blog post</a> on how to generate Pixel maps with <a href="https://www.r-project.org/">R</a> via <a href="https://rweekly.org/">R weekly</a>.</p>
<p>The basic code is so easy, all you need is <a href="http://ggplot2.tidyverse.org/">ggplot2</a> (which I get from the <a href="http://tidyverse.org/">tidyverse</a>).</p>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## Warning: package &#39;tidyverse&#39; was built under R version 3.5.1</code></pre>
<pre><code>## -- Attaching packages -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- tidyverse 1.2.1 --</code></pre>
<pre><code>## v ggplot2 3.0.0     v purrr   0.2.5
## v tibble  1.4.2     v dplyr   0.7.6
## v tidyr   0.8.0     v stringr 1.3.1
## v readr   1.1.1     v forcats 0.3.0</code></pre>
<pre><code>## Warning: package &#39;purrr&#39; was built under R version 3.5.1</code></pre>
<pre><code>## Warning: package &#39;stringr&#39; was built under R version 3.5.1</code></pre>
<pre><code>## -- Conflicts ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>ggplot(map_data(&quot;state&quot;), aes(round(long, 0),round(lat,0), 
                              group=group, fill = as.factor(group))) +
  geom_polygon() +
  guides(fill=FALSE) +
  coord_map() +
  theme_void()</code></pre>
<pre><code>## 
## Attaching package: &#39;maps&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     map</code></pre>
<p><img src="/post/2017-04-17-pixel-map_files/figure-html/04-17-2017-pixel-1-1.png" width="672" /></p>
<p>We can modify our <a href="../../../../2017/04/14/after-dark">dark theme</a> and generate a dark background. Then we’ll animate it to get:</p>
<p><img src="{{ site.url }}/img/charts_apr_17_2017/pixel map dark.gif" 
alt="pmms after dark"/></p>
<p>Using this code:</p>
<pre class="r"><code>library(ggthemes)
library(animation)
library(tweenr)
library(extrafont)
library(gridExtra)
library(tidyr)  # for map function

 #  Function for use with tweenr
  myf&lt;-function (d=6){
    d.out&lt;-map.df
    d.out$lat&lt;-round(d.out$lat,d) # round lat and lon
    d.out$long&lt;-round(d.out$long,d)
    d.out %&gt;% map_if(is.character, as.factor) %&gt;% as.data.frame -&gt; d.out
    return(d.out)
  }

 #pick some points to interpolate
  my.list2&lt;-lapply(c(8,0,8),myf)  
  #use tweenr to interploate
  tf &lt;- tween_states(my.list2,tweenlength= 1,
                     statelength=3, ease=rep(&#39;cubic-in-out&#39;,2),nframes=70)
  tf&lt;-data.table(tf) #convert output into data table
  

N&lt;-max(tf$.frame)  
oopt = ani.options(interval = 0.05)
saveGIF({for (i in 1:max(tf$.frame)) {
  g&lt;-
    ggplot(filter(tf,.frame==i), 
           aes(long,lat, group=group, fill = as.factor(group))) +
    geom_polygon() +
    guides(fill=FALSE) +
    coord_map() + theme_void(base_family = &quot;Courier New&quot;)+
    labs(title=&quot;Let&#39;s Pixelate America&quot;,
         caption=&quot;@lenkiefer \nbased on code from:         http://colinfay.me/rstats-create-a-pixel-map-with-r/&quot;,
        subtitle=&quot;Pixel Map&quot; )+
    # Dark styling:
    theme(panel.background = element_rect(fill = &quot; gray10&quot;, color  =  NA),  
          plot.background = element_rect(color = &quot; gray10&quot;, fill = &quot; gray10&quot;),  
          plot.title = element_text(size = base_size*1.5,face=&quot;bold&quot;, 
                                    color = &quot;white&quot;,hjust=0,lineheight=1.25,
                                    margin=margin(2,2,2,2)),  
            plot.subtitle = element_text(size = base_size*1, 
                                         color = &quot;white&quot;,hjust=0, 
                                         margin=margin(2,2,2,2)),  
            plot.caption = element_text(size = base_size*0.75, 
                                        color = &quot;white&quot;,hjust=0),  
            plot.margin = unit(rep(1, 4), &quot;lines&quot;))+
      # Keep zoom constant by fixing lat/long
      scale_x_continuous(limits=c(-130,-60))+
      scale_y_continuous(limits=c(20,55))
    print(g)
    print(paste(i,&quot;out of&quot;,N))
    ani.pause()
    }
},movie.name=&quot;pixel map dark.gif&quot;,ani.width = 650, ani.height = 400)</code></pre>
<div id="a-practical-use-for-this" class="section level1">
<h1>A practical use for this?</h1>
<p>This is fun, but is there any practical use? Maybe.</p>
<p>When I construct data visualizations I like to use a “squint test” where I squint my eyes and simulate a lower resolution visualization. If I can still get the main point through squinted eyes, then the visualization passes the test. Let’s try that with some real data.</p>
<p>We’ll plot a state map showing annual house price appreciation as measured by the <a href="https://www.fhfa.gov/DataTools/Downloads/pages/house-price-index.aspx">FHFA purchase-only house price index</a>. These plots are the modified versions of the ones from <a href="../../../../2016/08/24/more-maps">this post</a> I shared last year.</p>
<pre class="r"><code>#load some libraries
library(ggthemes)</code></pre>
<pre><code>## Warning: package &#39;ggthemes&#39; was built under R version 3.5.1</code></pre>
<pre class="r"><code>library(scales)</code></pre>
<pre><code>## 
## Attaching package: &#39;scales&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     discard</code></pre>
<pre><code>## The following object is masked from &#39;package:readr&#39;:
## 
##     col_factor</code></pre>
<pre class="r"><code>library(rgeos)</code></pre>
<pre><code>## rgeos version: 0.3-28, (SVN revision 572)
##  GEOS runtime version: 3.6.1-CAPI-1.10.1 r0 
##  Linking to sp version: 1.3-1 
##  Polygon checking: TRUE</code></pre>
<pre class="r"><code>library(maptools)</code></pre>
<pre><code>## Loading required package: sp</code></pre>
<pre><code>## Checking rgeos availability: TRUE</code></pre>
<pre class="r"><code>library(albersusa)
library(ggalt)
library(viridis)</code></pre>
<pre><code>## Loading required package: viridisLite</code></pre>
<pre><code>## 
## Attaching package: &#39;viridis&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:scales&#39;:
## 
##     viridis_pal</code></pre>
<pre class="r"><code>library(data.table) # for data manipulation</code></pre>
<pre><code>## Warning: package &#39;data.table&#39; was built under R version 3.6.0</code></pre>
<pre><code>## 
## Attaching package: &#39;data.table&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:dplyr&#39;:
## 
##     between, first, last</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     transpose</code></pre>
<pre class="r"><code>#read in data available as a text file from the FHFA website:
fhfa.data&lt;-fread(&quot;http://www.fhfa.gov/DataTools/Downloads/Documents/HPI/HPI_PO_state.txt&quot;)
#create annual house price growth in the SA index:
fhfa.data&lt;-fhfa.data[,hpa12:=index_sa/shift(index_sa,4)-1,by=state]
fhfa.data&lt;-fhfa.data[,iso_3166_2:=state]  #rename state to match usa_composite
fhfa.data&lt;-fhfa.data[,date:=as.Date(ISOdate(yr,qtr*3,1))] #make a date (don&#39;t need it here)
fhfa.data&lt;-fhfa.data[,mylabel:=paste0(&quot;Q&quot;,qtr,&quot;:&quot;,yr)]  #create date label for plot
#do map stuff
states&lt;-usa_composite()
smap&lt;-fortify(states,region=&quot;fips_state&quot;)
states@data &lt;- left_join(states@data, fhfa.data, by = &quot;iso_3166_2&quot;)
states@data$id&lt;-states@data$fips_state
smap2&lt;-left_join(smap,states@data,by=&quot;id&quot;)

#make plots:

ggplot(filter(smap2,qtr==4 &amp; yr&gt;=2005), 
             aes(long,lat, group=group, fill = hpa12)) +
      geom_polygon()+
      theme_map( base_size = 12) +facet_wrap(~yr,ncol=3)+
  theme(plot.title=element_text( size = 16, margin=margin(b=10))) +
  theme(plot.subtitle=element_text(size = 14, margin=margin(b=-20))) +
  theme(plot.caption=element_text(size = 9, margin=margin(t=-15))) +
  labs(title=&quot;&quot;,subtitle=&quot;&quot; ) +
  scale_fill_viridis(name = &quot;&quot;, discrete=F,option=&quot;D&quot;,end=0.95,
                     direction=-1,limits=c(-0.35,0.35),label=percent)+
  theme(legend.position = &quot;top&quot;, 
        plot.caption=element_text(hjust=0,                                                                  vjust=1,margin=margin(t=10)))+
  labs(title=paste0(&quot;Four quarter house price percent change (Q4/Q4 %)&quot;),
       caption=&quot;@lenkiefer Source: FHFA Purchase-Only House Price Index (SA)&quot;)</code></pre>
<p><img src="/post/2017-04-17-pixel-map_files/figure-html/04-17-2017-hpi-1-1.png" width="672" /></p>
<p>This map seems to do okay on the squint test. The extreme declines of 2008 and 2009 are clearly seen in the maps. But let’s use the pixelation trick to generate a pixelated version:</p>
<pre class="r"><code>ggplot(filter(smap2,qtr==4 &amp; yr&gt;=2005), 
             aes(round(long/3,0)*3,round(lat/3,0)*3, group=group, fill = hpa12)) +
      geom_polygon()+
      theme_map( base_size = 12) +facet_wrap(~yr,ncol=3)+
  theme(plot.title=element_text( size = 16, margin=margin(b=10))) +
  theme(plot.subtitle=element_text(size = 14, margin=margin(b=-20))) +
  theme(plot.caption=element_text(size = 9, margin=margin(t=-15))) +
  labs(title=&quot;&quot;,subtitle=&quot;&quot; ) +
  scale_fill_viridis(name = &quot;&quot;, discrete=F,option=&quot;D&quot;,end=0.95,
                     direction=-1,limits=c(-0.35,0.35),label=percent)+
  theme(legend.position = &quot;top&quot;, 
        plot.caption=element_text(hjust=0,                                                                  vjust=1,margin=margin(t=10)))+
  labs(title=paste0(&quot;Four quarter house price percent change (Q4/Q4 %)&quot;),
       caption=&quot;@lenkiefer Source: FHFA Purchase-Only House Price Index (SA)&quot;)</code></pre>
<p><img src="/post/2017-04-17-pixel-map_files/figure-html/04-17-2017-hpi-2-1.png" width="672" /></p>
<p>Okay, so even with our simulated squint, the key patterns still seem visible.</p>
</div>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="/2017/04/16/house-price-to-income-acs-2015/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="/2017/04/16/house-price-to-income-acs-2015/">Of kernels and beeswarms: Comparing the distribution of house values to household income</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="/2017/04/18/housing-good-start/">Housing gets off to a good start</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="/2017/04/18/housing-good-start/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  

</div>
<footer class="post-footer clearfix">
    
        <p class="post-tags">
            <span>Tagged:</span>
            
            
                <a href="/tags/fun/">fun</a>, 
            
                <a href="/tags/dataviz/">dataviz</a>, 
            
                <a href="/tags/r/">R</a>, 
            
                <a href="/tags/maps/">maps</a>
            
        </p>
    

    <div class="share">
        
            <a class="icon-twitter" href="https://twitter.com/share?url=http://lenkiefer.com%2f2017%2f04%2f17%2fpixel-map%2f&text=Let%27s%20Pixelate%20America via %40lenkiefer"
                onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fa fa-twitter"></i>
                <span class="hidden">Twitter</span>
            </a>
        

        
            <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://lenkiefer.com%2f2017%2f04%2f17%2fpixel-map%2f"
                onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                <i class="fa fa-facebook"></i>
                <span class="hidden">Facebook</span>
            </a>
        


        
    </div>
</footer>
</div>
</div>
<script src="/js/ui.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66905937-1', 'auto');
  ga('send', 'pageview');

</script>






</body>
</html>

