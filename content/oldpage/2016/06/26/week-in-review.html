
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Brexit, State of the Nation's Housing, and home sales: the week in charts.</title>
    
    <meta name="author" content="Len Kiefer">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap styles -->
    <link href="/assets/themes/lentheme/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Optional theme -->
    <link href="/assets/themes/lentheme/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet">
    <!-- Sticky Footer -->
    <link href="/assets/themes/lentheme/bootstrap/css/bs-sticky-footer.css" rel="stylesheet">
    
    <!-- Custom styles -->
    <link href="/assets/themes/lentheme/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!-- Update these with your own images
      <link rel="shortcut icon" href="images/favicon.ico">
      <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div id="wrap">
      <nav class="navbar navbar-default" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#jb-navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/"><span class="icon-home3" style="font-size:24px"> Len Kiefer</a></span>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="jb-navbar-collapse" style="font-size:24px">
          <ul class="nav navbar-nav" >
        <li><a href="/archive.html"><span class="icon-newspaper"> Posts</a></span></li>
            <!-- li><a href="/chartbook/index.html"><span class="icon-display"> Chartbook</a></span></li-->
         <li><a href="/resume.html"><span class="icon-profile"> Resume</span></a></li>
        <li><a href="/about.html"><span class="icon-user-tie"> About</span></a></li>
          </ul>
        </div><!-- /.navbar-collapse -->
      </nav>

      <div class="container">
        
<div class="page-header">
  <h1>Brexit, State of the Nation's Housing, and home sales: the week in charts. </h1>
</div>

<div class="row post-full">
  <div class="col-xs-12">
    <div class="date">
      <span>26 June 2016</span>
    </div>
    <div class="content">
      <p>IT WAS A BUSY WEEK FOR ECONOMIC AND HOUSING DATA. <a href="http://www.realtor.org/news-releases/2016/06/existing-home-sales-grow-18-percent-in-may-highest-pace-in-over-nine-years">Existing</a> and <a href="https://www.census.gov/construction/nrs/pdf/newressales.pdf">new</a> home sales came out, the Joint Center for Housing Studies of Harvard University released their annual <a href="http://www.jchs.harvard.edu/research/state_nations_housing">State of the Nation’s Housing</a>, and the U.K. voted to leave the European Union (the Brexit). We’ll recap these data and events through charts I’ve created and shared throughout the week.</p>

<p>In this post, I’ll share each of the charts with some commentary, and then below, I’ll include the R code I used to generate the charts.</p>

<h1 id="home-sales-catching-up-to-the-fastest-pace-in-a-decade">Home sales catching up to the fastest pace in a decade</h1>

<p>Both existing and new home sales for May 2016 came out this month, with Existing home sales released on Wednesday and new home sales on Thursday. Home sales have been picking up steam throughout 2016. Total home sales are likely to reach the highest annual total since 2006.  In order to do that, sales have to outpace 2007.</p>

<h2 id="existing-home-sales-post-best-monthly-sales-since-2007">Existing home sales post best monthly sales since 2007</h2>

<p>Existing home sales for May 2016 were at the highest level since 2007 and seem to be getting traction.  The graph below compares monthly existing home sales (not seasonally adjusted) across years. This year’s pace is running below 2007, but the gap is narrow.  In 2007 home sales slowed in the summer and fall, so if this year’s pace maintains its momentum it’s likely this year will be the best year for existing home sales since 2006.</p>

<p><img src="/img/charts_jun_26_2016/ehs ytd may 2016.gif" alt="dot plot" /></p>

<h2 id="new-home-sales-drop-but-estimates-uncertain">New home sales drop, but estimates uncertain</h2>

<p>New home sales had an extremely strong initial reading for April, but the May release revised down the estimates substantially. In May 2016, new home sales were up 8.7 percent year-over-year. The estimates for new home sales are subject to a lot of sampling uncertainty, and Census provides estimates of that uncertainty. In the chart below I plot not only the level of new home sales, but also the 90% confidence interval constructed using <a href="https://www.census.gov/econ/currentdata/dbsearch?program=RESSALES&amp;startYear=1963&amp;endYear=2016&amp;categories=ASOLD&amp;dataType=TOTAL&amp;geoLevel=US&amp;adjusted=1&amp;errorData=1&amp;submit=GET+DATA&amp;releaseScheduleId=">data from Census</a>.</p>

<p><img src="/img/charts_jun_26_2016/newsales_6_25_2016_bands.gif" alt="dot plot" /></p>

<h2 id="total-home-sales-behind-2007-but-looking-to-gain">Total home sales behind 2007, but looking to gain</h2>

<p>Through May total home sales (new + existing) are running below 2007 pace, but not by much. The chart below compares monthly total home sales (NSA) since 2007.  In 2007 home sales slowed considerably in the seconed half of the year, leaving room for 2016 to catch up if we can maintain a pace similar to last year.</p>

<p><img src="/img/charts_jun_26_2016/tween sales jun 25 2016.gif" alt="dot plot" /></p>

<h1 id="ahead-of-brexit-interest-rates-already-falling">Ahead of Brexit, interest rates already falling.</h1>

<p>On Friday after the Brexit leave vote was announced, financial markets roiled, with stocks tumbling and Treasury yields falling. But even before the vote was announced, long-term interest rates had been falling.</p>

<p><img src="/img/charts_jun_26_2016/rate_6_23_2016_2.gif" alt="pmms 6 23 2016" /></p>

<p>Will mortgage rates fall even more next week? With 10-year Treasury yields down almost 19 basis points on Friday, we should expect to see mortgage rates trend lower in the next week. But even if the declines in Treasury yields stick next week, in times of volatility some of the declines in Treasury yields do not flow into mortgage rates, instead spreads widen.</p>

<p><img src="/img/Rfig/rate-scatter-1.svg" alt="plot of chunk rate-scatter" /></p>

<p>The chart above shows that in general, the 30-year fixed mortgage rate follows the 10-year Treasury pretty closely. However, in 2012 there were several points below the line. Those weeks correspond to the spring of 2012 when 10-year Treasury yields fell more rapidly than mortgage rates. This was partially due to increased volatility and risk aversion around other European macroeconomic risks.</p>

<p>The chart below shows the time series for the 10-year Treasury and the 30-year mortgage rate, with the spread shaded.</p>

<p><img src="/img/Rfig/rate-spread1-1.svg" alt="plot of chunk rate-spread1" /></p>

<p>The chart below plots the spread, with the 2011-2016 average (about 1.7 percentage points) spreads denoted by the dotted lines.  Periods when the spreads were above average (2011-2012) and again in 2016 were periods with increased macroeconomic risks.</p>

<p><img src="/img/Rfig/rate-spread2-1.svg" alt="plot of chunk rate-spread2" /></p>

<p>While risks may be elevated, it might be helpful to compare to 2008 when spreads were considerably wider:</p>

<p><img src="/img/Rfig/rate-spread3-1.svg" alt="plot of chunk rate-spread3" /></p>

<h1 id="visualizing-affordability">Visualizing affordability</h1>

<p>This week the Joint Center for Housing Studies (JCHS) of Harvard University released their annual <a href="http://www.jchs.harvard.edu/research/state_nations_housing">State of the Nation’s Housing</a>. The report is full of useful information about housing markets in the United States.</p>

<p>One area of concern for analysts of U.S. housing markets is the rising cost burden of housing. In the report the JCHS computes costs burdens using Census data. Cost-burdened households are those that pay more than 30 percent of income for housing, while severely burdened households spend more than 50 percent. The chart below compares the percentage of cost-burdened households by metro area to the U.S. average broken out by household income.</p>

<p><img src="/img/charts_jun_26_2016/jchs 2016 w5b.gif" alt="dot plot" /></p>

<h1 id="code-to-make-selected-charts">Code to make selected charts</h1>

<p>In this section I’ll provide code to make a few of the charts I posed above.</p>

<p>First we’ll load the required libraries.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r">  <span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
  <span class="n">library</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span>
  <span class="n">library</span><span class="p">(</span><span class="n">animation</span><span class="p">)</span>
  <span class="n">library</span><span class="p">(</span><span class="n">ggthemes</span><span class="p">)</span>
  <span class="n">library</span><span class="p">(</span><span class="n">data.table</span><span class="p">)</span>
  <span class="n">library</span><span class="p">(</span><span class="n">tweenr</span><span class="p">)</span>  <span class="c1">#used for animation
</span><span class="n">library</span><span class="p">(</span><span class="s2">"viridis"</span><span class="p">)</span></code></pre></figure>

<h2 id="existing-home-sales-chart">Existing home sales chart</h2>

<p>Next, we’ll make a static version of the bar chart:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">ehs</span> <span class="o">&lt;-</span> <span class="n">fread</span><span class="p">(</span><span class="s2">"data/ehs.txt"</span><span class="p">)</span>  <span class="c1">#load data
</span><span class="n">ehs</span><span class="o">$</span><span class="n">date</span><span class="o">&lt;-</span><span class="n">as.Date</span><span class="p">(</span><span class="n">ehs</span><span class="o">$</span><span class="n">date</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s2">"%m/%d/%Y"</span><span class="p">)</span>
<span class="n">ehs</span><span class="p">[,</span> <span class="n">ehsc</span><span class="o">:=</span><span class="n">cumsum</span><span class="p">(</span><span class="n">ehs</span><span class="p">),</span> <span class="n">by</span><span class="o">=</span><span class="n">year</span><span class="p">]</span>  <span class="c1">#computer cumulative sales YTD
</span>
<span class="c1">#Make plot
</span>    <span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">ehs</span><span class="p">[</span><span class="n">year</span><span class="o">&gt;</span><span class="m">2006</span> <span class="o">&amp;</span> <span class="n">month</span><span class="o">&lt;</span><span class="m">6</span><span class="p">],</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">factor</span><span class="p">(</span><span class="n">year</span><span class="p">),</span> <span class="n">y</span> <span class="o">=</span> <span class="n">ehs</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="n">reorder</span><span class="p">(</span><span class="n">mname</span><span class="p">,</span><span class="n">month</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="n">mname</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_bar</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s2">"gray"</span><span class="p">,</span> <span class="n">stat</span> <span class="o">=</span> <span class="s2">"identity"</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.75</span><span class="p">)</span><span class="o">+</span>
    <span class="n">scale_fill_viridis</span><span class="p">(</span><span class="n">discrete</span><span class="o">=</span><span class="n">T</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="m">0.95</span><span class="p">,</span><span class="n">direction</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">option</span><span class="o">=</span><span class="s2">"D"</span><span class="p">)</span><span class="o">+</span>  <span class="c1">#use viridis color scale
</span>    <span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span> 
    <span class="n">geom_text</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">ehs</span><span class="p">[</span><span class="n">month</span><span class="o">==</span><span class="m">5</span> <span class="o">&amp;</span> <span class="n">year</span><span class="o">==</span><span class="m">2016</span><span class="p">],</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">ehsc</span><span class="p">),</span><span class="n">nudge_y</span><span class="o">=</span><span class="m">0.25</span><span class="p">,</span><span class="n">hjust</span><span class="o">=</span><span class="m">-.2</span><span class="p">)</span><span class="o">+</span>
    <span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="n">ehs</span><span class="p">[</span> <span class="n">month</span><span class="o">==</span><span class="m">5</span> <span class="o">&amp;</span> <span class="n">year</span><span class="o">==</span><span class="m">2016</span><span class="p">]</span><span class="o">$</span><span class="n">ehsc</span><span class="p">,</span><span class="n">linetype</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"black"</span><span class="p">)</span><span class="o">+</span>
    <span class="n">xlab</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span><span class="o">+</span><span class="n">ylab</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span><span class="o">+</span>
    <span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Existing Home Sales (Ths. NSA)"</span><span class="p">,</span>
         <span class="n">subtitle</span><span class="o">=</span><span class="s2">"dotted line 2016 YTD"</span><span class="p">,</span>
         <span class="n">caption</span><span class="o">=</span><span class="s2">"@lenkiefer Source:NAR"</span><span class="p">)</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">14</span><span class="p">))</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">legend.justification</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">),</span> <span class="n">legend.position</span><span class="o">=</span><span class="s2">"none"</span><span class="p">)</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.caption</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">hjust</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">vjust</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="m">10</span><span class="p">)))</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.margin</span><span class="o">=</span><span class="n">unit</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="m">0.25</span><span class="p">,</span><span class="m">0.25</span><span class="p">,</span><span class="m">0.25</span><span class="p">,</span><span class="m">0.25</span><span class="p">),</span><span class="s2">"cm"</span><span class="p">))</span><span class="o">+</span>
    <span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">3000</span><span class="p">))</span><span class="o">+</span>
    <span class="n">coord_flip</span><span class="p">()</span>  <span class="err">#</span><span class="n">flip</span> <span class="n">so</span> <span class="n">that</span> <span class="n">the</span> <span class="n">bars</span> <span class="n">are</span> <span class="n">horizontal</span> <span class="n">rather</span> <span class="n">than</span> <span class="n">vertical</span></code></pre></figure>

<p><img src="/img/Rfig/ehs-bars-1.svg" alt="plot of chunk ehs-bars" /></p>

<h3 id="animated-existing-home-sales-chart">Animated existing home sales chart</h3>

<p>Make the animation with the following code:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">ehs</span><span class="o">$</span><span class="n">mname</span><span class="o">&lt;-</span><span class="n">factor</span><span class="p">(</span><span class="n">ehs</span><span class="o">$</span><span class="n">mname</span><span class="p">)</span>  <span class="c1">#convert months to factor
</span>
<span class="c1">#This function will copy the data table, but overwrite months after the cutoff with values of 0
#This way, tweenr will extend out as we add months and fill in the values
</span><span class="n">myf3</span><span class="o">&lt;-</span><span class="k">function</span><span class="p">(</span><span class="n">m</span><span class="p">){</span>
  <span class="n">DT</span><span class="o">&lt;-</span><span class="n">copy</span><span class="p">(</span><span class="n">ehs</span><span class="p">)</span>
  <span class="n">DT</span><span class="o">&lt;-</span><span class="n">DT</span><span class="p">[</span><span class="n">month</span><span class="o">&gt;</span><span class="n">m</span><span class="p">,</span><span class="n">ehs</span><span class="o">:=</span><span class="m">0</span><span class="p">]</span>
  <span class="n">DT</span><span class="o">$</span><span class="n">mm</span><span class="o">&lt;-</span><span class="n">m</span>
  <span class="n">as.data.frame</span><span class="p">(</span><span class="n">DT</span><span class="p">)}</span>

<span class="n">my.list3</span><span class="o">&lt;-</span><span class="n">lapply</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="n">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="m">0</span><span class="p">),</span><span class="n">myf3</span><span class="p">)</span>  <span class="c1">#the animation will loop through each of the first five months of the year an then meet back at 0.
</span>

<span class="n">tf</span> <span class="o">&lt;-</span> <span class="n">tween_states</span><span class="p">(</span><span class="n">my.list3</span><span class="p">,</span> <span class="n">tweenlength</span><span class="o">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">statelength</span><span class="o">=</span><span class="m">3</span><span class="p">,</span> <span class="n">ease</span><span class="o">=</span><span class="n">rep</span><span class="p">(</span><span class="s1">'cubic-in-out'</span><span class="p">,</span><span class="m">17</span><span class="p">),</span><span class="n">nframes</span><span class="o">=</span><span class="m">50</span><span class="p">)</span>
<span class="n">tf</span><span class="o">&lt;-</span><span class="n">data.table</span><span class="p">(</span><span class="n">tf</span><span class="p">)</span>  


<span class="n">oopt</span> <span class="o">=</span> <span class="n">ani.options</span><span class="p">(</span><span class="n">interval</span> <span class="o">=</span> <span class="m">0.125</span><span class="p">)</span>
<span class="n">saveGIF</span><span class="p">({</span><span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">1</span><span class="o">:</span><span class="n">max</span><span class="p">(</span><span class="n">tf</span><span class="o">$</span><span class="n">.frame</span><span class="p">))</span> <span class="p">{</span>
  <span class="n">g</span><span class="o">&lt;-</span>
    <span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">tf</span><span class="p">[</span><span class="n">year</span><span class="o">&gt;</span><span class="m">2006</span> <span class="o">&amp;</span> <span class="n">.frame</span><span class="o">==</span><span class="n">i</span> <span class="o">&amp;</span> <span class="n">month</span><span class="o">&lt;</span><span class="m">6</span><span class="p">],</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">factor</span><span class="p">(</span><span class="n">year</span><span class="p">),</span> <span class="n">y</span> <span class="o">=</span> <span class="n">ehs</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="n">reorder</span><span class="p">(</span><span class="n">mname</span><span class="p">,</span><span class="n">month</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="n">mname</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_bar</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s2">"gray"</span><span class="p">,</span> <span class="n">stat</span> <span class="o">=</span> <span class="s2">"identity"</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.75</span><span class="p">)</span><span class="o">+</span>
    <span class="n">scale_fill_viridis</span><span class="p">(</span><span class="n">discrete</span><span class="o">=</span><span class="n">T</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="m">0.95</span><span class="p">,</span><span class="n">direction</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">option</span><span class="o">=</span><span class="s2">"D"</span><span class="p">)</span><span class="o">+</span>  <span class="c1">#use viridis color scale
</span>    <span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span> 
    <span class="n">geom_text</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">tf</span><span class="p">[</span><span class="n">month</span><span class="o">==</span><span class="n">mm</span><span class="o">&amp;</span> <span class="n">year</span><span class="o">==</span><span class="m">2016</span> <span class="o">&amp;</span> <span class="n">.frame</span><span class="o">==</span><span class="n">i</span><span class="p">],</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">ehsc</span><span class="p">),</span><span class="n">nudge_y</span><span class="o">=</span><span class="m">0.25</span><span class="p">,</span><span class="n">hjust</span><span class="o">=</span><span class="m">-.2</span><span class="p">)</span><span class="o">+</span>
    <span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="n">tf</span><span class="p">[</span><span class="n">.frame</span><span class="o">==</span><span class="n">i</span> <span class="o">&amp;</span> <span class="n">month</span><span class="o">==</span><span class="n">mm</span> <span class="o">&amp;</span> <span class="n">year</span><span class="o">==</span><span class="m">2016</span><span class="p">]</span><span class="o">$</span><span class="n">ehsc</span><span class="p">,</span><span class="n">linetype</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"black"</span><span class="p">)</span><span class="o">+</span>
    <span class="n">xlab</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span><span class="o">+</span><span class="n">ylab</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span><span class="o">+</span>
    <span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Existing Home Sales (Ths. NSA)"</span><span class="p">,</span>
         <span class="n">subtitle</span><span class="o">=</span><span class="s2">"dotted line 2016 YTD"</span><span class="p">,</span>
         <span class="n">caption</span><span class="o">=</span><span class="s2">"@lenkiefer Source:NAR"</span><span class="p">)</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">14</span><span class="p">))</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">legend.justification</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">),</span> <span class="n">legend.position</span><span class="o">=</span><span class="s2">"none"</span><span class="p">)</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.caption</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">hjust</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">vjust</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="m">10</span><span class="p">)))</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.margin</span><span class="o">=</span><span class="n">unit</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="m">0.25</span><span class="p">,</span><span class="m">0.25</span><span class="p">,</span><span class="m">0.25</span><span class="p">,</span><span class="m">0.25</span><span class="p">),</span><span class="s2">"cm"</span><span class="p">))</span><span class="o">+</span>
    <span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">3000</span><span class="p">))</span><span class="o">+</span><span class="n">coord_flip</span><span class="p">()</span>
  <span class="n">print</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
  <span class="n">ani.pause</span><span class="p">()</span>
<span class="p">}</span>
<span class="p">},</span><span class="n">movie.name</span><span class="o">=</span><span class="s2">"ehs ytd may 2016.gif"</span><span class="p">,</span><span class="n">ani.width</span> <span class="o">=</span> <span class="m">600</span><span class="p">,</span> <span class="n">ani.height</span> <span class="o">=</span> <span class="m">450</span><span class="p">)</span></code></pre></figure>

<h2 id="new-home-sales-chart">New home sales chart</h2>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">mydata</span> <span class="o">&lt;-</span> <span class="n">fread</span><span class="p">(</span><span class="s2">"data/nhs.txt"</span><span class="p">)</span>
<span class="n">mydata</span><span class="o">$</span><span class="n">date</span><span class="o">&lt;-</span><span class="n">as.Date</span><span class="p">(</span><span class="n">mydata</span><span class="o">$</span><span class="n">date</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s2">"%m/%d/%Y"</span><span class="p">)</span>
    <span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mydata</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">date</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">nsales</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">nsales</span><span class="p">))</span><span class="o">+</span><span class="n">geom_line</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mydata</span><span class="p">)</span><span class="o">+</span>
    <span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">limits</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="m">200</span><span class="p">,</span> <span class="m">1600</span><span class="p">),</span> <span class="n">breaks</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">200</span><span class="p">,</span><span class="m">1600</span><span class="p">,</span><span class="m">200</span><span class="p">))</span> <span class="o">+</span> 
    <span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">tail</span><span class="p">(</span><span class="n">mydata</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="n">colour</span> <span class="o">=</span> <span class="n">plasma</span><span class="p">(</span><span class="m">5</span><span class="p">)[</span><span class="m">1</span><span class="p">],</span> <span class="n">size</span> <span class="o">=</span> <span class="m">3</span><span class="p">)</span><span class="o">+</span>
    <span class="n">scale_x_date</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span> <span class="n">date_format</span><span class="p">(</span><span class="s2">"%b-%Y"</span><span class="p">),</span> <span class="n">limits</span> <span class="o">=</span> <span class="n">as.Date</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="s1">'2000-01-01'</span><span class="p">,</span><span class="s1">'2016-05-31'</span><span class="p">)))</span> <span class="o">+</span>
    <span class="n">geom_ribbon</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mydata</span><span class="p">,</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">date</span><span class="p">,</span><span class="n">ymin</span><span class="o">=</span><span class="n">down</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="n">up</span><span class="p">),</span><span class="n">fill</span><span class="o">=</span><span class="n">plasma</span><span class="p">(</span><span class="m">5</span><span class="p">)[</span><span class="m">5</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.5</span><span class="p">)</span>  <span class="o">+</span>
    <span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="n">tail</span><span class="p">(</span><span class="n">mydata</span><span class="p">,</span><span class="m">1</span><span class="p">)</span><span class="o">$</span><span class="n">nsales</span><span class="p">,</span><span class="n">linetype</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">plasma</span><span class="p">(</span><span class="m">5</span><span class="p">)[</span><span class="m">1</span><span class="p">])</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">axis.title.x</span> <span class="o">=</span> <span class="n">element_blank</span><span class="p">())</span> <span class="o">+</span>   <span class="c1"># Remove x-axis label
</span>    <span class="n">ylab</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span><span class="o">+</span><span class="n">xlab</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span><span class="o">+</span>
    <span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span>
    <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">NULL</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">NULL</span><span class="p">,</span>
         <span class="n">title</span><span class="o">=</span><span class="s2">"New Home Sales (Ths. SAAR)"</span><span class="p">,</span>
         <span class="n">subtitle</span><span class="o">=</span><span class="n">paste</span><span class="p">(</span><span class="n">as.character</span><span class="p">(</span><span class="n">tail</span><span class="p">(</span><span class="n">mydata</span><span class="p">,</span><span class="m">1</span><span class="p">)</span><span class="o">$</span><span class="n">date</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">"%b-%Y"</span><span class="p">),</span><span class="s2">":"</span><span class="p">,</span><span class="n">tail</span><span class="p">(</span><span class="n">mydata</span><span class="p">,</span><span class="m">1</span><span class="p">)</span><span class="o">$</span><span class="n">nsales</span><span class="p">),</span>
         <span class="n">caption</span><span class="o">=</span><span class="s2">"@lenkiefer Source: Census/HUD, shaded area denotes confidence interval"</span><span class="p">)</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.caption</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">hjust</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">vjust</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="m">10</span><span class="p">)))</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.subtitle</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">plasma</span><span class="p">(</span><span class="m">5</span><span class="p">)[</span><span class="m">1</span><span class="p">]))</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.margin</span><span class="o">=</span><span class="n">unit</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="m">0.5</span><span class="p">,</span><span class="m">0.5</span><span class="p">,</span><span class="m">0.75</span><span class="p">),</span><span class="s2">"cm"</span><span class="p">))</span><span class="o">+</span>
    <span class="n">coord_cartesian</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"2000-01-01"</span><span class="p">),</span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"2016-7-14"</span><span class="p">)),</span> <span class="n">y</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">200</span><span class="p">,</span><span class="m">1600</span><span class="p">))</span></code></pre></figure>

<p><img src="/img/Rfig/nhs-band-1.svg" alt="plot of chunk nhs-band" /></p>

<h3 id="animated-new-home-sales-chart">Animated new home sales chart</h3>

<p>The animated gif for new sales is pretty straightforward to construct. We won’t be using tweenr. Instead, we’ll just loop through each row in the data frame, plotting all the points before that row.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">oopt</span> <span class="o">=</span> <span class="n">ani.options</span><span class="p">(</span><span class="n">interval</span> <span class="o">=</span> <span class="m">0.15</span><span class="p">)</span>
<span class="n">saveGIF</span><span class="p">({</span><span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">1</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">mydata</span><span class="p">))</span> <span class="p">{</span>
  <span class="n">g</span><span class="o">&lt;-</span>
    <span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mydata</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">date</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">nsales</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">nsales</span><span class="p">))</span><span class="o">+</span><span class="n">geom_line</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mydata</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="n">i</span><span class="p">,])</span><span class="o">+</span>
    <span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">limits</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="m">200</span><span class="p">,</span> <span class="m">1600</span><span class="p">),</span> <span class="n">breaks</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">200</span><span class="p">,</span><span class="m">1600</span><span class="p">,</span><span class="m">200</span><span class="p">))</span> <span class="o">+</span> 
    <span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mydata</span><span class="p">[</span><span class="n">i</span><span class="p">,],</span><span class="n">colour</span> <span class="o">=</span> <span class="n">plasma</span><span class="p">(</span><span class="m">5</span><span class="p">)[</span><span class="m">1</span><span class="p">],</span> <span class="n">size</span> <span class="o">=</span> <span class="m">3</span><span class="p">)</span><span class="o">+</span>
    <span class="n">scale_x_date</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span> <span class="n">date_format</span><span class="p">(</span><span class="s2">"%b-%Y"</span><span class="p">),</span> <span class="n">limits</span> <span class="o">=</span> <span class="n">as.Date</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="s1">'2000-01-01'</span><span class="p">,</span><span class="s1">'2016-05-31'</span><span class="p">)))</span> <span class="o">+</span>
    <span class="n">geom_ribbon</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mydata</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="n">i</span><span class="p">,],</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">date</span><span class="p">,</span><span class="n">ymin</span><span class="o">=</span><span class="n">down</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="n">up</span><span class="p">),</span><span class="n">fill</span><span class="o">=</span><span class="n">plasma</span><span class="p">(</span><span class="m">5</span><span class="p">)[</span><span class="m">5</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.5</span><span class="p">)</span>  <span class="o">+</span>
    <span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="n">mydata</span><span class="o">$</span><span class="n">nsales</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">linetype</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">plasma</span><span class="p">(</span><span class="m">5</span><span class="p">)[</span><span class="m">1</span><span class="p">])</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">axis.title.x</span> <span class="o">=</span> <span class="n">element_blank</span><span class="p">())</span> <span class="o">+</span>   <span class="c1"># Remove x-axis label
</span>    <span class="n">ylab</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span><span class="o">+</span><span class="n">xlab</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span><span class="o">+</span>
    <span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span>
    <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">NULL</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">NULL</span><span class="p">,</span>
         <span class="n">title</span><span class="o">=</span><span class="s2">"New Home Sales (Ths. SAAR)"</span><span class="p">,</span>
         <span class="n">subtitle</span><span class="o">=</span><span class="n">paste</span><span class="p">(</span><span class="n">as.character</span><span class="p">(</span><span class="n">mydata</span><span class="o">$</span><span class="n">date</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">format</span><span class="o">=</span><span class="s2">"%b-%Y"</span><span class="p">),</span><span class="s2">":"</span><span class="p">,</span><span class="n">mydata</span><span class="o">$</span><span class="n">nsales</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
         <span class="n">caption</span><span class="o">=</span><span class="s2">"@lenkiefer Source: Census/HUD, shaded area denotes confidence interval"</span><span class="p">)</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.caption</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">hjust</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">vjust</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="m">10</span><span class="p">)))</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.subtitle</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">plasma</span><span class="p">(</span><span class="m">5</span><span class="p">)[</span><span class="m">1</span><span class="p">]))</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.margin</span><span class="o">=</span><span class="n">unit</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="m">0.5</span><span class="p">,</span><span class="m">0.5</span><span class="p">,</span><span class="m">0.75</span><span class="p">),</span><span class="s2">"cm"</span><span class="p">))</span><span class="o">+</span>
    <span class="n">coord_cartesian</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"2000-01-01"</span><span class="p">),</span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"2016-7-14"</span><span class="p">)),</span> <span class="n">y</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">200</span><span class="p">,</span><span class="m">1600</span><span class="p">))</span>
  <span class="n">print</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
  <span class="n">ani.pause</span><span class="p">()</span>
  <span class="n">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="p">}</span>

   <span class="k">for</span> <span class="p">(</span><span class="n">i2</span> <span class="k">in</span> <span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">print</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="n">ani.pause</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">},</span><span class="n">movie.name</span><span class="o">=</span><span class="s2">"nhs.gif"</span><span class="p">,</span><span class="n">ani.width</span> <span class="o">=</span> <span class="m">600</span><span class="p">,</span> <span class="n">ani.height</span> <span class="o">=</span> <span class="m">450</span><span class="p">)</span></code></pre></figure>

<h2 id="code-for-intrest-rate-charts">Code for intrest rate charts</h2>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">rdata</span> <span class="o">&lt;-</span> <span class="n">fread</span><span class="p">(</span><span class="s2">"data/rates.txt"</span><span class="p">)</span>  <span class="c1">#load data
</span><span class="n">rdata</span><span class="o">$</span><span class="n">date</span><span class="o">&lt;-</span><span class="n">as.Date</span><span class="p">(</span><span class="n">rdata</span><span class="o">$</span><span class="n">date</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s2">"%m/%d/%Y"</span><span class="p">)</span>


<span class="c1">#Make scatterplot: Treasury rates vs Mortgage Rate:
</span>
<span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">rdata</span><span class="p">[</span><span class="n">year</span><span class="o">&gt;</span><span class="m">2010</span><span class="p">,],</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">rate10y</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">mrate</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">year</span><span class="p">)))</span><span class="o">+</span><span class="n">geom_point</span><span class="p">()</span><span class="o">+</span>
         <span class="n">scale_color_viridis</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Year"</span><span class="p">,</span><span class="n">discrete</span><span class="o">=</span><span class="n">T</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="m">0.95</span><span class="p">,</span><span class="n">direction</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">option</span><span class="o">=</span><span class="s2">"D"</span><span class="p">)</span><span class="o">+</span>  <span class="c1">#use viridis color scale    
</span>  <span class="n">stat_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">"lm"</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="n">NA</span><span class="p">,</span><span class="n">linetype</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="o">+</span>
  <span class="n">theme</span><span class="p">(</span><span class="n">plot.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">14</span><span class="p">))</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">legend.justification</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">),</span> <span class="n">legend.position</span><span class="o">=</span><span class="s2">"top"</span><span class="p">)</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.caption</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">hjust</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">vjust</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="m">10</span><span class="p">)))</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.margin</span><span class="o">=</span><span class="n">unit</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="m">0.25</span><span class="p">,</span><span class="m">0.25</span><span class="p">,</span><span class="m">0.25</span><span class="p">,</span><span class="m">0.25</span><span class="p">),</span><span class="s2">"cm"</span><span class="p">))</span><span class="o">+</span>
    <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"10-year Treas. Yield (CMT, %)"</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s2">"30-year Fixed Mortgage Rate (%)"</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s2">"10-year Treasury Yields and Mortgage Rates"</span><span class="p">,</span>
         <span class="n">subtitle</span><span class="o">=</span><span class="s2">"2011-2016"</span><span class="p">,</span>
         <span class="n">caption</span><span class="o">=</span><span class="s2">"@lenkiefer Source: Freddie Mac, Federal Reserve"</span><span class="p">)</span>

<span class="c1">#Make line charts with shaded area (ribbon)
</span>
<span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">rdata</span><span class="p">[</span><span class="n">year</span><span class="o">&gt;</span><span class="m">2010</span><span class="p">,],</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">date</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">mrate</span><span class="p">))</span><span class="o">+</span>
  <span class="n">geom_line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">plasma</span><span class="p">(</span><span class="m">5</span><span class="p">)[</span><span class="m">1</span><span class="p">])</span><span class="o">+</span>
  <span class="n">geom_line</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">rate10y</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="n">plasma</span><span class="p">(</span><span class="m">5</span><span class="p">)[</span><span class="m">3</span><span class="p">])</span><span class="o">+</span>
  <span class="n">geom_ribbon</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="n">rate10y</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="n">mrate</span><span class="p">),</span><span class="n">fill</span><span class="o">=</span><span class="n">plasma</span><span class="p">(</span><span class="m">5</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.5</span><span class="p">)</span><span class="o">+</span>
  <span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span>
  <span class="n">theme</span><span class="p">(</span><span class="n">plot.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">14</span><span class="p">))</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">legend.justification</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">),</span> <span class="n">legend.position</span><span class="o">=</span><span class="s2">"top"</span><span class="p">)</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.caption</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">hjust</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">vjust</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="m">10</span><span class="p">)))</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.margin</span><span class="o">=</span><span class="n">unit</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="m">0.25</span><span class="p">,</span><span class="m">0.25</span><span class="p">,</span><span class="m">0.25</span><span class="p">,</span><span class="m">0.25</span><span class="p">),</span><span class="s2">"cm"</span><span class="p">))</span><span class="o">+</span>
    <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s2">"Rate (%)"</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s2">"10-year Treasury Yields and 30-year Fixed Mortgage Rates"</span><span class="p">,</span>
         <span class="n">subtitle</span><span class="o">=</span><span class="s2">"2011-2016"</span><span class="p">,</span>
         <span class="n">caption</span><span class="o">=</span><span class="s2">"@lenkiefer Source: Freddie Mac, Federal Reserve\ntop line mortgage rate, bottom 10-year Treasury, shaded area spread."</span><span class="p">)</span>

<span class="c1">#use data table to compute average spread post-2010
</span><span class="n">rdata</span><span class="p">[</span><span class="n">year</span><span class="o">&gt;</span><span class="m">2010</span><span class="p">,</span><span class="n">sav</span><span class="o">:=</span><span class="n">mean</span><span class="p">(</span><span class="n">mrate</span><span class="o">-</span><span class="n">rate10y</span><span class="p">,</span><span class="n">na.rm</span><span class="o">=</span><span class="n">T</span><span class="p">)]</span>

<span class="c1">#Make spread chart:
</span>
<span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">rdata</span><span class="p">[</span><span class="n">year</span><span class="o">&gt;</span><span class="m">2010</span><span class="p">,],</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">date</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">mrate</span><span class="o">-</span><span class="n">rate10y</span><span class="p">))</span><span class="o">+</span>
  <span class="n">geom_line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">plasma</span><span class="p">(</span><span class="m">5</span><span class="p">)[</span><span class="m">1</span><span class="p">])</span><span class="o">+</span>
  <span class="n">geom_ribbon</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="n">sav</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="n">mrate</span><span class="o">-</span><span class="n">rate10y</span><span class="p">),</span><span class="n">fill</span><span class="o">=</span><span class="n">plasma</span><span class="p">(</span><span class="m">5</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.5</span><span class="p">)</span><span class="o">+</span>
  <span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span> <span class="n">geom_line</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">sav</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="n">linetype</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="m">1.15</span><span class="p">)</span><span class="o">+</span>
  <span class="n">theme</span><span class="p">(</span><span class="n">plot.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">14</span><span class="p">))</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">legend.justification</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">),</span> <span class="n">legend.position</span><span class="o">=</span><span class="s2">"top"</span><span class="p">)</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.caption</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">hjust</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">vjust</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="m">10</span><span class="p">)))</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.margin</span><span class="o">=</span><span class="n">unit</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="m">0.25</span><span class="p">,</span><span class="m">0.25</span><span class="p">,</span><span class="m">0.25</span><span class="p">,</span><span class="m">0.25</span><span class="p">),</span><span class="s2">"cm"</span><span class="p">))</span><span class="o">+</span>
    <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s2">"Rate (%)"</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s2">"Spread: 30-year Fixed Mortgage - 10-year Treasury"</span><span class="p">,</span>
         <span class="n">subtitle</span><span class="o">=</span><span class="s2">"2011-2016"</span><span class="p">,</span>
         <span class="n">caption</span><span class="o">=</span><span class="s2">"@lenkiefer Source: Freddie Mac, Federal Reserve dotted line average spread (2011-2016)"</span><span class="p">)</span></code></pre></figure>


    </div>

    

    
  
    <hr>
    <ul class="pagination">
    
      <li class="prev"><a href="/2016/06/22/Make-a-dotplot" title="Let's make a dot plot">&laquo; Previous</a></li>
    
      <li><a href="/archive.html">Archive</a></li>
    
      <li class="next"><a href="/2016/07/01/going-off-grid" title="Going off the grid">Next &raquo;</a></li>
    
    </ul>
    <hr>
    
  </div>
</div>



      </div>

    </div>

    <div id="footer">
      <div class="container">
        <p>&copy; 2017 Len Kiefer
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>
       
    • <span vertical-align:bottom> <a href="https://twitter.com/lenkiefer" class="twitter-follow-button" data-show-count="false">•   Follow @lenkiefer</a>
  
 <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</span>
• <script src="//platform.linkedin.com/in.js" type="text/javascript"></script>
<script type="IN/MemberProfile" data-id="https://www.linkedin.com/pub/leonard-kiefer/31/753/511" data-format="click" data-related="false" data-text="Leonard Kiefer"></script>
  • lenkiefer@hotmail.com
           </p>
      </div>
    </div>
    





<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66905937-1', 'auto');
  ga('send', 'pageview');

</script>

    <!-- Latest compiled and minified JavaScript, requires jQuery 1.x (2.x not supported in IE8) -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="/assets/themes/lentheme/bootstrap/js/bootstrap.min.js"></script>
  </body>
</html>





