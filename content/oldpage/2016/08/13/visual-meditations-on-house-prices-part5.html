
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Visual meditations on house prices, Part 5: distributions</title>
    
    <meta name="author" content="Len Kiefer">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap styles -->
    <link href="/assets/themes/lentheme/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Optional theme -->
    <link href="/assets/themes/lentheme/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet">
    <!-- Sticky Footer -->
    <link href="/assets/themes/lentheme/bootstrap/css/bs-sticky-footer.css" rel="stylesheet">
    
    <!-- Custom styles -->
    <link href="/assets/themes/lentheme/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!-- Update these with your own images
      <link rel="shortcut icon" href="images/favicon.ico">
      <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div id="wrap">
      <nav class="navbar navbar-default" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#jb-navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/"><span class="icon-home3" style="font-size:24px"> Len Kiefer</a></span>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="jb-navbar-collapse" style="font-size:24px">
          <ul class="nav navbar-nav" >
        <li><a href="/archive.html"><span class="icon-newspaper"> Posts</a></span></li>
            <!-- li><a href="/chartbook/index.html"><span class="icon-display"> Chartbook</a></span></li-->
         <li><a href="/resume.html"><span class="icon-profile"> Resume</span></a></li>
        <li><a href="/about.html"><span class="icon-user-tie"> About</span></a></li>
          </ul>
        </div><!-- /.navbar-collapse -->
      </nav>

      <div class="container">
        
<div class="page-header">
  <h1>Visual meditations on house prices, Part 5: distributions </h1>
</div>

<div class="row post-full">
  <div class="col-xs-12">
    <div class="date">
      <span>13 August 2016</span>
    </div>
    <div class="content">
      <p>OVER THE PAST THREE MONTHS I HAVE MADE several new house price visualizations.  In these meditations I’ll consider some recent graphs and provide R code for them.  For reference, prior meditations are available at:</p>

<ul>
  <li><a href="/2016/05/08/visual-meditations-on-house-prices-part1">Part 1: data wrangling </a></li>
  <li><a href="/2016/05/08/visual-meditations-on-house-prices-part2">Part 2: sparklines and dots (animated) </a></li>
  <li><a href="/2016/05/10/visual-meditations-on-house-prices-part3">Part 3: bubbles and bounce </a></li>
  <li><a href="/2016/05/14/visual-meditations-on-house-prices-part4">Part 4: graph gallery </a></li>
</ul>

<h1 id="meditation-1-median-sales-price-trends">Meditation 1: Median sales price trends</h1>

<p>Earlier this week, the National Association of Realtors (NAR) <a href="http://www.realtor.org/news-releases/2016/08/home-price-gains-unfettered-in-most-metro-areas-during-second-quarter">released</a> their quarterly update on metro area median house prices (data <a href="http://www.realtor.org/topics/metropolitan-median-area-prices-and-affordability">here</a>).  These data show trends in the median sales price of existing single family homes.</p>

<p>According to the NAR report, the national median sales price of an existing single family home was $240,700 in the second quarter of 2016, but there are vast differences in house prices across the country.  San Jose <a href="http://www.businessinsider.com/san-jose-median-home-price-1-million-2016-8">made news</a> by having a median sales prices that was over $1 million dollars.  On the other end of the spectrum, the median sales price in Youngstown, Ohio was just over $85,000.</p>

<p>In order to better understand the distribution of median sales prices, I constructed the following combination chart:</p>

<p><img src="/img/charts_aug_13_2016/nar dots 2016 q2 v2.gif" alt="nar combo" style="width: 550px;" /></p>

<p>The chart combines a slopegraph showing the trend in house prices from the second quarter of 2015 to the second quarter of 2016 and two histogram of house prices where the bars are replaced with dots representing each individual metro. By looking at the slopes on the left, you can see how house prices have trended across metros (mostly up) and by looking at the histogram on the right, you can compare how individual metros stack up relative to other markets in the country.  On the left I’ve created two histograms comparing 2015 Q2 to 2016Q2 so you can see how metros have moved in the median price distribution over time.</p>

<p>As there is a whole lot of data (180 metros), I use animation to highlight each individual metro one at a time.  I sorted the metros based on their place in the 2016 Q2 price distribution, starting from Youngstown and going up to San Jose.</p>

<h2 id="code-for-plot">Code for plot</h2>

<p>In order to construct this plot using R we’ll need to combine multiple graphs on a single page. Fortunately, the <a href="http://www.cookbook-r.com/Graphs/Multiple_graphs_on_one_page_(ggplot2)/">Cookbook for R has code for this</a>.  By using the multiplot function in the link above, we can easily combine two plots into one page.</p>

<p>The data from NAR comes in a spreadsheet, but we’re going to have to change it.  From this:</p>

<p><img src="/img/charts_aug_13_2016/nar before.PNG" alt="nar before" style="width: 550px;" /></p>

<p>to this:</p>

<p><img src="/img/charts_aug_13_2016/nar after.PNG" alt="nar after" style="width: 550px;" /></p>

<p>I tried to manipulate the data in R, but the headers and formatting of the spreadsheet made it seem more trouble than it was worth, so I transformed the data using <span class="icon-file-excel" style="color:green;"></span> excel. See <a href="/2016/05/08/visual-meditations-on-house-prices-part1">this post</a> for details.</p>

<h3 id="slopegraph">Slopegraph</h3>

<p>The slopegraph is a line plot with two points.  In this case, the median price in 2015Q2 and in 2016Q2.  We’ll arrange the dates on the x axis and have the price displayed on the y axis.  We’ll use a logarithmic scale for the y axis, so the slopes of the lines will approximate the percentage change in the median price.</p>

<p>We’ll call out the United State median sales price by overlaying a red line on tope of gray lines representing each individual metro area.  In the animation we’ll loop through each metro and update the histogram.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#Load some packages... 
</span><span class="n">library</span><span class="p">(</span><span class="n">data.table</span><span class="p">,</span> <span class="n">warn.conflicts</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">,</span> <span class="n">warn.conflicts</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>  <span class="c1">#Using the development version for captions/subtitles
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">,</span> <span class="n">warn.conflicts</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">zoo</span><span class="p">,</span> <span class="n">warn.conflicts</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">ggthemes</span><span class="p">,</span> <span class="n">warn.conflicts</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">scales</span><span class="p">,</span> <span class="n">warn.conflicts</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">animation</span><span class="p">,</span> <span class="n">warn.conflicts</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">tidyr</span><span class="p">,</span> <span class="n">warn.conflicts</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">ggrepel</span><span class="p">,</span> <span class="n">warn.conflicts</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">tweenr</span><span class="p">,</span> <span class="n">warn.conflicts</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>

<span class="c1">#Load some data that looks like the image above:
</span><span class="n">ndata</span> <span class="o">&lt;-</span> <span class="n">fread</span><span class="p">(</span><span class="s2">"data/nar2016q2.txt"</span><span class="p">)</span>
<span class="n">ndata</span><span class="o">$</span><span class="n">date</span><span class="o">&lt;-</span><span class="n">as.Date</span><span class="p">(</span><span class="n">ndata</span><span class="o">$</span><span class="n">date</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s2">"%m/%d/%Y"</span><span class="p">)</span>  <span class="c1">#set dates
</span><span class="n">ndata</span><span class="o">&lt;-</span><span class="n">transform</span><span class="p">(</span><span class="n">ndata</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">as.numeric</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>  <span class="c1">#force value to be numeric
</span><span class="n">ndata</span><span class="p">[,</span><span class="n">myjust</span><span class="o">:=</span><span class="n">ifelse</span><span class="p">(</span><span class="n">id</span><span class="o">==</span><span class="s2">"2016.II"</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">)]</span>           <span class="c1">#used to align text labels, left label right aligned, right label left aligned
</span>
<span class="c1">#create the plot
</span>
<span class="n">g.slope</span><span class="o">&lt;-</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">ndata</span><span class="p">[</span><span class="n">code</span><span class="o">==</span><span class="s2">"US"</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">id</span><span class="o">==</span><span class="s2">"2015.II"</span><span class="o">|</span><span class="n">id</span><span class="o">==</span><span class="s2">"2016.II"</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">type</span><span class="o">==</span><span class="s2">"level"</span><span class="p">,],</span>
       <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">id</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">value</span><span class="p">,</span><span class="n">group</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">paste</span><span class="p">(</span><span class="s2">" "</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="s2">"\n"</span><span class="p">,</span><span class="n">dollar</span><span class="p">(</span><span class="n">round</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="m">0</span><span class="p">)),</span><span class="s2">"k "</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">""</span><span class="p">)))</span><span class="o">+</span>
  <span class="c1">#we need to group by metros, and create a label
</span>  
  <span class="c1">#create gray lines for each metro
</span>  <span class="n">geom_path</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">ndata</span><span class="p">[</span><span class="n">code</span><span class="o">==</span><span class="s2">"metro"</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">id</span><span class="o">==</span><span class="s2">"2015.II"</span><span class="o">|</span><span class="n">id</span><span class="o">==</span><span class="s2">"2016.II"</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">type</span><span class="o">==</span><span class="s2">"level"</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s2">"gray"</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.7</span><span class="p">)</span><span class="o">+</span>
  <span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">ndata</span><span class="p">[</span><span class="n">code</span><span class="o">==</span><span class="s2">"metro"</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">id</span><span class="o">==</span><span class="s2">"2015.II"</span><span class="o">|</span><span class="n">id</span><span class="o">==</span><span class="s2">"2016.II"</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">type</span><span class="o">==</span><span class="s2">"level"</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s2">"gray"</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.7</span><span class="p">)</span><span class="o">+</span>
  <span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span>
  
  <span class="c1">#create a red line for the U.S.
</span>  <span class="n">geom_path</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span><span class="o">+</span><span class="n">geom_text</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="n">aes</span><span class="p">(</span><span class="n">hjust</span><span class="o">=</span><span class="n">myjust</span><span class="p">))</span><span class="o">+</span><span class="n">scale_y_log10</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">100</span><span class="p">,</span><span class="m">1100</span><span class="p">,</span><span class="m">100</span><span class="p">))</span><span class="o">+</span>
  <span class="n">geom_point</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="o">+</span>
  <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"quarter"</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s2">"Median sales price (Ths $, log scale)"</span><span class="p">,</span><span class="n">subtitle</span><span class="o">=</span><span class="s2">"Median sales price of existing single family home"</span><span class="p">,</span>
       <span class="n">caption</span><span class="o">=</span><span class="s2">"@lenkiefer Source: NAR each line a metro area"</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s2">"Change in house prices 2015Q2 to 2016Q2"</span><span class="p">)</span><span class="o">+</span>
 <span class="n">theme</span><span class="p">(</span><span class="n">plot.caption</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">10</span><span class="p">,</span> <span class="n">hjust</span><span class="o">=</span><span class="m">0</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="m">15</span><span class="p">)))</span>

<span class="n">g.slope</span></code></pre></figure>

<p><img src="/img/Rfig/fig-nar-slopes-1.svg" alt="plot of chunk fig-nar-slopes" /></p>

<h3 id="create-the-histograms">Create the histograms</h3>

<p>In order to create the histograms we’re going to have build them ourselves.  Our strategy will be to place each metro in a bin corresponding to a range of house prices (say from $75,000 to $100,000), and then count up how many metros are in each bin.  So far, that’s just like a standard histogram. But as we’re going to draw a dot for each metro area, we have to assign a y axis value for each metro.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">d</span><span class="o">&lt;-</span><span class="n">ndata</span><span class="p">[</span><span class="n">code</span><span class="o">==</span><span class="s2">"metro"</span><span class="o">&amp;</span> <span class="n">id</span><span class="o">==</span><span class="s2">"2016.II"</span> <span class="o">&amp;</span> <span class="n">type</span><span class="o">==</span><span class="s2">"level"</span> <span class="o">&amp;</span> <span class="n">value</span><span class="o">&gt;</span><span class="m">0</span><span class="p">,]</span>
<span class="n">myhist</span><span class="o">&lt;-</span><span class="n">hist</span><span class="p">(</span><span class="n">d</span><span class="o">$</span><span class="n">value</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="n">FALSE</span><span class="p">,</span> <span class="n">breaks</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1100</span><span class="p">,</span><span class="m">25</span><span class="p">)</span> <span class="p">)</span> <span class="c1">#construct a histogram
</span>
<span class="n">N</span><span class="o">&lt;-</span><span class="n">length</span><span class="p">(</span><span class="n">myhist</span><span class="o">$</span><span class="n">mids</span><span class="p">)</span>  <span class="c1">#how many bins in the histogram
</span><span class="n">d</span><span class="o">&lt;-</span><span class="n">d</span><span class="p">[</span><span class="n">order</span><span class="p">(</span><span class="n">value</span><span class="p">),]</span>  <span class="c1">#sort the data by median house prices
</span>
<span class="n">myindex</span><span class="o">&lt;</span><span class="m">-0</span>  <span class="c1">#initialize
</span><span class="n">d</span><span class="o">$</span><span class="n">counter</span><span class="o">&lt;</span><span class="m">-0</span>  <span class="c1">#initialize y axis counter
</span><span class="n">g1</span><span class="o">&lt;-</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data.frame</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">myhist</span><span class="o">$</span><span class="n">mids</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">y</span><span class="o">=</span><span class="n">j</span><span class="p">),</span>
          <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">))</span><span class="o">+</span><span class="n">theme_minimal</span><span class="p">()</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">1</span><span class="o">:</span><span class="n">N</span><span class="p">){</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="k">in</span> <span class="m">1</span><span class="o">:</span><span class="n">myhist</span><span class="o">$</span><span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
  <span class="p">{</span><span class="k">if</span> <span class="p">(</span><span class="n">myhist</span><span class="o">$</span><span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="m">0</span><span class="p">){</span>
    <span class="n">myindex</span><span class="o">&lt;-</span><span class="n">myindex</span><span class="m">+1</span> <span class="c1">#iterate counter
</span>    <span class="n">d</span><span class="p">[</span><span class="n">myindex</span><span class="p">,</span> <span class="n">counter</span><span class="o">:=</span><span class="n">j</span><span class="p">]</span>  <span class="c1">#set y = j
</span>    <span class="n">d</span><span class="p">[</span><span class="n">myindex</span><span class="p">,</span> <span class="n">vbin</span><span class="o">:=</span><span class="n">myhist</span><span class="o">$</span><span class="n">mids</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>  <span class="c1"># append bin value for this price
</span>    <span class="n">g1</span><span class="o">&lt;-</span><span class="n">g1</span><span class="o">+</span><span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data.frame</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">myhist</span><span class="o">$</span><span class="n">mids</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">y</span><span class="o">=</span><span class="n">j</span><span class="p">),</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"gray"</span><span class="p">)}</span>  <span class="c1">#add dot to plot
</span>  <span class="p">}}</span>
<span class="n">g1</span><span class="o">&lt;-</span><span class="n">g1</span><span class="o">+</span><span class="n">scale_x_continuous</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1150</span><span class="p">),</span><span class="n">breaks</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1100</span><span class="p">,</span><span class="m">100</span><span class="p">))</span><span class="o">+</span>
  <span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">40</span><span class="p">))</span><span class="o">+</span>
  <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Median Sales Price of Existing Single-Family Homes (Ths $)"</span><span class="p">,</span>
       <span class="n">y</span><span class="o">=</span><span class="s2">"count of metros"</span><span class="p">,</span>
       <span class="n">title</span><span class="o">=</span><span class="s2">"Home sales price distribution 2016 Q2"</span><span class="p">,</span>
              <span class="n">caption</span><span class="o">=</span><span class="s2">"@lenkiefer Source: NAR each dot a metro area"</span><span class="p">)</span><span class="o">+</span>
 <span class="n">theme</span><span class="p">(</span><span class="n">plot.caption</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">10</span><span class="p">,</span> <span class="n">hjust</span><span class="o">=</span><span class="m">0</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="m">15</span><span class="p">)))</span>
<span class="n">g1</span></code></pre></figure>

<p><img src="/img/Rfig/fig-nar-dot-1-1.svg" alt="plot of chunk fig-nar-dot-1" /></p>

<h3 id="combine-the-plots">Combine the plots</h3>

<p>Now we’ll used the <a href="http://www.cookbook-r.com/Graphs/Multiple_graphs_on_one_page_(ggplot2)/">multiplot function</a> to combine the plots. We’ll also make another histogram so we can compare the distribution of median house sales prices in 2016Q2 to the distribution in 2015Q2.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">source</span><span class="p">(</span><span class="s2">"code/multiplot.R"</span><span class="p">)</span> <span class="c1">#include the multiplot function
</span>
<span class="c1">#Recreate the histogram for 2015Q2:
</span>
<span class="n">d2</span><span class="o">&lt;-</span><span class="n">ndata</span><span class="p">[</span><span class="n">code</span><span class="o">==</span><span class="s2">"metro"</span><span class="o">&amp;</span> <span class="n">id</span><span class="o">==</span><span class="s2">"2015.II"</span> <span class="o">&amp;</span> <span class="n">type</span><span class="o">==</span><span class="s2">"level"</span> <span class="o">&amp;</span> <span class="n">value</span><span class="o">&gt;</span><span class="m">0</span><span class="p">,]</span>
<span class="n">myhist</span><span class="o">&lt;-</span><span class="n">hist</span><span class="p">(</span><span class="n">d2</span><span class="o">$</span><span class="n">value</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="n">FALSE</span><span class="p">,</span> <span class="n">breaks</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1100</span><span class="p">,</span><span class="m">25</span><span class="p">)</span> <span class="p">)</span>
<span class="n">N</span><span class="o">&lt;-</span><span class="n">length</span><span class="p">(</span><span class="n">myhist</span><span class="o">$</span><span class="n">mids</span><span class="p">)</span>
<span class="n">g2</span><span class="o">&lt;-</span><span class="n">ggplot</span><span class="p">()</span>
<span class="n">d2</span><span class="o">&lt;-</span><span class="n">d2</span><span class="p">[</span><span class="n">order</span><span class="p">(</span><span class="n">value</span><span class="p">),]</span>
<span class="n">myindex</span><span class="o">&lt;</span><span class="m">-0</span>
<span class="n">d2</span><span class="o">$</span><span class="n">counter</span><span class="o">&lt;</span><span class="m">-0</span>
<span class="n">g2</span><span class="o">&lt;-</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data.frame</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">myhist</span><span class="o">$</span><span class="n">mids</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">y</span><span class="o">=</span><span class="n">j</span><span class="p">),</span>
          <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">))</span><span class="o">+</span><span class="n">theme_minimal</span><span class="p">()</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">1</span><span class="o">:</span><span class="n">N</span><span class="p">){</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="k">in</span> <span class="m">1</span><span class="o">:</span><span class="n">myhist</span><span class="o">$</span><span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
  <span class="p">{</span><span class="k">if</span> <span class="p">(</span><span class="n">myhist</span><span class="o">$</span><span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="m">0</span><span class="p">){</span>
    <span class="n">myindex</span><span class="o">&lt;-</span><span class="n">myindex</span><span class="m">+1</span>
    <span class="n">d2</span><span class="p">[</span><span class="n">myindex</span><span class="p">,</span> <span class="n">counter</span><span class="o">:=</span><span class="n">j</span><span class="p">]</span>
    <span class="n">d2</span><span class="p">[</span><span class="n">myindex</span><span class="p">,</span> <span class="n">vbin</span><span class="o">:=</span><span class="n">myhist</span><span class="o">$</span><span class="n">mids</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
    <span class="n">g2</span><span class="o">&lt;-</span><span class="n">g2</span><span class="o">+</span><span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data.frame</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">myhist</span><span class="o">$</span><span class="n">mids</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">y</span><span class="o">=</span><span class="n">j</span><span class="p">),</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"gray"</span><span class="p">)}</span>
  <span class="p">}}</span>



<span class="n">g2</span><span class="o">&lt;-</span><span class="n">g2</span><span class="o">+</span><span class="n">scale_x_continuous</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1150</span><span class="p">),</span><span class="n">breaks</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1100</span><span class="p">,</span><span class="m">100</span><span class="p">))</span><span class="o">+</span>
  <span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">40</span><span class="p">))</span><span class="o">+</span>
  <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Median Sales Price of Existing Single-Family Homes (Ths $)"</span><span class="p">,</span>
       <span class="n">y</span><span class="o">=</span><span class="s2">"count of metros"</span><span class="p">,</span>
       <span class="n">title</span><span class="o">=</span><span class="s2">"Home sales price distribution 2015 Q2"</span><span class="p">)</span>

<span class="c1">#Create the multiplot 
#We use a matrix layout to make the slopegraph two units tall and the histograms 1 in a 2x2 layout:
</span>
<span class="n">multiplot</span><span class="p">(</span><span class="n">g2</span><span class="o">+</span><span class="n">theme</span><span class="p">(</span><span class="n">axis.text</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">6</span><span class="p">),</span><span class="n">axis.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">7</span><span class="p">)),</span> <span class="c1">#shrink axis text and labels
</span>          <span class="n">g1</span><span class="o">+</span><span class="n">theme</span><span class="p">(</span><span class="n">axis.text</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">6</span><span class="p">),</span><span class="n">axis.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">7</span><span class="p">)),</span>
          <span class="n">g.slope</span><span class="o">+</span><span class="n">labs</span><span class="p">(</span><span class="n">caption</span><span class="o">=</span><span class="s2">"@lenkiefer Source: NAR each dot/line a metro area"</span><span class="p">),</span><span class="n">layout</span><span class="o">=</span><span class="n">matrix</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">2</span><span class="p">),</span> <span class="n">nrow</span><span class="o">=</span><span class="m">2</span><span class="p">,</span> <span class="n">byrow</span><span class="o">=</span><span class="n">TRUE</span><span class="p">))</span></code></pre></figure>

<p><img src="/img/Rfig/fig-nar-combo-1-1.svg" alt="plot of chunk fig-nar-combo-1" /></p>

<h3 id="add-animation">add animation</h3>

<p>Now we want to highlight each individual metro area.  To do so, we’ll construct an animated gif where we highlight each metro one at time.  The code below generates the animated gif:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">mlist</span><span class="o">&lt;-</span><span class="n">unique</span><span class="p">(</span><span class="n">d</span><span class="o">$</span><span class="n">name</span><span class="p">)</span>  <span class="c1">#get a unique list of metros, ordered by median prices in 2016Q2
</span>
<span class="n">oopt</span> <span class="o">=</span> <span class="n">ani.options</span><span class="p">(</span><span class="n">interval</span> <span class="o">=</span> <span class="m">0.3</span><span class="p">)</span>
<span class="n">saveGIF</span><span class="p">({</span><span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="n">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="n">length</span><span class="p">(</span><span class="n">mlist</span><span class="p">),</span><span class="m">1</span><span class="p">)</span> <span class="p">){</span>
<span class="n">g3</span><span class="o">&lt;-</span>
  <span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">ndata</span><span class="p">[</span><span class="n">name</span><span class="o">==</span><span class="n">mlist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">id</span><span class="o">==</span><span class="s2">"2015.II"</span><span class="o">|</span><span class="n">id</span><span class="o">==</span><span class="s2">"2016.II"</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">type</span><span class="o">==</span><span class="s2">"level"</span><span class="p">,],</span>
         <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">id</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">value</span><span class="p">,</span><span class="n">group</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">paste</span><span class="p">(</span><span class="s2">" $"</span><span class="p">,</span><span class="n">round</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="s2">"k "</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">""</span><span class="p">)))</span><span class="o">+</span>
  <span class="n">geom_path</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">ndata</span><span class="p">[</span><span class="n">code</span><span class="o">==</span><span class="s2">"metro"</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">id</span><span class="o">==</span><span class="s2">"2015.II"</span><span class="o">|</span><span class="n">id</span><span class="o">==</span><span class="s2">"2016.II"</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">type</span><span class="o">==</span><span class="s2">"level"</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s2">"gray"</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.7</span><span class="p">)</span><span class="o">+</span>
  <span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">ndata</span><span class="p">[</span><span class="n">code</span><span class="o">==</span><span class="s2">"metro"</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">id</span><span class="o">==</span><span class="s2">"2015.II"</span><span class="o">|</span><span class="n">id</span><span class="o">==</span><span class="s2">"2016.II"</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">type</span><span class="o">==</span><span class="s2">"level"</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s2">"gray"</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.7</span><span class="p">)</span><span class="o">+</span>
  <span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span>
  <span class="n">geom_path</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span><span class="o">+</span><span class="n">geom_text</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="n">aes</span><span class="p">(</span><span class="n">hjust</span><span class="o">=</span><span class="n">myjust</span><span class="p">))</span><span class="o">+</span><span class="n">scale_y_log10</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">100</span><span class="p">,</span><span class="m">1100</span><span class="p">,</span><span class="m">100</span><span class="p">))</span><span class="o">+</span>
  <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"quarter"</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s2">"Median sales price (Ths $, log scale)"</span><span class="p">,</span><span class="n">subtitle</span><span class="o">=</span><span class="n">mlist</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
       <span class="n">caption</span><span class="o">=</span><span class="s2">"@lenkiefer Source: NAR"</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s2">"Change in house prices 2015Q2 to 2016Q2"</span><span class="p">)</span><span class="o">+</span>
  <span class="n">theme</span><span class="p">(</span><span class="n">plot.subtitle</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">))</span><span class="o">+</span> <span class="n">theme</span><span class="p">(</span><span class="n">plot.caption</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">10</span><span class="p">,</span> <span class="n">hjust</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="m">15</span><span class="p">)))</span><span class="o">+</span>
  <span class="n">geom_point</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>

<span class="n">multiplot</span><span class="p">(</span><span class="n">g2</span><span class="o">+</span>  <span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">d2</span><span class="p">[</span><span class="n">name</span><span class="o">==</span><span class="n">mlist</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">vbin</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">counter</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span><span class="o">+</span>
            <span class="n">labs</span><span class="p">(</span><span class="n">subtitle</span><span class="o">=</span><span class="n">mlist</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">+</span><span class="n">theme</span><span class="p">(</span><span class="n">plot.subtitle</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">))</span><span class="o">+</span>
            <span class="n">theme</span><span class="p">(</span><span class="n">axis.text</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">6</span><span class="p">),</span><span class="n">axis.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">7</span><span class="p">)),</span>
          <span class="n">g1</span><span class="o">+</span>  <span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="n">name</span><span class="o">==</span><span class="n">mlist</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">vbin</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">counter</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span><span class="o">+</span>
            <span class="n">labs</span><span class="p">(</span><span class="n">subtitle</span><span class="o">=</span><span class="n">mlist</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">+</span><span class="n">theme</span><span class="p">(</span><span class="n">plot.subtitle</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">))</span><span class="o">+</span>
            <span class="n">theme</span><span class="p">(</span><span class="n">axis.text</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">6</span><span class="p">),</span><span class="n">axis.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">7</span><span class="p">))</span> <span class="p">,</span>
          <span class="n">g3</span><span class="o">+</span><span class="n">theme</span><span class="p">(</span><span class="n">axis.text</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">6</span><span class="p">),</span><span class="n">axis.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">7</span><span class="p">))</span>
          <span class="p">,</span><span class="n">layout</span><span class="o">=</span><span class="n">matrix</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">2</span><span class="p">),</span> <span class="n">nrow</span><span class="o">=</span><span class="m">2</span><span class="p">,</span> <span class="n">byrow</span><span class="o">=</span><span class="n">TRUE</span><span class="p">))</span>
<span class="n">ani.pause</span><span class="p">()</span>
<span class="n">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="p">}</span>
<span class="p">},</span><span class="n">movie.name</span><span class="o">=</span><span class="s2">"nar dots 2016 q2 v2.gif"</span><span class="p">,</span><span class="n">ani.width</span> <span class="o">=</span> <span class="m">1000</span><span class="p">,</span> <span class="n">ani.height</span> <span class="o">=</span> <span class="m">650</span><span class="p">)</span></code></pre></figure>

<p>Run it and you get our plot:</p>

<p><img src="/img/charts_aug_13_2016/nar dots 2016 q2 v2.gif" alt="nar combo" style="width: 550px;" /></p>

<h1 id="meditation-2-changes-in-the-distribution-of-house-price-appreciation">Meditation 2: Changes in the Distribution of House Price Appreciation</h1>

<p>The NAR data only goes back to 2015Q2, but how has the metro level distribution of house prices changed over the last 10 years or so?  In this section we’ll consider a graph I constructed using the Freddie Mac House Price Index (FMHPI), which is available to the public on <a href="http://www.freddiemac.com/finance/house_price_index.html">Freddie Mac’s webpage</a> and goes back to the 1970s for over 300 metro areas.</p>

<p>The data I’m going to use is an updated version of the files <em>fmhpi2.txt</em> I described in <a href="/2016/05/08/visual-meditations-on-house-prices-part1">Part 1: data wrangling </a>.</p>

<p>For the animation we’ll also be using the tweenr package, which I’ve written about before. See my earlier <a href="/2016/05/29/improving-R-animated-gifs-with-tweenr">post about tweenr</a> for an introduction, and more examples <a href="/2016/05/30/more-tweenr-animations">here</a> and <a href="/2016/06/26/week-in-review">here</a>.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#load data
</span><span class="n">metrodata</span> <span class="o">&lt;-</span> <span class="n">fread</span><span class="p">(</span><span class="s2">"data/fmhpi4.txt"</span><span class="p">)</span>  <span class="c1">#updated fmhpi file
</span><span class="n">metrodata</span><span class="o">$</span><span class="n">date</span><span class="o">&lt;-</span><span class="n">as.Date</span><span class="p">(</span><span class="n">metrodata</span><span class="o">$</span><span class="n">date</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s2">"%m/%d/%Y"</span><span class="p">)</span>
<span class="n">metrodata</span><span class="o">&lt;-</span><span class="n">metrodata</span><span class="p">[,</span><span class="n">hpa12</span><span class="o">:=</span><span class="n">c</span><span class="p">(</span><span class="n">rep</span><span class="p">(</span><span class="n">NA</span><span class="p">,</span><span class="m">12</span><span class="p">),((</span><span class="m">1</span><span class="o">+</span><span class="n">diff</span><span class="p">(</span><span class="n">hpi</span><span class="p">,</span><span class="m">12</span><span class="p">)</span><span class="o">/</span><span class="n">hpi</span><span class="p">))</span><span class="o">^</span><span class="m">1</span><span class="p">)</span><span class="m">-1</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="n">metro</span><span class="p">]</span>  

<span class="c1">#make a function to create a dot histogram, similar to above
</span><span class="n">myf</span><span class="o">&lt;-</span><span class="k">function</span><span class="p">(</span><span class="n">mydate</span><span class="p">){</span>
<span class="n">d</span><span class="o">&lt;-</span><span class="n">mdata</span><span class="p">[</span><span class="n">date</span><span class="o">==</span><span class="n">mydate</span><span class="p">,]</span>
<span class="n">myhist</span><span class="o">&lt;-</span><span class="n">hist</span><span class="p">(</span><span class="n">d</span><span class="o">$</span><span class="n">hpa12</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="n">FALSE</span><span class="p">,</span> <span class="n">breaks</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">-.45</span><span class="p">,</span><span class="m">62</span><span class="p">,</span><span class="m">.005</span><span class="p">)</span> <span class="p">)</span>
<span class="n">N</span><span class="o">&lt;-</span><span class="n">length</span><span class="p">(</span><span class="n">myhist</span><span class="o">$</span><span class="n">mids</span><span class="p">)</span>
<span class="n">d</span><span class="o">&lt;-</span><span class="n">d</span><span class="p">[</span><span class="n">order</span><span class="p">(</span><span class="n">hpa12</span><span class="p">),]</span>
<span class="n">myindex</span><span class="o">&lt;</span><span class="m">-0</span>
<span class="n">d</span><span class="o">$</span><span class="n">counter</span><span class="o">&lt;</span><span class="m">-0</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">1</span><span class="o">:</span><span class="n">N</span><span class="p">){</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="k">in</span> <span class="m">1</span><span class="o">:</span><span class="n">myhist</span><span class="o">$</span><span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
  <span class="p">{</span><span class="k">if</span> <span class="p">(</span><span class="n">myhist</span><span class="o">$</span><span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="m">0</span><span class="p">){</span>
    <span class="n">myindex</span><span class="o">&lt;-</span><span class="n">myindex</span><span class="m">+1</span>
    <span class="n">d</span><span class="p">[</span><span class="n">myindex</span><span class="p">,</span> <span class="n">counter</span><span class="o">:=</span><span class="n">j</span><span class="p">]</span>
    <span class="n">d</span><span class="p">[</span><span class="n">myindex</span><span class="p">,</span> <span class="n">vbin</span><span class="o">:=</span><span class="n">myhist</span><span class="o">$</span><span class="n">mids</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
  <span class="p">}}}</span>
<span class="n">d</span><span class="o">$</span><span class="n">date</span><span class="o">&lt;-</span><span class="n">factor</span><span class="p">(</span><span class="n">d</span><span class="o">$</span><span class="n">date</span><span class="p">)</span>
<span class="n">d.out</span><span class="o">&lt;-</span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">d</span><span class="p">[,</span> <span class="n">list</span><span class="p">(</span><span class="n">date</span><span class="p">,</span><span class="n">vbin</span><span class="p">,</span><span class="n">counter</span><span class="p">,</span><span class="n">hpa12</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">region</span><span class="p">,</span><span class="n">metro</span><span class="p">)])</span>
<span class="k">return</span><span class="p">(</span><span class="n">d.out</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">#create a plot using our function
</span>
<span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">myf</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">metrodata</span><span class="p">[</span><span class="n">year</span><span class="o">==</span><span class="m">2016</span> <span class="o">&amp;</span> <span class="n">month</span><span class="o">==</span><span class="m">6</span><span class="p">,]</span><span class="o">$</span><span class="n">date</span><span class="p">)),</span>
           <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">vbin</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">counter</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">metro</span><span class="p">))</span><span class="o">+</span><span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"#00B0F0"</span><span class="p">)</span><span class="o">+</span><span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span>
    <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Annual House Price Growth (Y/Y % change, NSA index)"</span><span class="p">,</span>
         <span class="n">y</span><span class="o">=</span><span class="s2">"Count of Metros"</span><span class="p">,</span>
         <span class="n">title</span><span class="o">=</span><span class="s2">"Metro House Price Distribution"</span><span class="p">,</span>
         <span class="n">caption</span><span class="o">=</span><span class="s2">"@lenkiefer Source: Freddie Mac House Price Index. Each dot a metro area"</span><span class="p">,</span>
         <span class="n">subtitle</span><span class="o">=</span><span class="n">format</span><span class="p">(</span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"2016-06-01"</span><span class="p">),</span><span class="s2">"%b-%Y"</span><span class="p">))</span><span class="o">+</span>
    <span class="n">coord_cartesian</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">-0.2</span><span class="p">,</span><span class="m">.2</span><span class="p">),</span><span class="n">ylim</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">35</span><span class="p">))</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">16</span><span class="p">))</span><span class="o">+</span>
    <span class="n">scale_x_continuous</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">percent</span><span class="p">,</span><span class="n">breaks</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">-.4</span><span class="p">,</span><span class="m">.4</span><span class="p">,</span><span class="m">.1</span><span class="p">))</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.caption</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">hjust</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">vjust</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="m">10</span><span class="p">)))</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">legend.justification</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">),</span> <span class="n">legend.position</span><span class="o">=</span><span class="s2">"top"</span><span class="p">)</span></code></pre></figure>

<p><img src="/img/Rfig/fig-nar-fmhpi-dots-1-1.svg" alt="plot of chunk fig-nar-fmhpi-dots-1" /></p>

<h2 id="adding-animation">Adding animation</h2>

<p>We want to compare how the distribution of annual house price growth has shifted from 2006 to 2016. We’ll compare the annual appreciation in June of each year.  We’ll also use tweenr to have the dots smoothly transition between years.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">dlist</span><span class="o">&lt;-</span><span class="n">unique</span><span class="p">(</span><span class="n">metrodata</span><span class="p">[</span><span class="n">year</span><span class="o">&gt;</span><span class="m">2005</span> <span class="o">&amp;</span> <span class="n">month</span><span class="o">==</span><span class="m">6</span><span class="p">,]</span><span class="o">$</span><span class="n">date</span><span class="p">)</span>  <span class="c1">#generate a list of dates
</span><span class="n">my.list2</span><span class="o">&lt;-</span><span class="n">lapply</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="n">dlist</span><span class="p">,</span><span class="n">min</span><span class="p">(</span><span class="n">dlist</span><span class="p">)),</span><span class="n">myf</span><span class="p">)</span>  <span class="c1">#apply our function to our list of dates
</span>
<span class="c1">#use tweenr to interploate
</span><span class="n">tf</span> <span class="o">&lt;-</span> <span class="n">tween_states</span><span class="p">(</span><span class="n">my.list2</span><span class="p">,</span><span class="n">tweenlength</span><span class="o">=</span> <span class="m">3</span><span class="p">,</span> <span class="n">statelength</span><span class="o">=</span><span class="m">1</span><span class="p">,</span> <span class="n">ease</span><span class="o">=</span><span class="n">rep</span><span class="p">(</span><span class="s1">'cubic-in-out'</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="n">nframes</span><span class="o">=</span><span class="m">200</span><span class="p">)</span>
<span class="n">tf</span><span class="o">&lt;-</span><span class="n">data.table</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">tf</span><span class="p">))</span> <span class="c1">#convert output into data table
</span>
<span class="n">oopt</span> <span class="o">=</span> <span class="n">ani.options</span><span class="p">(</span><span class="n">interval</span> <span class="o">=</span> <span class="m">0.15</span><span class="p">)</span>
<span class="n">saveGIF</span><span class="p">({</span><span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">1</span><span class="o">:</span><span class="n">max</span><span class="p">(</span><span class="n">tf</span><span class="o">$</span><span class="n">.frame</span><span class="p">))</span> <span class="p">{</span> <span class="c1">#loop over frames
</span>  <span class="n">g</span><span class="o">&lt;-</span>
    <span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">tf</span><span class="p">[</span><span class="n">.frame</span><span class="o">==</span><span class="n">i</span><span class="p">,],</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">vbin</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">counter</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">metro</span><span class="p">))</span><span class="o">+</span><span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.75</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"#00B0F0"</span><span class="p">)</span><span class="o">+</span><span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span>
    <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Annual House Price Growth (Y/Y % change, NSA index)"</span><span class="p">,</span>
         <span class="n">y</span><span class="o">=</span><span class="s2">"Count of Metros"</span><span class="p">,</span>
         <span class="n">title</span><span class="o">=</span><span class="s2">"Metro House Price Distribution"</span><span class="p">,</span>
         <span class="n">caption</span><span class="o">=</span><span class="s2">"@lenkiefer Source: Freddie Mac House Price Index. Each dot a metro area"</span><span class="p">,</span>
         <span class="n">subtitle</span><span class="o">=</span><span class="n">unique</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="n">as.Date</span><span class="p">(</span><span class="n">tf</span><span class="p">[</span><span class="n">.frame</span><span class="o">==</span><span class="n">i</span><span class="p">]</span><span class="o">$</span><span class="n">date</span><span class="p">),</span> <span class="s2">"%b-%Y"</span><span class="p">)))</span><span class="o">+</span>
    <span class="n">coord_cartesian</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">-0.4</span><span class="p">,</span><span class="m">.4</span><span class="p">),</span><span class="n">ylim</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">41</span><span class="p">))</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">16</span><span class="p">))</span><span class="o">+</span>
    <span class="n">scale_x_continuous</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">percent</span><span class="p">,</span><span class="n">breaks</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">-.4</span><span class="p">,</span><span class="m">.4</span><span class="p">,</span><span class="m">.1</span><span class="p">))</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.caption</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">hjust</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">vjust</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="m">10</span><span class="p">)))</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">legend.justification</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">),</span> <span class="n">legend.position</span><span class="o">=</span><span class="s2">"top"</span><span class="p">)</span>
  <span class="n">print</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
  <span class="n">ani.pause</span><span class="p">()</span>
  <span class="n">print</span><span class="p">(</span><span class="n">i</span><span class="p">)}</span>
<span class="p">},</span><span class="n">movie.name</span><span class="o">=</span><span class="s2">"hpi dot tween aug 12 2016 portland highlight.gif"</span><span class="p">,</span><span class="n">ani.width</span> <span class="o">=</span> <span class="m">700</span><span class="p">,</span> <span class="n">ani.height</span> <span class="o">=</span> <span class="m">500</span><span class="p">)</span></code></pre></figure>

<p><img src="/img/charts_aug_13_2016/fmhpi tween jun 2006 to 2016.gif" alt="fmhpi dots combo" style="width: 550px;" /></p>

<h2 id="adding-a-time-series-plot-highlighting-individual-metros">Adding a time series plot, highlighting individual metros</h2>

<p>We can use multiplot again to combine the historgram with a line plot. In this case, we’ll loop through all the metro areas and compare the current year-over-year appreciation to the history of that metro from 2000 through 2016 (June).</p>

<p><img src="/img/charts_aug_13_2016/hpi dot combo dot line aug 2016.gif" alt="fmhpi dots combo 2" style="width: 550px;" /></p>

<p>Coder for this plot follows:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">d.out</span><span class="o">&lt;-</span><span class="n">myf</span><span class="p">(</span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"2016-06-01"</span><span class="p">))</span>  <span class="c1">#we'll just plot the data for June 2016
</span><span class="n">d.out</span><span class="o">&lt;-</span><span class="n">data.table</span><span class="p">(</span><span class="n">d.out</span><span class="p">)</span> <span class="c1">#make it a data table for ease of use
</span><span class="n">mlist0</span><span class="o">&lt;-</span><span class="n">unique</span><span class="p">(</span><span class="n">metrodata</span><span class="o">$</span><span class="n">metro</span><span class="p">)</span>  <span class="c1">#generate a list of metros
</span>
<span class="n">oopt</span> <span class="o">=</span> <span class="n">ani.options</span><span class="p">(</span><span class="n">interval</span> <span class="o">=</span> <span class="m">0.25</span><span class="p">)</span>
<span class="n">saveGIF</span><span class="p">({</span><span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">1</span><span class="o">:</span><span class="n">length</span><span class="p">(</span><span class="n">mlist0</span><span class="p">))</span> <span class="p">{</span>  <span class="c1">#loop over metros
</span>
<span class="n">g</span><span class="o">&lt;-</span>
  <span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">d.out</span><span class="p">,</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">vbin</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">counter</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">metro</span><span class="p">))</span><span class="o">+</span><span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.75</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"#00B0F0"</span><span class="p">)</span><span class="o">+</span>
  <span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span>

  <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Annual House Price Growth (Y/Y % change, NSA index)"</span><span class="p">,</span>
       <span class="n">y</span><span class="o">=</span><span class="s2">"Count of Metros"</span><span class="p">,</span>
       <span class="n">title</span><span class="o">=</span><span class="s2">"Metro House Price Appreciation Distribution"</span><span class="p">,</span>
       <span class="n">caption</span><span class="o">=</span><span class="s2">"@lenkiefer Source: Freddie Mac House Price Index. Each dot/line a metro area"</span><span class="p">,</span>
       <span class="n">subtitle</span><span class="o">=</span><span class="n">paste</span><span class="p">(</span><span class="s2">"(Y/Y % change) in"</span><span class="p">,</span><span class="n">unique</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="n">as.Date</span><span class="p">(</span><span class="n">d.out</span><span class="o">$</span><span class="n">date</span><span class="p">),</span> <span class="s2">"%b-%Y"</span><span class="p">))))</span><span class="o">+</span>
  <span class="n">coord_cartesian</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">-0.1</span><span class="p">,</span><span class="m">.20</span><span class="p">),</span><span class="n">ylim</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">35</span><span class="p">))</span><span class="o">+</span>
  <span class="n">theme</span><span class="p">(</span><span class="n">plot.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">16</span><span class="p">))</span><span class="o">+</span>
  <span class="n">scale_x_continuous</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">percent</span><span class="p">,</span><span class="n">breaks</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">-.4</span><span class="p">,</span><span class="m">.4</span><span class="p">,</span><span class="m">.1</span><span class="p">))</span><span class="o">+</span>
  <span class="n">theme</span><span class="p">(</span><span class="n">plot.caption</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">hjust</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">vjust</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="m">10</span><span class="p">)))</span><span class="o">+</span>
  <span class="n">theme</span><span class="p">(</span><span class="n">legend.justification</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">),</span> <span class="n">legend.position</span><span class="o">=</span><span class="s2">"top"</span><span class="p">)</span><span class="o">+</span>
  <span class="n">geom_text</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">d.out</span><span class="p">[</span><span class="n">metro</span><span class="o">==</span><span class="n">mlist0</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="m">0</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="o">+</span>
  <span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">d.out</span><span class="p">[</span><span class="n">metro</span><span class="o">==</span><span class="n">mlist0</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span>

<span class="c1">#now make a time series plot
</span>
<span class="n">g2</span><span class="o">&lt;-</span>
  <span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">metrodata</span><span class="p">[</span><span class="n">year</span><span class="o">&gt;</span><span class="m">1999</span><span class="p">,],</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">date</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">hpi</span><span class="p">,</span><span class="n">group</span><span class="o">=</span><span class="n">metro</span><span class="p">))</span><span class="o">+</span><span class="n">geom_line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">"gray"</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.75</span><span class="p">)</span><span class="o">+</span>

  <span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s2">"House Price Index (Dec 2000=100, NSA)"</span><span class="p">,</span>
                       <span class="n">subtitle</span><span class="o">=</span><span class="n">mlist0</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                       <span class="n">title</span><span class="o">=</span><span class="s2">"Metro House Price Trends Jan 2000-Jun 2016"</span><span class="p">)</span><span class="o">+</span>
  <span class="n">theme</span><span class="p">(</span><span class="n">plot.subtitle</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">))</span><span class="o">+</span>
  <span class="n">geom_line</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">metrodata</span><span class="p">[</span><span class="n">year</span><span class="o">&gt;</span><span class="m">1999</span> <span class="o">&amp;</span> <span class="n">metro</span><span class="o">==</span><span class="n">mlist0</span><span class="p">[</span><span class="n">i</span><span class="p">],],</span><span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="m">1.2</span><span class="p">)</span>  <span class="c1">#highlight the metro we want
</span>
<span class="n">m</span><span class="o">&lt;-</span><span class="n">multiplot</span><span class="p">(</span><span class="n">g2</span><span class="p">,</span><span class="n">g</span><span class="p">)</span>

<span class="n">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">ani.pause</span><span class="p">()</span>
<span class="n">print</span><span class="p">(</span><span class="n">i</span><span class="p">)}</span>
<span class="p">},</span><span class="n">movie.name</span><span class="o">=</span><span class="s2">"hpi dot combo dot line aug 2016.gif"</span><span class="p">,</span><span class="n">ani.width</span> <span class="o">=</span> <span class="m">700</span><span class="p">,</span> <span class="n">ani.height</span> <span class="o">=</span> <span class="m">700</span><span class="p">)</span></code></pre></figure>

<p><a href="/2016/05/08/visual-meditations-on-house-prices">Check out the other visual meditations on house prices</a></p>

    </div>

    

    
  
    <hr>
    <ul class="pagination">
    
      <li class="prev"><a href="/2016/08/09/trends-in-credit" title="Consumer Credit Trends">&laquo; Previous</a></li>
    
      <li><a href="/archive.html">Archive</a></li>
    
      <li class="next"><a href="/2016/08/15/trends-in-credit-part-2" title="Consumer Credit Trends Part 2: Data doesn't drive, it's lucky to be in the car">Next &raquo;</a></li>
    
    </ul>
    <hr>
    
  </div>
</div>



      </div>

    </div>

    <div id="footer">
      <div class="container">
        <p>&copy; 2017 Len Kiefer
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>
       
    • <span vertical-align:bottom> <a href="https://twitter.com/lenkiefer" class="twitter-follow-button" data-show-count="false">•   Follow @lenkiefer</a>
  
 <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</span>
• <script src="//platform.linkedin.com/in.js" type="text/javascript"></script>
<script type="IN/MemberProfile" data-id="https://www.linkedin.com/pub/leonard-kiefer/31/753/511" data-format="click" data-related="false" data-text="Leonard Kiefer"></script>
  • lenkiefer@hotmail.com
           </p>
      </div>
    </div>
    





<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66905937-1', 'auto');
  ga('send', 'pageview');

</script>

    <!-- Latest compiled and minified JavaScript, requires jQuery 1.x (2.x not supported in IE8) -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="/assets/themes/lentheme/bootstrap/js/bootstrap.min.js"></script>
  </body>
</html>





