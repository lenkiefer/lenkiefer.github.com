<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Take a look at house price trends around the world.">

<meta name="generator" content="Hugo 0.81.0">

  <title>Global house price trends &middot; Len Kiefer</title>

  
  
  <link rel="stylesheet" href="https://cdn.bootcss.com/pure/0.6.2/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdn.bootcss.com/pure/0.6.2/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="/css/blackburn.css">

  
  <script async src="https://use.fontawesome.com/32c3d13def.js"></script>

  
  

  
  <link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.11.0/styles/androidstudio.min.css">
  <script src="//cdn.bootcss.com/highlight.js/9.11.0/highlight.min.js"></script>
  <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/r.min.js"></script>
  <script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="http://lenkiefer.com/img/favicon.PNG" type="image/x-icon" />

  
  

</head>

<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="/">Len Kiefer</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/post/"><i class='fa fa-list fa-fw'></i>Archive</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/@lenkiefer" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/leonard-kiefer-51175331" target="_blank"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/lenkiefer" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2015-2018. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


       <meta name="twitter:card" content="summary_large_image">
       <meta name="twitter:image" content="http://lenkiefer.com//img/charts_aug_02_2018/real_hpi.jpg" >
     
    <meta property="og:title" content="Global house price trends">
    <meta property="og:description" content="Take a look at house price trends around the world.">

<div class="header">
  <h1>Global house price trends</h1>
  <h2>Take a look at house price trends around the world.</h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>2018/08/02</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="http://lenkiefer.com/tags/r">R</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="http://lenkiefer.com/tags/house-prices">house prices</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="http://lenkiefer.com/tags/dataviz">dataviz</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="http://lenkiefer.com/tags/animation">animation</a>
    
  </div>
  
  

</div>

  


<p>In this post I want to share updated plots comparing house price trends around the world. Or at least part of the world. Our view will be somewhat limited, based on data, but will at least allow us to see how U.S. house prices compare to a few other countries.</p>
<p>The details behind these plots are explained in more detail in <a href="../../../../2017/04/20/global-hpi-readxl/">this post</a>, but some of the images were lost due to my blog transition. No worries, I’ll post updated code and a few animated gifs here.</p>
<p>Data come from the Federal Reserve Bank of Dallas’s <a href="../../../../">International House Price Database</a>. Read the <a href="https://www.dallasfed.org/institute/houseprice#tab3">methodology</a> there for details on the data.</p>
<p>First some plots:</p>
<p><img src="../../../../img/charts_aug_02_2018/global2018Q1_real.gif" width="60%" height="60%"></p>
<p><img src="../../../../img/charts_aug_02_2018/global2018Q1_v2.gif" width="60%" height="60%"></p>
<p>Now some <a href="https://www.r-project.org/">R</a> code.</p>
<p>You can get the data via the Dallas Fed. It comes as an Excel spreadsheet <a href="https://www.dallasfed.org/~/media/documents/institute/houseprice/hp1801.xlsx">hp1801.xls</a> file. I saved it in my data directory and the proceeded from there following the steps outlined in more detail <a href="../../../../2017/04/20/global-hpi-readxl/">here</a>.</p>
<p><details> <Summary>Load &amp; Prepare Data Details </Summary></p>
<pre class="r"><code># libraries
suppressPackageStartupMessages({
  library(tidyverse)
  library(readxl)
  library(gifski)
  library(data.table)
  library(ggthemes)
  library(lubridate)
  library(stringr)
  })

# load data (spreadsheet saved in data folder)
# can get via Dallas Fed at https://www.dallasfed.org/~/media/documents/institute/houseprice/hp1801.xlsx

#### Read in HPI data ----
df&lt;-read_excel(&quot;data/hp1801.xlsx&quot;, sheet = &quot;HPI&quot;)
colnames(df)[1]&lt;-&quot;cycle&quot;  # rename first column
df$year&lt;-substr(df$cycle,1,4) #create a year
df$month&lt;-as.numeric(substr(df$cycle,7,7))*3 #create a
df$date&lt;-as.Date(ISOdate(df$year,df$month,1))
df %&gt;% select(-X__2,-cycle,-year,-month) %&gt;% 
  gather(country,hpi,-date) -&gt;hpi.df

#### Read in Real HPI data  ----
df&lt;-read_excel(&quot;data/hp1801.xlsx&quot;, sheet = &quot;RHPI&quot;)
colnames(df)[1]&lt;-&quot;cycle&quot;
df$year&lt;-substr(df$cycle,1,4)
df$month&lt;-as.numeric(substr(df$cycle,7,7))*3 
df$date&lt;-as.Date(ISOdate(df$year,df$month,1))
df %&gt;% select(-X__2,-cycle,-year,-month) %&gt;% 
  gather(country,rhpi,-date) -&gt;rhpi.df

#### Read in Disposable Income data  ----
df&lt;-read_excel(&quot;data/hp1801.xlsx&quot;, sheet = &quot;PDI&quot;)
colnames(df)[1]&lt;-&quot;cycle&quot;
df$year&lt;-substr(df$cycle,1,4)
df$month&lt;-as.numeric(substr(df$cycle,7,7))*3 
df$date&lt;-as.Date(ISOdate(df$year,df$month,1))
df %&gt;% select(-X__2,-cycle,-year,-month) %&gt;% 
  gather(country,pdi,-date) -&gt;pdi.df

#### Read in Rea Disposable Income data  ----
df&lt;-read_excel(&quot;data/hp1801.xlsx&quot;, sheet = &quot;RPDI&quot;)
colnames(df)[1]&lt;-&quot;cycle&quot;
df$year&lt;-substr(df$cycle,1,4)
df$month&lt;-as.numeric(substr(df$cycle,7,7))*3 
df$date&lt;-as.Date(ISOdate(df$year,df$month,1))
df %&gt;% select(-X__2,-cycle,-year,-month) %&gt;% 
  gather(country,rpdi,-date) -&gt;rpdi.df

#### Merge data together data  ----
#  Requires data.table() package 

dt&lt;-merge(hpi.df,rhpi.df,by=c(&quot;date&quot;,&quot;country&quot;))
dt&lt;-merge(dt,pdi.df,by=c(&quot;date&quot;,&quot;country&quot;))
dt&lt;-merge(dt,rpdi.df,by=c(&quot;date&quot;,&quot;country&quot;))
dt&lt;-data.table(dt)[year(date)&gt;0,]
df3&lt;-dt

#create a caption for attribution to source

mycaption&lt;-&quot;Mack, A., and E. Martinez-Garcia. 2011. &#39;A Cross-Country Quarterly Database of Real House Prices: A Methodological Note.&#39; Globalization and Monetary Policy Institute Working Paper No. 99, Federal Reserve Bank of Dallas.&quot;
mycaption&lt;-str_wrap(mycaption,width=80) #wrap the caption
mycap1&lt;-&quot;@lenkiefer Source: Dallas Federal Reserve International House Price Database  http://www.dallasfed.org/institute/houseprice/&quot;  #caption part 2

# data for plots
clist&lt;-c(&quot;US&quot;,&quot;UK&quot;,&quot;Canada&quot;,&quot;Australia&quot;,&quot;France&quot;,&quot;Germany&quot;)
dt2&lt;-data.table(dt)[year(date)&gt;1974 &amp; country %in% clist,]
dlist&lt;-unique(dt2[year(date)&gt;1999]$date)
N&lt;-length(dlist)

# rescale data ----
dt3 &lt;- dt2 %&gt;% 
  group_by(country) %&gt;% 
  mutate(hpi=100*hpi/hpi[date==&quot;2000-03-01&quot;],
         rhpi=100*rhpi/rhpi[date==&quot;2000-03-01&quot;]) %&gt;% 
  ungroup() %&gt;% data.table</code></pre>
<p></details></p>
<p>With our data ready we can create two functions that we will iterate over to generate our gif. <details> <Summary>Plotting function details</Summary></p>
<pre class="r"><code># plot for real hpi
rhpi.plot&lt;-function(i=1){
  ggplot(data=dt3[year(date)&gt;1999 &amp; 
                    date&lt;=dlist[i] &amp;
                    country %in% clist],
         aes(x=date,y=rhpi,color=country,linetype=country,label=country))+
    geom_line(size=1.1)+
    scale_x_date(breaks=seq(dlist[1],dlist[N]+years(1),&quot;1 year&quot;),
                 date_labels=&quot;%Y&quot;,limits=c(dlist[1],dlist[N]+years(1)))+
    geom_text(data=dt3[date==dlist[i] &amp;
                         country %in% clist],
              hjust=0,nudge_x=30,size=2.5)+
    theme_minimal()+ geom_hline(yintercept=100,linetype=2)+
    scale_y_log10(breaks=seq(50,300,50),limits=c(80,275))+ 
    theme_fivethirtyeight()+
    theme(legend.position=&quot;none&quot;,
          plot.caption=element_text(hjust=0,size=7),
          plot.subtitle=element_text(face=&quot;italic&quot;))+
    labs(x=&quot;&quot;,y=&quot;&quot;,title=&quot;Global house price trends through 2018Q1&quot;,
         caption=paste0(mycap1,&quot;\n&quot;,mycaption),
         subtitle=&quot;Seasonally adjusted real house price index (2000Q1=100, log scale)&quot;)
}

# code for nominal hpi
hpi.plot&lt;-function(i=1){
  ggplot(data=dt3[year(date)&gt;1999 &amp; 
                   date&lt;=dlist[i] &amp;
                   country %in% clist],
         aes(x=date,y=hpi,color=country,linetype=country,label=country))+
    geom_line(size=1.1)+
    scale_x_date(breaks=seq(dlist[1],dlist[N]+years(1),&quot;1 year&quot;),
                 date_labels=&quot;%Y&quot;,limits=c(dlist[1],dlist[N]+years(1)))+
    geom_text(data=dt3[date==dlist[i] &amp;
                        country %in% clist],
              hjust=0,nudge_x=30,size=2.5)+
    theme_minimal()+ geom_hline(yintercept=100,linetype=2)+
    scale_y_log10(breaks=seq(100,400,50),limits=c(90,400))+ 
    theme_fivethirtyeight()+
    theme(legend.position=&quot;none&quot;,
          plot.caption=element_text(hjust=0,size=7),
          plot.subtitle=element_text(face=&quot;italic&quot;))+
    labs(x=&quot;&quot;,y=&quot;&quot;,title=&quot;Global house price trends through 2018Q1&quot;,
         caption=paste0(mycap1,&quot;\n&quot;,mycaption),
         subtitle=&quot;Seasonally adjusted nominal index (2000Q1=100, log scale)&quot;)
}</code></pre>
<p></details></p>
<p>Then we can call these functions:</p>
<pre class="r"><code># N is maximum date (2018Q1)
rhpi.plot(N)</code></pre>
<p><img src="/post/2018-08-02-global-house-price-trends_files/figure-html/08-02-2018-plot-1-2-1.png" width="672" /></p>
<pre class="r"><code>hpi.plot(N)</code></pre>
<p><img src="/post/2018-08-02-global-house-price-trends_files/figure-html/08-02-2018-plot-1-2-2.png" width="672" /></p>
<p>Finally, if we wanted to make the gifs above, we can use <a href="https://CRAN.R-project.org/package=gifski">gifski</a> and the following code.</p>
<p><details> <Summary>Code for gif</Summary></p>
<pre class="r"><code># set mydir to a place to save gif
mydir &lt;- PATH_TO_YOUR_DIRECTORY #change

gif_file &lt;- save_gif({for (i in seq(1,N)){  
  g&lt;- rhpi.plot(i)
  print(g)
  print(paste(i,&quot;out of&quot;,N))
}
  for (ii in 1:20){
    print(g)
    print(paste(ii,&quot;out of&quot;,20))
  }
}, gif_file= paste0(mydir,&quot;/global2018Q1_real.gif&quot;),width = 1200, height = 800, res = 144, delay=1/10)
# show your plot:
utils::browseURL(gif_file)

gif_file &lt;- save_gif({for (i in seq(1,N)){  
  g&lt;- hpi.plot(i)
  print(g)
  print(paste(i,&quot;out of&quot;,N))
}
  for (ii in 1:20){
    print(g)
    print(paste(ii,&quot;out of&quot;,20))
  }
}, gif_file= paste0(mydir,&quot;/global2018Q1_v2.gif&quot;),width = 1200, height = 800, res = 144, delay=1/10)
utils::browseURL(gif_file)</code></pre>
<p></details></p>
<div id="altenative-data-wrangling" class="section level1">
<h1>Altenative Data Wrangling</h1>
<p>We could have skipped some of the steps above by using this code. However, my plots were already set up to use the longer approach so I kept it. But this is a handy bit of code that could come in handy if you have a spreadsheet with data in multiple sheets (it happens).</p>
<p><details> <Summary>Alternative data wrangling code</Summary></p>
<pre class="r"><code># blink and you might miss it:

df &lt;- c(&quot;HPI&quot;,&quot;RHPI&quot;,&quot;PDI&quot;,&quot;RPDI&quot;) %&gt;%   #iterate over four sheets ----
  set_names() %&gt;% 
  
  # Now for something magical!
  
  map_df(~ read_excel(path = path, sheet = .x), .id = &quot;sheet&quot;)

df$year&lt;-substr(df$X__1,1,4)
df$month&lt;-substr(df$X__1,7,7)
#quarterly data so multiply month by 3
df$date&lt;-as.Date(ISOdate(df$year,as.numeric(df$month)*3,1)) </code></pre>
<p></details></p>
</div>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="http://lenkiefer.com/2018/07/31/house-price-gif/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="http://lenkiefer.com/2018/07/31/house-price-gif/">House price gif that keeps on giffing</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="http://lenkiefer.com/2018/08/05/charts-within-charts/">Charts within charts</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="http://lenkiefer.com/2018/08/05/charts-within-charts/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  

</div>
<footer class="post-footer clearfix">
    
        <p class="post-tags">
            <span>Tagged:</span>
            
            
                <a href="/tags/r/">R</a>, 
            
                <a href="/tags/house-prices/">house prices</a>, 
            
                <a href="/tags/dataviz/">dataviz</a>, 
            
                <a href="/tags/animation/">animation</a>
            
        </p>
    

    <div class="share">
        
            <a class="icon-twitter" href="https://twitter.com/share?url=http://lenkiefer.comhttp%3a%2f%2flenkiefer.com%2f2018%2f08%2f02%2fglobal-house-price-trends%2f&text=Global%20house%20price%20trends via %40lenkiefer"
                onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fa fa-twitter"></i>
                <span class="hidden">Twitter</span>
            </a>
        

        
            <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://lenkiefer.comhttp%3a%2f%2flenkiefer.com%2f2018%2f08%2f02%2fglobal-house-price-trends%2f"
                onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                <i class="fa fa-facebook"></i>
                <span class="hidden">Facebook</span>
            </a>
        


        
    </div>
</footer>
</div>
</div>
<script src="http://lenkiefer.com/js/ui.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66905937-1', 'auto');
  ga('send', 'pageview');

</script>






</body>
</html>

