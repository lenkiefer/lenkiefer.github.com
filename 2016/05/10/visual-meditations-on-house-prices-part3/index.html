<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.81.0" />

  <title>Visual meditations on house prices, Part 3: bubbles and bounce &middot; Len Kiefer</title>

    

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="/css/blackburn.css">

  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">

  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet" type="text/css">

  
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/androidstudio.min.css">
  <script async src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="http://lenkiefer.com/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="/">Len Kiefer</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/post/"><i class='fa fa-list fa-fw'></i>Archive</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/@lenkiefer" rel="me" target="_blank"><i class="fab fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/leonard-kiefer-51175331" rel="me" target="_blank"><i class="fab fa-linkedin fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/lenkiefer" rel="me" target="_blank"><i class="fab fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2021. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Visual meditations on house prices, Part 3: bubbles and bounce</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>2016/05/10</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="http://lenkiefer.com/tags/dataviz">dataviz</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="http://lenkiefer.com/tags/house-prices">House prices</a>
    
  </div>
  
  

</div>

  


<p>IN THIS POST I’m going to describe how to make some additional data visualizations of house prices and discuss a bit about what they mean. For reference, the prior posts are available at:</p>
<ul>
<li><a href="../../../../2016/05/08/visual-meditations-on-house-prices-part1">Part 1: data wrangling</a></li>
<li><a href="../../../../2016/05/08/visual-meditations-on-house-prices-part2">Part 2: sparklines and dots (animated)</a></li>
</ul>
<div id="meditation-1-bubbles" class="section level1">
<h1>Meditation 1: Bubbles</h1>
<p>Let’s start by recreating this visualization:</p>
<p><img src="{{ site.url }}/img/charts_may_8_2016/hpi_dots2.gif" alt="hpi dots 2"/></p>
<p>This visualization plots each state (plus the District of Columbia) as a blue dot in a scatterplot.</p>
<p>The X axis displays how far the house price index in the state is from its pre-2008 peak. A vertical line at 100% indicates that the price index for that state is exactly at the pre-2008 peak for that state. If the value is to the right (left) of the vertical line, then the index is above(below) that peak.</p>
<p>The Y axis displays how far the index is from the post-2007 minimum for that state. The horizontal line at 100% indicates that the state is exactly at that minimum. As states recover from the post-recession bottom, they move further up on the chart.</p>
<p>A value at (75%, 125%) would indicate that the state is only 75% of the pre-2008 maximum, and 125% of the post-2007 minimum.</p>
<p>You can see that North Dakota (ND) does not fall much during the Great Recession and recovers quickly. California (CA) and Florida (FL) fall a lot, but have a strong recovery.</p>
<div id="making-the-chart" class="section level2">
<h2>Making the chart</h2>
<p>The data for the charts can be found at the following links:</p>
<ol style="list-style-type: decimal">
<li><a href="%7B%7B%20site.url%20%7D%7D/img/charts_may_8_2016/fmhpi.txt"><em>state and national called fmhpi.txt</em></a></li>
<li><a href="%7B%7B%20site.url%20%7D%7D/img/charts_may_8_2016/fmhpi2.txt"><em>metro called fmhpi2.txt</em></a></li>
</ol>
<p>Constructing this chart is fairly straightforward. We simply have to calculate the pre-2008 peak and post-2007 minimum for each state. As I mentioned in <a href="../%202016-05-08-visual-meditations-on-house-prices-part1">Part 1: data wrangling</a>, I already computed the pre-2008 peak value and post-2007 minimum value for each state and added it as an additional variable. Elegant and efficient? No, but it will get this job done.</p>
<pre class="r"><code>mydata &lt;- fread(&quot;data/fmhpi.txt&quot;)
#compute some additional values
mydata[,gmax:=(hpi/pmax)]  #for the x axis
mydata[,gmin:=(hpi/pmin)]  #for the y axis</code></pre>
<p>Now to make this animation, I set up a function to contain my ggplot code. Because this code is so simple, it’s not really necessary. But it could be helpful to have a function down the line.</p>
<pre class="r"><code>#load required libraries
library(ggplot2)
library(animation)
library(ggthmes)
library(ggrepel)
library(scales)

mydots2&lt;-function (yy,mm){
g&lt;-
  ggplot(data=mydata[year==yy&amp; month==mm &amp; state != &quot;US&quot;], aes(x=gmax,y=gmin,label=state))+
  geom_point(size=4,alpha=0.75,color=&quot;#00B0F0&quot;)+
  #Use geom_text_repel from the ggrepel package discussed below
  geom_text_repel()+
  theme_minimal()  +
  #format axis
  scale_x_continuous(label=percent,limits=c(.5,1.5))+
  scale_y_continuous(label=percent,limits=c(.9,2), breaks=seq(1,2,.25))+
  
  #add verticle and horizontal lines
  geom_abline(intercept=1,slope=0,alpha=0.7)+
  geom_vline(xintercept=1, alpha=0.7)  +
  #title and captions
  labs(y=&quot;House price relative to post-2007 min (%)&quot;, x=&quot;House price relative to pre-2008 max (%)&quot;,
       title=&quot;State house price dynamics&quot;,
       subtitle=paste(as.character(mydata[year==yy &amp; month==mm &amp; state==&quot;US&quot;]$date,format=&quot;%b-%Y&quot;)),
       caption=&quot;@lenkiefer Source: Freddie Mac house price index, each dot a state&quot;)+
  theme(plot.title=element_text(size=18))+
  theme(plot.caption=element_text(hjust=0,vjust=1,margin=margin(t=10)))+
  theme(plot.margin=unit(c(0.5,0.5,0.5,0.75),&quot;cm&quot;))+
  #add some labels to the graphic
  annotate(&quot;text&quot;,x=1.01,y=1.95,label=&quot;House prices above pre-recession peak&quot;,hjust=0)+
  annotate(&quot;text&quot;,x=0.99,y=1.95,label=&quot;House prices below pre-recession peak&quot;,hjust=1)+
  annotate(&quot;text&quot;,x=1.49,y=1.01,label=&quot;Y % up from bottom&quot;,hjust=1,angle=270,vjust=1)+
  annotate(&quot;text&quot;,x=0.6,y=0.975,label=&quot;At bottom&quot;,hjust=0)
  return(g)
}</code></pre>
<p>The function takes a year value <strong>yy</strong> and a month value <strong>mm</strong> and creates the bubble plot for that year and month combination.</p>
<div id="labels-for-scatterplot" class="section level3">
<h3>Labels for scatterplot</h3>
<p>My favorite part of this plot was using the <a href="https://cran.r-project.org/web/packages/ggrepel/index.html"><em>ggrepel</em></a> package to create the labels for the scatterplot. If you’ve ever tried to label a scatterplot or bubble chart with lots of points you should really appreciate this package, which handles labels automatically. It’s an incredible time saver preventing you from having to manually adjust the point labels. And in an animation, it’s would consume enormous time to try to move all the labels for each image. Unless you have an intern or RA, then this package is a must-use.</p>
</div>
<div id="add-animation" class="section level3">
<h3>Add animation</h3>
<p>Adding animation should be familiar <a href="../%202016-05-08-visual-meditations-on-house-prices-part2"><em>from my previous posts</em></a>, but I include it here for completeness.</p>
<pre class="r"><code>oopt = ani.options(interval = 0.3)
saveGIF({for (yy in 2008:2016) for(mm in seq(1,12,1)) {   {
  if (yy==2016) {mm&lt;-3}
  g&lt;-
    mydots2(yy=yy, mm=mm) #if you want to do more elaborate things with the animation, the function could be useful
  print(g)
  ani.pause()
}
}
  #This is included at the end of the loop to pause at the final image.
  for (i2 in 1:2) {
  
    print(g)
    ani.pause()
  }
},movie.name=&quot;hpi_dots2.gif&quot;,ani.width = 950, ani.height = 650)</code></pre>
</div>
</div>
</div>
<div id="meditation-2-bounce" class="section level1">
<h1>Meditation 2: Bounce</h1>
<p>Now we’re going to use the metro data to analyze seasonality in house prices:</p>
<p><img src="{{ site.url }}/img/charts_may_10_2016/metro_season.gif" alt="redblue dots"/></p>
<div id="explaining-the-plot" class="section level2">
<h2>Explaining the plot</h2>
<p>I think this animation does a good job of displaying seasonality in house prices. I’ve color coded the dots so that they fade from blue in January to red in June back to blue in December. As housing markets heat up and prices rise, the colors shift redder and fade bluer as prices rise. The dots bounce up and down in fairly close unison, but like popcorn in a popper, some jump up more than others.</p>
</div>
<div id="the-code" class="section level2">
<h2>The code</h2>
<p>The code for this one is pretty straightforward if you’ve been following along:</p>
<pre class="r"><code>metrodata &lt;- fread(&quot;fmhpi2.txt&quot;)
metrodata$date&lt;-as.Date(metrodata$date, format=&quot;%m/%d/%Y&quot;)
#Compute monthly house price appreciation
metrodata&lt;-metrodata[,hpa1:=c(NA,((1+diff(hpi)/hpi)))-1,by=metro]  


oopt = ani.options(interval = 0.1)
saveGIF({for (yy in 2000:2016) for(mm in seq(1,12,1)) {  {
  if (yy&gt;=2016 &amp; mm&gt;3) {mm&lt;-3}
  g&lt;-
    ggplot(data=metrodata[(year==yy) &amp; month==mm ], aes(x=metro, y=hpa1,color=month, label=date,group=metro))+
    geom_point(alpha=0.6,size=2)   +
    scale_y_continuous(limits=c(-.052,.052), labels=percent, breaks=seq(-.05,.05,.01))+
    theme_minimal()  +
    geom_abline(intercept=0,slope=0, alpha=0.5)+
    scale_colour_gradient2(low=&quot;blue&quot;,mid=&quot;red&quot;, high=&quot;blue&quot;, limits=c(1,12)) +
    labs(y=&quot;House price index (Dec 2000 =100, NSA), Monthly % Change&quot;, x=&quot;&quot;,
         title=&quot;Metro house price dynamics&quot;,
         subtitle=paste(as.character(metrodata[year==yy &amp; month==mm]$date,format=&quot;%b-%Y&quot;)),
         caption=&quot;@lenkiefer Source: Freddie Mac house price index, each dot a metro, colored by month&quot;)+
    theme(plot.title=element_text(size=14))+
    theme(plot.caption=element_text(hjust=0,vjust=1,margin=margin(t=10),size=9))+
    theme(plot.margin=unit(c(0.25,0.25,0.25,0.25),&quot;cm&quot;))+ 
    theme(legend.justification=c(0,0),
          legend.position=c(.7,.2),
          text=element_text(size=10))+
    theme(legend.position=&quot;none&quot;)+
    theme( axis.text.x=element_blank(),axis.ticks=element_blank())+
    theme(panel.grid.major.x=element_blank())+
    theme(axis.text=element_text(size=6))
  
  print(g)
  ani.pause()
}
}
  for (i2 in 1:2) {print(g)
    ani.pause()  }
},movie.name=&quot;metro_seasons.gif&quot;,ani.width = 650, ani.height = 650)</code></pre>
<div id="wrapping-up" class="section level3">
<h3>Wrapping up</h3>
<p>That’s it for today’s meditations, but we’ll have more in the future. Up next: <strong>SWOOOSH!!!</strong></p>
<p><img src="{{ site.url }}/img/charts_may_10_2016/rbswirl2.gif" alt="Swoosh"/></p>
</div>
</div>
</div>

  
  <h4><i class="fas fa-share-alt" aria-hidden="true"></i>&nbsp;Share!</h4>
<ul class="share-buttons">
	<li><a href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2flenkiefer.com%2f2016%2f05%2f10%2fvisual-meditations-on-house-prices-part3%2f" target="_blank" title="Share on Facebook"><i class="fab fa-facebook" aria-hidden="true"></i><span class="sr-only">Share on Facebook</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://twitter.com/intent/tweet?source=http%3a%2f%2flenkiefer.com%2f2016%2f05%2f10%2fvisual-meditations-on-house-prices-part3%2f" target="_blank" title="Tweet"><i class="fab fa-twitter" aria-hidden="true"></i><span class="sr-only">Tweet</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://plus.google.com/share?url=http%3a%2f%2flenkiefer.com%2f2016%2f05%2f10%2fvisual-meditations-on-house-prices-part3%2f" target="_blank" title="Share on Google+"><i class="fab fa-google-plus" aria-hidden="true"></i><span class="sr-only">Share on Google+</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.tumblr.com/share?v=3&u=http%3a%2f%2flenkiefer.com%2f2016%2f05%2f10%2fvisual-meditations-on-house-prices-part3%2f" target="_blank" title="Post to Tumblr"><i class="fab fa-tumblr" aria-hidden="true"></i><span class="sr-only">Post to Tumblr</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://pinterest.com/pin/create/button/?url=http%3a%2f%2flenkiefer.com%2f2016%2f05%2f10%2fvisual-meditations-on-house-prices-part3%2f" target="_blank" title="Pin it"><i class="fab fa-pinterest-p" aria-hidden="true"></i><span class="sr-only">Pin it</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.reddit.com/submit?url=http%3a%2f%2flenkiefer.com%2f2016%2f05%2f10%2fvisual-meditations-on-house-prices-part3%2f" target="_blank" title="Submit to Reddit"><i class="fab fa-reddit-alien" aria-hidden="true"></i><span class="sr-only">Submit to Reddit</span></a>
	</li>
</ul>


<style>
	ul.share-buttons{
	  list-style: none;
	  padding: 0;
	}

	ul.share-buttons li{
	  display: inline;
	}

	ul.share-buttons .sr-only{
	  position: absolute;
	  clip: rect(1px 1px 1px 1px);
	  clip: rect(1px, 1px, 1px, 1px);
	  padding: 0;
	  border: 0;
	  height: 1px;
	  width: 1px;
	  overflow: hidden;
	}
</style>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="http://lenkiefer.com/2016/05/08/visual-meditations-on-house-prices/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="http://lenkiefer.com/2016/05/08/visual-meditations-on-house-prices/">Visual meditations on house prices</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="http://lenkiefer.com/2016/05/14/visual-meditations-on-house-prices-part4/">Visual meditations on house prices, Part 4: graph gallery</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="http://lenkiefer.com/2016/05/14/visual-meditations-on-house-prices-part4/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>


  
  
  
  

  

</div>

</div>
</div>
<script src="http://lenkiefer.com/js/ui.js"></script>
<script src="http://lenkiefer.com/js/menus.js"></script>




<script>
  
  if (window.location.hostname != "localhost") {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-66905937-1', 'auto');
    ga('send', 'pageview');
  }
</script>





<script src="/js/math-code.js"></script>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  


</body>
</html>

