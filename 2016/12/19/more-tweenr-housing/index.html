<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.81.0" />

  <title>Simple tweenr animations with ggplot2  &middot; Len Kiefer</title>

    

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="http://lenkiefer.com/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="http://lenkiefer.com/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="http://lenkiefer.com/css/blackburn.css">

  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">

  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet" type="text/css">

  
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/androidstudio.min.css">
  <script async src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="http://lenkiefer.com/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="http://lenkiefer.com/">Len Kiefer</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="http://lenkiefer.com/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="http://lenkiefer.com/post/"><i class='fa fa-list fa-fw'></i>Archive</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="http://lenkiefer.com/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/@lenkiefer" rel="me" target="_blank"><i class="fab fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/leonard-kiefer-51175331" rel="me" target="_blank"><i class="fab fa-linkedin fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/lenkiefer" rel="me" target="_blank"><i class="fab fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2021. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


       <meta name="twitter:card" content="summary">
       <meta name="twitter:image" content="http://lenkiefer.com/img/logo/logo.png" >
    
    <meta property="og:title" content="Simple tweenr animations with ggplot2 ">
    <meta property="og:description" content="R statistics housing animation ggplot2">

<div class="header">
  <h1>Simple tweenr animations with ggplot2 </h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>2016/12/19</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="http://lenkiefer.com/tags/animation">animation</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="http://lenkiefer.com/tags/r">R</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="http://lenkiefer.com/tags/dataviz">dataviz</a>
    
  </div>
  
  

</div>

  


<div id="animations-with-tweenr" class="section level1">
<h1>Animations with tweenr</h1>
<p>IN THIS POST WE ARE GOING TO CREATE TWO SIMPLE animated data visualizations using <a href="https://www.r-project.org/">R</a> <em>ggplot2</em>, <em>animation</em>, and <em>tweenr</em> packages.</p>
<p>See this <a href="../../../../2016/05/29/improving-R-animated-gifs-with-tweenr">post about tweenr</a> for an introduction to tweenr, and more examples <a href="../../../../2016/05/30/more-tweenr-animations">here</a> and <a href="../../../../2016/06/26/week-in-review">here</a>.</p>
<p>Unlike those examples we are going to create visualizations using the data that ship with the <a href="https://blog.rstudio.org/2016/09/15/tidyverse-1-0-0/">tidyverse</a> packages (mainly ggplot2). This will allow for easier replication.</p>
</div>
<div id="a-simple-stripped-down-example." class="section level1">
<h1>A simple stripped down example.</h1>
<p>Let’s start with a stripped down example. I actually tweeted this out starting here:</p>
<blockquote class="twitter-tweet" data-lang="en">
<p lang="en" dir="ltr">
.<a href="https://twitter.com/Heinonmatti"><span class="citation">@Heinonmatti</span></a> give me a second… I'll shoot you a reproducible <a href="https://twitter.com/hashtag/rstats?src=hash">#rstats</a> example. via tweetstorm!
</p>
— Leonard Kiefer (<span class="citation">@lenkiefer</span>) <a href="https://twitter.com/lenkiefer/status/810997043716038656">December 19, 2016</a>
</blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>But let’s put it all in a single place.</p>
<pre class="r"><code>#load libraries
library(tidyverse)
library(animation)
library(tweenr)
library(ggplot2)

myf&lt;-function(i){
  df&lt;-mtcars
  df$y&lt;-mtcars[,i]
  df$yname&lt;-as.factor(names(df)[i])
  return(df)
}

mylist&lt;-lapply(seq(11,1),myf)
tween.df&lt;-tween_states(mylist,tweenlength=1,statelength=2, ease=rep(&#39;cubic-in-out&#39;,11), nframes=121)

myplot&lt;-function(i){  
g&lt;-ggplot(data=filter(tween.df,i==.frame),aes(x=mpg,y=y))+geom_point(size=3)+theme_bw()+
  labs(y=filter(tween.df,i==.frame)$yname)
return(g)
}

oopt = ani.options(interval = 0.1)
saveGIF({for (i in 1:max(tween.df$.frame)) {
  g&lt;-myplot(i)
  print(g)
  print(i)
  ani.pause()
}
},movie.name=&quot;mtcars tween.gif&quot;,ani.width = 840, ani.height =450)</code></pre>
<pre><code>## [1] 1</code></pre>
<pre><code>## [1] 2</code></pre>
<pre><code>## [1] 3</code></pre>
<pre><code>## [1] 4</code></pre>
<pre><code>## [1] 5</code></pre>
<pre><code>## [1] 6</code></pre>
<pre><code>## [1] 7</code></pre>
<pre><code>## [1] 8</code></pre>
<pre><code>## [1] 9</code></pre>
<pre><code>## [1] 10</code></pre>
<pre><code>## [1] 11</code></pre>
<pre><code>## [1] 12</code></pre>
<pre><code>## [1] 13</code></pre>
<pre><code>## [1] 14</code></pre>
<pre><code>## [1] 15</code></pre>
<pre><code>## [1] 16</code></pre>
<pre><code>## [1] 17</code></pre>
<pre><code>## [1] 18</code></pre>
<pre><code>## [1] 19</code></pre>
<pre><code>## [1] 20</code></pre>
<pre><code>## [1] 21</code></pre>
<pre><code>## [1] 22</code></pre>
<pre><code>## [1] 23</code></pre>
<pre><code>## [1] 24</code></pre>
<pre><code>## [1] 25</code></pre>
<pre><code>## [1] 26</code></pre>
<pre><code>## [1] 27</code></pre>
<pre><code>## [1] 28</code></pre>
<pre><code>## [1] 29</code></pre>
<pre><code>## [1] 30</code></pre>
<pre><code>## [1] 31</code></pre>
<pre><code>## [1] 32</code></pre>
<pre><code>## [1] 33</code></pre>
<pre><code>## [1] 34</code></pre>
<pre><code>## [1] 35</code></pre>
<pre><code>## [1] 36</code></pre>
<pre><code>## [1] 37</code></pre>
<pre><code>## [1] 38</code></pre>
<pre><code>## [1] 39</code></pre>
<pre><code>## [1] 40</code></pre>
<pre><code>## [1] 41</code></pre>
<pre><code>## [1] 42</code></pre>
<pre><code>## [1] 43</code></pre>
<pre><code>## [1] 44</code></pre>
<pre><code>## [1] 45</code></pre>
<pre><code>## [1] 46</code></pre>
<pre><code>## [1] 47</code></pre>
<pre><code>## [1] 48</code></pre>
<pre><code>## [1] 49</code></pre>
<pre><code>## [1] 50</code></pre>
<pre><code>## [1] 51</code></pre>
<pre><code>## [1] 52</code></pre>
<pre><code>## [1] 53</code></pre>
<pre><code>## [1] 54</code></pre>
<pre><code>## [1] 55</code></pre>
<pre><code>## [1] 56</code></pre>
<pre><code>## [1] 57</code></pre>
<pre><code>## [1] 58</code></pre>
<pre><code>## [1] 59</code></pre>
<pre><code>## [1] 60</code></pre>
<pre><code>## [1] 61</code></pre>
<pre><code>## [1] 62</code></pre>
<pre><code>## [1] 63</code></pre>
<pre><code>## [1] 64</code></pre>
<pre><code>## [1] 65</code></pre>
<pre><code>## [1] 66</code></pre>
<pre><code>## [1] 67</code></pre>
<pre><code>## [1] 68</code></pre>
<pre><code>## [1] 69</code></pre>
<pre><code>## [1] 70</code></pre>
<pre><code>## [1] 71</code></pre>
<pre><code>## [1] 72</code></pre>
<pre><code>## [1] 73</code></pre>
<pre><code>## [1] 74</code></pre>
<pre><code>## [1] 75</code></pre>
<pre><code>## [1] 76</code></pre>
<pre><code>## [1] 77</code></pre>
<pre><code>## [1] 78</code></pre>
<pre><code>## [1] 79</code></pre>
<pre><code>## [1] 80</code></pre>
<pre><code>## [1] 81</code></pre>
<pre><code>## [1] 82</code></pre>
<pre><code>## [1] 83</code></pre>
<pre><code>## [1] 84</code></pre>
<pre><code>## [1] 85</code></pre>
<pre><code>## [1] 86</code></pre>
<pre><code>## [1] 87</code></pre>
<pre><code>## [1] 88</code></pre>
<pre><code>## [1] 89</code></pre>
<pre><code>## [1] 90</code></pre>
<pre><code>## [1] 91</code></pre>
<pre><code>## [1] 92</code></pre>
<pre><code>## [1] 93</code></pre>
<pre><code>## [1] 94</code></pre>
<pre><code>## [1] 95</code></pre>
<pre><code>## [1] 96</code></pre>
<pre><code>## [1] 97</code></pre>
<pre><code>## [1] 98</code></pre>
<pre><code>## [1] 99</code></pre>
<pre><code>## [1] 100</code></pre>
<pre><code>## [1] 101</code></pre>
<pre><code>## [1] 102</code></pre>
<pre><code>## [1] 103</code></pre>
<pre><code>## [1] 104</code></pre>
<pre><code>## [1] 105</code></pre>
<pre><code>## [1] 106</code></pre>
<pre><code>## [1] 107</code></pre>
<pre><code>## [1] 108</code></pre>
<pre><code>## [1] 109</code></pre>
<pre><code>## [1] 110</code></pre>
<pre><code>## [1] 111</code></pre>
<pre><code>## [1] 112</code></pre>
<pre><code>## [1] 113</code></pre>
<pre><code>## [1] 114</code></pre>
<pre><code>## [1] 115</code></pre>
<pre><code>## [1] 116</code></pre>
<pre><code>## [1] 117</code></pre>
<pre><code>## [1] 118</code></pre>
<pre><code>## [1] 119</code></pre>
<pre><code>## [1] 120</code></pre>
<pre><code>## [1] 121</code></pre>
<pre><code>## [1] 122</code></pre>
<pre><code>## [1] 123</code></pre>
<pre><code>## [1] 124</code></pre>
<pre><code>## [1] 125</code></pre>
<pre><code>## [1] 126</code></pre>
<pre><code>## [1] 127</code></pre>
<pre><code>## [1] 128</code></pre>
<pre><code>## Warning: running command &#39;C:\WINDOWS\system32\cmd.exe /c convert --version&#39;
## had status 4</code></pre>
<pre><code>## Warning in find_magic(): ImageMagick not installed yet!</code></pre>
<pre><code>## Warning in im.convert(img.files, output = path.expand(movie.name), convert
## = convert, : Please install ImageMagick first or put its bin path into the
## system PATH variable</code></pre>
<pre><code>## [1] FALSE</code></pre>
<p>Running this creates:</p>
<p><img src="{{ site.url }}/img/charts_dec_19_2016/mtcars tween.gif" alt="mtcars gif"/></p>
<p>In this example, we loop through the mtcars data and plot successive scatterplots showing the relationship between <em>mpg</em> and other variables in the dataset.</p>
<p>We first create a simple function to create a dataset for each frame in our animation. Then we use tweenr to interpolate between frames to create a smooth animation. I’ve also found it convenient to create a plot function and insert that in the loop.</p>
</div>
<div id="animated-map" class="section level1">
<h1>Animated map</h1>
<p>We can make another example using a map. I’m going to use the <a href="https://github.com/tidyverse/ggplot2/blob/master/data-raw/tx-housing.R">txhousing</a> dataset that comes with ggplot2.</p>
<p>These data, from the <a href="https://www.recenter.tamu.edu/">Real Estate Center at Texas A&amp;M University</a> provide some basic stats on trends in Texas housing markets. Modifying <a href="http://jcyhong.github.io/ggplot_demo.html">example 4 in this post</a> we can create a simple map of median sales prices by city in June 2015:</p>
<pre class="r"><code>library(maps)
data(us.cities) # from the package maps
data(txhousing) # from the package ggplot2

# Preprocessing
tx.cities &lt;- subset(us.cities, country.etc == &quot;TX&quot; &amp; pop &gt;= 100000)
tx.cities$city &lt;- unlist(strsplit(tx.cities$name, &quot; TX&quot;))
txhousing.2015 &lt;- subset(txhousing, year == 2015 &amp; month == 6 &amp;
                             city %in% tx.cities$city)
temp &lt;- tx.cities[tx.cities$city %in% txhousing.2015$city, c(&quot;pop&quot;, &quot;lat&quot;, &quot;long&quot;)]
temp &lt;- temp[rep(seq_len(nrow(temp)), each = 6), ]
txhousing.2015.geo &lt;- cbind(txhousing.2015, temp)

ggplot(txhousing.2015.geo, aes(x = long, y = lat,  colour = median/1000)) +
  borders(&quot;county&quot;, &quot;texas&quot;, colour = &quot;grey70&quot;) + 
  geom_point(size=3,alpha=0.82) + 
  ggtitle(&quot;Housing market for populous cities in Texas (Jun 2015)&quot;) +
  scale_colour_continuous(name  = &quot;Median price ($, Ths)&quot;) +
  labs(caption=&quot;test caption&quot;)</code></pre>
<p><img src="http://lenkiefer.com/post/2016-12-19-more-tweenr-housing_files/figure-html/animation-2-dec19-2016-1.png" width="672" /></p>
<p>Now we can use tweenr to interpolate between points.</p>
<p>For the animation we’ll just plot an outline of the state of Texas and then have a dot for each city move around the map. In a future exercise we could combine the map with a time series line or bar chart to show trends in metro data. As that would be more complicated we’ll do that at a later time. Right now, let’s just make the map and animate following the same approach as above.</p>
<pre class="r"><code>city.list&lt;-unique(txhousing.2015.geo$city)

myf&lt;-function(c){
  df&lt;-subset(merge(txhousing.2015,tx.cities),city==city.list[c])
  df$city&lt;-factor(df$city)
  df %&gt;% map_if(is.character, as.factor) %&gt;% as_data_frame -&gt; df
  return(df)
}

myplot&lt;-function(indata){  
  g&lt;-
  ggplot(data=indata, aes(x = long, y = lat,  label=city)) +
  borders(&quot;county&quot;, &quot;texas&quot;, colour = &quot;grey70&quot;) + 
  geom_point(data=indata,size=3,alpha=0.82) + 
  geom_text(data=indata,vjust=0,nudge_y=.5)+
  ggtitle(&quot;Texas Metros&quot;) +
  labs(caption=&quot;@lenkiefer&quot;,subtitle=&quot; These metros are moving!&quot;)+
  theme(plot.caption=element_text(hjust=0))
  return(g)
}

mylist&lt;-lapply(c(seq(1,18),1),myf)
tween.df&lt;-tween_states(mylist,tweenlength=1,statelength=2, ease=rep(&#39;cubic-in-out&#39;,20), nframes=210)
tween.df$country.etc&lt;-as.character(tween.df$country.etc)

oopt = ani.options(interval = 0.1)
saveGIF({for (i in 1:max(tween.df$.frame)) {
  g&lt;-myplot(tween.df[i,])
  print(g)
  print(i)
  ani.pause()
}
},movie.name=&quot;TX map tween.gif&quot;,ani.width = 600, ani.height =600)</code></pre>
<p><img src="{{ site.url }}/img/charts_dec_19_2016/TX map tween.gif" alt="TX metros move!"/></p>
<div id="extend-the-example" class="section level3">
<h3>Extend the example</h3>
<p>That’s enough for now, but perhaps in future we can extend these examples.</p>
</div>
</div>

  
  <h4><i class="fas fa-share-alt" aria-hidden="true"></i>&nbsp;Share!</h4>
<ul class="share-buttons">
	<li><a href="https://twitter.com/intent/tweet?url=http%3a%2f%2flenkiefer.com%2f2016%2f12%2f19%2fmore-tweenr-housing%2f" target="_blank" title="Tweet"><i class="fab fa-twitter" aria-hidden="true"></i><span class="sr-only">Tweet</span></a>
	</li>
</ul>


<style>
	ul.share-buttons{
	  list-style: none;
	  padding: 0;
	}

	ul.share-buttons li{
	  display: inline;
	}

	ul.share-buttons .sr-only{
	  position: absolute;
	  clip: rect(1px 1px 1px 1px);
	  clip: rect(1px, 1px, 1px, 1px);
	  padding: 0;
	  border: 0;
	  height: 1px;
	  width: 1px;
	  overflow: hidden;
	}
</style>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="http://lenkiefer.com/2016/12/18/even-more-mortgage-rate-visualizations/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="http://lenkiefer.com/2016/12/18/even-more-mortgage-rate-visualizations/">Even more mortgage rate visualizations</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="http://lenkiefer.com/2016/12/23/populous-metros-are-heavy/">Populous metros are heavy!</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="http://lenkiefer.com/2016/12/23/populous-metros-are-heavy/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>


  
  
  
  

  

</div>

</div>
</div>
<script src="http://lenkiefer.com/js/ui.js"></script>
<script src="http://lenkiefer.com/js/menus.js"></script>




<script>
  
  if (window.location.hostname != "localhost") {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-66905937-1', 'auto');
    ga('send', 'pageview');
  }
</script>





<script src="http://lenkiefer.com/js/math-code.js"></script>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  


</body>
</html>

