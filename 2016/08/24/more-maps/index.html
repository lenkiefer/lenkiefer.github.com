<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.81.0" />

  <title>More map visualizations &middot; Len Kiefer</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="http://lenkiefer.com/img/favicon.PNG" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="/">Len Kiefer</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/post/"><i class='fa fa-list fa-fw'></i>Archive</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/@lenkiefer" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/leonard-kiefer-51175331" target="_blank"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/lenkiefer" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2015-2018. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


       <meta name="twitter:card" content="summary">
       <meta name="twitter:image" content="http://lenkiefer.com/img/logo/logo.png" >
    
    <meta property="og:title" content="More map visualizations">
    <meta property="og:description" content="IN THIS POST I&rsquo;M JUST GOING TO share a few data visualizations I&rsquo;ve been working on today. For most, no code, but these build off my previous posts here and here so you can check there for hints and I&rsquo;ll post some more examples with code later.
Population maps This one shows the evolution of population by county without the distribution plots I included last time. We discussed these data in our last post.">

<div class="header">
  <h1>More map visualizations</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>2016/08/24</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="http://lenkiefer.com/tags/dataviz">dataviz</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="http://lenkiefer.com/tags/maps">maps</a>
    
  </div>
  
  

</div>

  <p>IN THIS POST I&rsquo;M JUST GOING TO share a few data visualizations I&rsquo;ve been working on today. For most, no code, but  these build off my previous posts <a href="../../../../2016/08/21/maps-mortgages-and-me">here</a> and <a href="../../../../2016/08/23/US-pop-map-1790-2010">here</a> so you can check there for hints and I&rsquo;ll post some more examples with code later.</p>
<h1 id="population-maps">Population maps</h1>
<p>This one shows the evolution of population by county without the distribution plots I included last time. We discussed <a href="http://conservancy.umn.edu/handle/11299/181605">these data</a> in our <a href="../../../../2016/08/23/US-pop-map-1790-2010">last post</a>.</p>
<!-- raw HTML omitted -->
<p>In this second post I combined the population map with a dot chart showing the evolution of state population.</p>
<!-- raw HTML omitted -->
<h1 id="house-price-charts">House price charts</h1>
<p>This chart combines a map with sparkline-type line charts showing the evolution of annual percentage changes in the FHFA Purchase-Only <a href="http://www.fhfa.gov/DataTools/Downloads/pages/house-price-index.aspx">House Price Index</a>.</p>
<!-- raw HTML omitted -->
<p>Because the house price data is conveniently available in a text file from the FHFA webpage we can easily construct a static version of this chart (with just the map) using the code below.</p>
<p>{% highlight r 
#load some libraries
library(data.table)
library(reshape2)
library(stringr)
library(ggplot2)
library(scales)
library(ggthemes)
library(rgeos)
library(maptools)
library(albersusa)
library(dplyr)
library(tidyr)
library(ggalt)
library(viridis)
library(zoo)</p>
<p>#read in data available as a text file from the FHFA website:
fhfa.data&lt;-fread(&ldquo;<a href="http://www.fhfa.gov/DataTools/Downloads/Documents/HPI/HPI_PO_state.txt%22">http://www.fhfa.gov/DataTools/Downloads/Documents/HPI/HPI_PO_state.txt&quot;</a>)
#create annual house price growth in the SA index:
fhfa.data[,hpa12:=index_sa/shift(index_sa,4)-1,by=state]
fhfa.data[,iso_3166_2:=state]  #rename state to match usa_composite
fhfa.data[,date:=as.Date(ISOdate(yr,qtr*3,1))] #make a date (don&rsquo;t need it here)
fhfa.data[,mylabel:=paste0(&ldquo;Q&rdquo;,qtr,&quot;:&quot;,yr)]  #create date label for plot
#do map stuff
states&lt;-usa_composite()
smap&lt;-fortify(states,region=&ldquo;fips_state&rdquo;)
states@data &lt;- left_join(states@data, fhfa.data, by = &ldquo;iso_3166_2&rdquo;)</p>
<p>#make plots:
ggplot() +
geom_map(data = smap, map = smap,
aes(x = long, y = lat, map_id = id),
color = &ldquo;#2b2b2b&rdquo;, size = 0.05, fill = NA) +
geom_map(data =subset(states@data,yr&gt;2004 &amp; qtr==2), map = smap,
aes( map_id = fips_state,fill=hpa12),
color = &ldquo;gray&rdquo;, size = .25) +
theme_map( base_size = 12) +facet_wrap(~mylabel,ncol=3)+
theme(plot.title=element_text( size = 16, margin=margin(b=10))) +
theme(plot.subtitle=element_text(size = 14, margin=margin(b=-20))) +
theme(plot.caption=element_text(size = 9, margin=margin(t=-15))) +
coord_proj(us_laea_proj) +   labs(title=&quot;&quot;,subtitle=&rdquo;&quot; ) +
scale_fill_viridis(name = &ldquo;&rdquo;, discrete=F,option=&ldquo;D&rdquo;,end=0.95,
direction=-1,limits=c(-0.35,0.35),label=percent)+
theme(legend.position = &ldquo;top&rdquo;) +theme(plot.caption=element_text(hjust=0,vjust=1,margin=margin(t=10)))+
labs(title=paste0(&ldquo;Annual House Price Growth (Y/Y %)&quot;),
caption=&quot;@lenkiefer Source: FHFA Purchase-Only House Price Index (SA)&quot;)
{% endhighlight</p>
<p><img src="/img/Rfig/fig-mymap-1-1.svg" alt="plot of chunk fig-mymap-1"></p>
<p>We use a small multiple to show how annual percentage gains in house prices have varied from the second quarter of 2005 through the latest data for the second quarter of 2016.  The map part of the gif just morphs between facets of the plot above.</p>
<p>We can also construct a static version of the sparklines fairly easily:</p>
<p>{% highlight r 
mygraph.data&lt;-subset(states@data,(yr&gt;2004 &amp; state !=&ldquo;DC&rdquo;))</p>
<p>ggplot(data=mygraph.data,aes(x=date,y=hpa12,group=state))+theme_minimal()+
geom_line()+<br>
scale_color_viridis(name = &ldquo;Annual House Price Growth (Y/Y %)&rdquo;, discrete=F,option=&ldquo;D&rdquo;,end=0.95)+
scale_y_continuous(label=percent, breaks=c(-.2,-.1,0,.1,.2))+
theme(axis.text.y=element_text(size=6))+
theme(axis.text.x=element_text(size=6))+
geom_area(fill=viridis(5)[3],alpha=0.5)+  #add shading to make seeing +/- Zero easier
scale_x_date()+
geom_point(data=subset(mygraph.data,date==max(mygraph.data$date)),
aes(color=hpa12),alpha=0.75,size=2)+ 
theme(legend.position = &ldquo;none&rdquo;)+  facet_wrap(~state,ncol=10)+
theme(plot.caption=element_text(hjust=0))+
labs(x=&quot;&quot;,y=&quot;&quot;,title=&ldquo;Annual House Price Growth (Y/Y %)&rdquo;,
caption=&quot;@lenkiefer Source: FHFA Purchase-Only House Price Index (SA)&quot;)
{% endhighlight</p>
<p><img src="/img/Rfig/fig-mygraph-1-1.svg" alt="plot of chunk fig-mygraph-1"></p>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="http://lenkiefer.com/2016/08/23/us-pop-map-1790-2010/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="http://lenkiefer.com/2016/08/23/us-pop-map-1790-2010/">U.S. county population: 1790-2010</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="http://lenkiefer.com/2016/08/26/more-on-pop-distribution/">Density squared</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="http://lenkiefer.com/2016/08/26/more-on-pop-distribution/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  

</div>
<footer class="post-footer clearfix">
    
        <p class="post-tags">
            <span>Tagged:</span>
            
            
                <a href="/tags/dataviz/">dataviz</a>, 
            
                <a href="/tags/maps/">maps</a>
            
        </p>
    

    <div class="share">
        
            <a class="icon-twitter" href="https://twitter.com/share?url=http://lenkiefer.comhttp%3a%2f%2flenkiefer.com%2f2016%2f08%2f24%2fmore-maps%2f&text=More%20map%20visualizations via %40lenkiefer"
                onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fa fa-twitter"></i>
                <span class="hidden">Twitter</span>
            </a>
        

        
            <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://lenkiefer.comhttp%3a%2f%2flenkiefer.com%2f2016%2f08%2f24%2fmore-maps%2f"
                onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                <i class="fa fa-facebook"></i>
                <span class="hidden">Facebook</span>
            </a>
        


        
    </div>
</footer>
</div>
</div>
<script src="http://lenkiefer.com/js/ui.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66905937-1', 'auto');
  ga('send', 'pageview');

</script>






</body>
</html>

