<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.27.1" />

  <title>Recent economic and housing market trends: August 2016 &middot; Len Kiefer</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="/img/favicon.PNG" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="/">Len Kiefer</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/post/"><i class='fa fa-list fa-fw'></i>Archive</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/@lenkiefer" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/leonard-kiefer-51175331" target="_blank"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/lenkiefer" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2015-2018. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


       <meta name="twitter:card" content="summary">
       <meta name="twitter:image" content="http://lenkiefer.com/img/logo/logo.png" >
    
    <meta property="og:title" content="Recent economic and housing market trends: August 2016">
    <meta property="og:description" content=".col2 { columns: 2 200px; /* number of columns and width in pixels*/ -webkit-columns: 2 200px; /* chrome, safari */ -moz-columns: 2 200px; /* firefox */ } .col3 { columns: 3 100px; -webkit-columns: 3 100px; -moz-columns: 3 100px; }  IN THIS POST WE&rsquo;LL REVIEW some recent economic and housing market trends. R code for graphs posted below
Low mortgage rates Mortgage rates remain low, with the 30-year fixed mortgage averaging 3.">

<div class="header">
  <h1>Recent economic and housing market trends: August 2016</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>2016/08/27</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="/tags/dataviz">dataviz</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/economy">economy</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/r">R</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/housing">housing</a>
    
  </div>
  
  

</div>

  

<style>
  .col2 {
    columns: 2 200px;         /* number of columns and width in pixels*/
    -webkit-columns: 2 200px; /* chrome, safari */
    -moz-columns: 2 200px;    /* firefox */
  }
  .col3 {
    columns: 3 100px;
    -webkit-columns: 3 100px;
    -moz-columns: 3 100px;
  }
</style>

<p>IN THIS POST WE&rsquo;LL REVIEW some recent economic and housing market trends.  <em>R code for graphs posted below</em></p>

<h2 id="low-mortgage-rates">Low mortgage rates</h2>

<p>Mortgage rates remain low, with the 30-year fixed mortgage averaging 3.43 percent for the week of <sup>8</sup>&frasl;<sub>25</sub>. That&rsquo;s nine consecutive weeks with rates under 3.5 percent. Ever since <a href="../../../../2016/06/26/week-in-review">Brexit</a>.</p>

<p>One way I like to look at rates is to compare the weekly rates by week of year (e.g. first week of 2016 compared to first week of 2015). The second chart below shows the weekly comparison for 2013, 2014, 2015 and 2016. By comparing the lines you can see where rates were 1-year, 2-year, and 3-years ago.</p>

<p><img src="/img/Rfig/fig-chartbk-1-aug-2016-1.svg" alt="plot of chunk fig-chartbk-1-aug-2016" /></p>

<table class='gmisc_table' style='border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;' >
<thead>
<tr><td colspan='2' style='text-align: left;'>
30-year fixed mortgage rates since Brexit</td></tr>
<tr>
<th style='border-bottom: 1px solid grey; border-top: 2px solid grey;'> </th>
<th style='border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;'>30-year FRM</th>
</tr>
</thead>
<tbody>
<tr>
<td style='text-align: left;'>June 23, 2016</td>
<td style='text-align: center;'>3.56</td>
</tr>
<tr style='background-color: #f7f7f7;'>
<td style='background-color: #f7f7f7; text-align: left;'>June 30, 2016</td>
<td style='background-color: #f7f7f7; text-align: center;'>3.48</td>
</tr>
<tr>
<td style='text-align: left;'>July 07, 2016</td>
<td style='text-align: center;'>3.41</td>
</tr>
<tr style='background-color: #f7f7f7;'>
<td style='background-color: #f7f7f7; text-align: left;'>July 14, 2016</td>
<td style='background-color: #f7f7f7; text-align: center;'>3.42</td>
</tr>
<tr>
<td style='text-align: left;'>July 21, 2016</td>
<td style='text-align: center;'>3.45</td>
</tr>
<tr style='background-color: #f7f7f7;'>
<td style='background-color: #f7f7f7; text-align: left;'>July 28, 2016</td>
<td style='background-color: #f7f7f7; text-align: center;'>3.48</td>
</tr>
<tr>
<td style='text-align: left;'>August 04, 2016</td>
<td style='text-align: center;'>3.43</td>
</tr>
<tr style='background-color: #f7f7f7;'>
<td style='background-color: #f7f7f7; text-align: left;'>August 11, 2016</td>
<td style='background-color: #f7f7f7; text-align: center;'>3.45</td>
</tr>
<tr>
<td style='text-align: left;'>August 18, 2016</td>
<td style='text-align: center;'>3.43</td>
</tr>
<tr style='background-color: #f7f7f7;'>
<td style='background-color: #f7f7f7; border-bottom: 2px solid grey; text-align: left;'>August 25, 2016</td>
<td style='background-color: #f7f7f7; border-bottom: 2px solid grey; text-align: center;'>3.43</td>
</tr>
</tbody>
<tfoot><tr><td colspan='2'>
Source: Freddie Mac Primary Mortgage Market Survey</td></tr></tfoot>
</table>

<h2 id="gdp-growth">GDP growth</h2>

<p>On Friday, the Bureau of Economic Analysis <a href="http://www.bea.gov/newsreleases/national/gdp/gdpnewsrelease.htm">released</a> &ldquo;second&rdquo; <a href="http://www.bea.gov/national/pdf/revision_information/relia.pdf">estimates</a> of Gross Domestic Product for the second quarter of 2016.</p>

<p>The growth estimates were revised down slightly, from the advance estimate of 1.2 percent growth to the second estimate of 1.1 percent. Outside of consumption, other expenditure categories remain subdued and are adding very little growth. The two charts below compare the contributions to growth across categories.</p>

<p><img src="/img/Rfig/fig-chartbk-3-aug-2016-1.svg" alt="plot of chunk fig-chartbk-3-aug-2016" /><img src="/img/Rfig/fig-chartbk-3-aug-2016-2.svg" alt="plot of chunk fig-chartbk-3-aug-2016" /></p>

<p>We also can include an animated gif of the bar chart to see how contributions to GDP growth from different components have varied over time. Outside of consumption not a lot of sources of growth in recent years.</p>

<p><img src="../../../../img/charts_aug_27_2016/gdp_cont 2016Q2.gif" alt="GDP contributions gif"/></p>

<h2 id="home-sales-on-track-for-best-year-in-a-decade">Home sales on track for best year in a decade</h2>

<p>Home sales data were mixed, with <a href="https://www.census.gov/construction/nrs/pdf/newressales.pdf">new home sales</a> rising 12 percent from June at an annual rate, and <a href="http://www.realtor.org/news-releases/2016/08/existing-home-sales-lose-steam-in-july">existing home sales</a> declining 3.2 percent.</p>

<p><img src="/img/Rfig/fig-chartbk-sales-aug-2016-1.svg" alt="plot of chunk fig-chartbk-sales-aug-2016" /><img src="/img/Rfig/fig-chartbk-sales-aug-2016-2.svg" alt="plot of chunk fig-chartbk-sales-aug-2016" /></p>

<p>Despite the seasonally-adjusted month-over-month decline of 3.2 percent in July, year-to-date existing home sales in 2016 are at the highest level in decade.</p>

<p>And here&rsquo;s an animated gif of home sales.</p>

<p><img src="../../../../img/charts_aug_27_2016/ehs ytd july 2016.gif" alt="EHS gif"/></p>

<h2 id="housing-starts-trend-higher">Housing starts trend higher</h2>

<p>Housing starts also beat expectations <a href="https://www.census.gov/construction/nrc/pdf/newresconst.pdf">last week</a> rising to 1.21 Million units at a seasonally-adjusted annual rate.  Much of the movement was due to multifamily starts which can be noisy.  The chart below shows the monthly starts data and includes the confidence interval based on sampling uncertainty.</p>

<p><img src="/img/Rfig/fig-chartbk-starts-aug-2016-1.svg" alt="plot of chunk fig-chartbk-starts-aug-2016" /></p>

<h2 id="house-prices">House prices</h2>

<p>I&rsquo;ve looked at house prices in a variety of ways. <a href="../../../../2016/05/08/visual-meditations-on-house-prices"><em>(see my series of visual meditations)</em></a></p>

<p>Here let&rsquo;s look at <a href="http://www.fhfa.gov/Media/PublicAffairs/Pages/US-House-Prices-Rise-1pt2-Percent-in-Second-Quarter-Some-Signs-of-Deceleration.aspx">recently released</a> FHFA house price index.</p>

<p><img src="/img/Rfig/fig-chartbk-fhfa-viz-aug-2016-1.svg" alt="plot of chunk fig-chartbk-fhfa-viz-aug-2016" /></p>

<p>This chart has a lot of information. The panel on the left shows both the level of house prices in the second quarter of 2016 and the past year&rsquo;s history. The like segment displays the range of values the house price index has taken over the past four quarters. The longer the segment the more house prices have increased.</p>

<p>I&rsquo;ve double encoded rate of increase in house prices with both segment length and color. The color which has the same scale in both panels, shows the rate at which prices have increased over the past 4 quarters. The darker purple the more price have increased (and also the longer the segment will tend to be).</p>

<p>But you can also get a sense of the long term pattern in house prices by the location of the dot on the chart. The further to the right, the more house prices have increased relative to their level in the first quarter of 2001. The District of Columbia has an index value of nearly 400, which means prices have risen almost 4 times (not inflation-adjusted) in the District since early 2001.</p>

<p>Animation is also useful for this chart. In the gif below I transition between each quarter from 2001 through the latest data for the second quarter of 2016. <em>Note: I&rsquo;ve capped house price growth color scale at +/- 20%, so price growth either above or below that will be encoded with the darkest/lightest color in the graph/map. Some states experienced price increases or decreases of over 30 percent on a year-over-year basis in the FHFA Purchase-Only House Price Index data between 2001 and 2016.</em></p>

<p><img src="../../../../img/charts_aug_27_2016/fhfa hpa3.gif" alt="FHFA HPI gif"/></p>

<h1 id="r-code">R code</h1>

<p>I made these charts using <a href="https://www.r-project.org/">R</a>.  Code for the creation of these charts can be found below.  Check back later for more!</p>

<h2 id="data">Data</h2>

<p>With the exception of the house price data, which I download directly from the FHFA <a href="http://www.fhfa.gov/DataTools/Downloads/Pages/House-Price-Index-Datasets.aspx">webpage</a>, I&rsquo;ve kept the data in an <span class="icon-file-excel" style="color:green;"></span> Excel workbook.</p>

<p>You can search for code in the block beclow using the following:</p>

<table>
<thead>
<tr>
<th>Graph</th>
<th>Search for:</th>
</tr>
</thead>

<tbody>
<tr>
<td>Mortgage Rates</td>
<td>@mrtg</td>
</tr>

<tr>
<td>GDP</td>
<td>@gdp</td>
</tr>

<tr>
<td>Home Sales</td>
<td>@sales</td>
</tr>

<tr>
<td>Housing Starts</td>
<td>@starts</td>
</tr>

<tr>
<td>House Prices</td>
<td>@price</td>
</tr>
</tbody>
</table>

<p>{% highlight r</p>

<h2 id="load-required-libraries">load required libraries</h2>

<p>library(data.table)
library(reshape2)
library(stringr)
library(ggplot2)
library(scales)
library(ggthemes)
library(rgeos)
library(maptools)
library(albersusa)
library(dplyr)
library(tidyr)
library(ggalt)
library(viridis)
library(zoo)
library(readxl)
library(htmlTable)
library(animation)
library(tweenr)</p>

<h1 id="function-for-combining-graphs-see-http-www-cookbook-r-com-graphs-multiple-graphs-on-one-page-ggplot2">function for combining graphs see: <a href="http://www.cookbook-r.com/Graphs/Multiple_graphs_on_one_page_(ggplot2)/">http://www.cookbook-r.com/Graphs/Multiple_graphs_on_one_page_(ggplot2)/</a></h1>

<p>source(&lsquo;code/multiplot.R&rsquo;)</p>

<h1 id="source-code-for-recession-bars-see-https-www-r-bloggers-com-use-geom-rect-to-add-recession-bars-to-your-time-series-plots-rstats-ggplot">source code for recession bars see: <a href="https://www.r-bloggers.com/use-geom_rect-to-add-recession-bars-to-your-time-series-plots-rstats-ggplot/">https://www.r-bloggers.com/use-geom_rect-to-add-recession-bars-to-your-time-series-plots-rstats-ggplot/</a></h1>

<p>source(&ldquo;code/recessions.R&rdquo;)</p>

<h6 id="mortgage-rate-charts-mrtg">Mortgage rate charts @mrtg</h6>

<h1 id="read-in-data-for-mortgage-rate-charts">Read in data for mortgage rate charts:</h1>

<p>mdata&lt;-read_excel(&ldquo;data/chartbook aug 2016.xlsx&rdquo;,sheet=&ldquo;mrate&rdquo;)
mdata$date&lt;-as.Date(mdata$date, format=&ldquo;%m/%d/%Y&rdquo;)
mdata&lt;-data.table(mdata)</p>

<p>print.table&lt;-data.table(mdata)[date&gt;as.Date(&ldquo;2016-06-22&rdquo;),
                               list(date=as.character(date,format=&ldquo;%B %d, %Y&rdquo;),
                                    rate=format(rate, nsmall = 2))]</p>

<p>rownames(print.table)&lt;-print.table$date
print.table$date&lt;-NULL
htmlTable(print.table, header=c(&ldquo;30-year FRM&rdquo;),
          row.names=print.table$date,row.label=&ldquo;Date&rdquo;,
          col.rgroup = c(&ldquo;none&rdquo;, &ldquo;#F7F7F7&rdquo;),caption=&ldquo;30-year fixed mortgage rates since Brexit&rdquo;,
          tfoot=&ldquo;Source: Freddie Mac Primary Mortgage Market Survey&rdquo;)</p>

<p>pmms1&lt;-
  ggplot(data=mdata[year(date)&gt;=2013, ], aes(x=date,y=rate,label=rate))+geom_line(size=1.1)+theme_minimal()+
  theme(legend.position=&ldquo;none&rdquo;)+
  scale_x_date()+
  scale_y_continuous(limits=c(3,4.75),breaks=seq(3,4.75,.25))+
  geom_text(data=mdata[date&gt;=&lsquo;2015-12-31&rsquo; &amp; week==i],nudge_y=-.050,hjust=0,size=3)+
  geom_point(data=mdata[date&gt;=&lsquo;2015-12-31&rsquo; &amp; week==i],size=2,color=&ldquo;red&rdquo;,alpha=0.75)+
  labs(x=&ldquo;&rdquo;, y=&ldquo;Mortgage Rate (%)&rdquo;,
       title=&ldquo;30-year Fixed Mortgage Rate (%)&rdquo;,
       subtitle=&ldquo;&rdquo;,
       caption=&ldquo;@lenkiefer Source: Freddie Mac Primary Mortgage Market Survey&rdquo;)+
  theme(plot.title=element_text(size=12))+
  theme(plot.subtitle=element_text(size=10))+
  theme(axis.title=element_text(size=8))+
  theme(axis.text=element_text(size=8))+
  theme(plot.caption=element_text(hjust=0,vjust=1,margin=margin(t=10)))+
  theme(plot.margin=unit(c(0.25,0.25,0.25,0.25),&ldquo;cm&rdquo;))+
  coord_cartesian(xlim=c(as.Date(&ldquo;2012-12-31&rdquo;),as.Date(&ldquo;2016-10-31&rdquo;)), y=c(3.25,4.75))</p>

<p>pmms2&lt;-<br />
  ggplot(data=mdata[year&gt;2012 &amp; week&lt;=i],
         aes(x=week,y=rate,label=paste(&rdquo;   &ldquo;,year),color=as.factor(year)))+
  geom_line(size=1.1)+theme_minimal()+
  scale_color_viridis(discrete=T,direction=-1,end=0.85)+
  theme(legend.position=&ldquo;none&rdquo;)+
  scale_x_continuous(limits=c(0,38))+
  scale_y_continuous(limits=c(3.25,4.75),breaks=seq(3.25,4.5,0.25))+
  geom_text(data=mdata[year&gt;2012 &amp; week==i],size=3,hjust=0)+
  geom_point(data=mdata[year&gt;2012 &amp; week==i],size=3,alpha=0.75)+
  labs(x=&ldquo;Week of year&rdquo;, y=&ldquo;Mortgage Rate (%)&rdquo;,
       title=&ldquo;30-year Fixed Mortgage Rate by Week&rdquo;,
       subtitle=&ldquo;comparing 2013, 2014, 2015 and 2016&rdquo;,
       caption=&ldquo;&rdquo;)+
  theme(plot.title=element_text(size=12))+
  theme(plot.subtitle=element_text(size=10))+
  theme(axis.title=element_text(size=8))+
  theme(axis.text=element_text(size=8))+
  theme(plot.caption=element_text(hjust=0,vjust=1,margin=margin(t=10)))+
  theme(plot.margin=unit(c(0.25,0.25,0.25,0.25),&ldquo;cm&rdquo;))</p>

<p>#combine charts:
multiplot(pmms1,pmms2,cols=2)</p>

<h6 id="gdp-contributions-charts-gdp">GDP contributions Charts @gdp</h6>

<p>gdata&lt;-data.table(read_excel(&ldquo;data/chartbook aug 2016.xlsx&rdquo;,sheet=&ldquo;gdpc&rdquo;))
gdata$date&lt;-as.Date(gdata$date, format=&ldquo;%m/%d/%Y&rdquo;)</p>

<p>gdata[, avgc:=mean(value), by=var]
gdata&lt;-gdata[order(date,avgc),]
gdata[Total !=&ldquo;total&rdquo;, end:=cumsum(value), by=date]
gdata[Total==&ldquo;total&rdquo;, end:=0, by=date]
gdata[,start:=shift(end,1,fill=0), by=date]
gdata[,id:=.I]
gdata[,id:=1:.N,,by=date]
gdata[, myjust:=ifelse(value&lt;0,1,0)]
gdata[, lp:=ifelse(Total==&ldquo;total&rdquo;,start,end)]
gdata[,dlabel:=factor(paste(year,&ldquo;Q&rdquo;,quarter,sep=&ldquo;&rdquo;))]
gdata[,cont:=factor(cont)]
gdata[,var:=factor(var)]</p>

<p>gdata$var&lt;-factor(gdata$var, levels=gdata$var[order(gdata$avgc)])</p>

<p>gdata.plot&lt;-gdata[year==2016]
gdata.plot[,date.label:=paste0(year,&ldquo;Q&rdquo;,quarter)]</p>

<p>ggplot(data=gdata.plot, aes(x=var, y=lp,fill = cont,label=value)) +
  geom_rect(aes(x = var, xmin = id - 0.45, xmax = id + 0.45, ymin = end,ymax = start))  +
  theme_minimal()+coord_flip()+<br />
  geom_text(data=gdata.plot,aes(hjust=myjust) )+
  labs(title=&ldquo;Contributions to Percent Change in Real Gross Domestic Product&rdquo;,x=&ldquo;&rdquo;,y=&ldquo;&rdquo;,
       subtitle=&ldquo;Seasonally adjusted at annual rates&rdquo;,
       caption=&ldquo;@lenkiefer Source: U.S. Bureau of Economic Analysis, Table 1.1.2, accessed 8/26/2016.&ldquo;)+
  scale_fill_manual(name=&ldquo;&rdquo;,values=c(&ldquo;red&rdquo;,&ldquo;lightblue&rdquo;,&ldquo;gray&rdquo;))+
  theme(plot.title=element_text(size=12))+
  scale_y_continuous(limits=c(-3,3))+
  #geom_text(data=gdata.plot[cont==&ldquo;total&rdquo;] ,aes(y=0,x=7.25,label=dlabel),hjust=0,size=4,fontface=&ldquo;bold&rdquo;)  +
  theme(plot.caption=element_text(hjust=0,vjust=1,margin=margin(t=10),size=10))+
  theme(legend.justification=c(0,0), legend.position=&ldquo;none&rdquo;)+facet_wrap(~date.label)</p>

<h2 id="make-animated-gif">Make animated gif</h2>

<p>myd&lt;-unique(gdata[year&gt;=2008]$date)
myf&lt;-function(d){as.data.frame(gdata[date==d, list(date,end,start,id,myjust,lp,var,cont,value,dlabel,year,avgc)])}
pdatag&lt;-myf(myd[2])
pdatag&lt;-data.table(pdatag)</p>

<h1 id="use-lapply-to-generate-the-list-of-data-sets">use lapply to generate the list of data sets:</h1>

<p>my.list&lt;-lapply(c(myd,tail(myd,1),tail(myd,1),tail(myd,1),tail(myd,1)),myf)</p>

<h1 id="apply-tweenr">apply tweenr</h1>

<p>tf &lt;- tween_states(my.list, tweenlength= 2, statelength=1, ease=rep(&lsquo;cubic-in-out&rsquo;,64),nframes=250)</p>

<h1 id="convert-variable-lables-to-factor-and-order-by-average-contribution-so-they-go-from-big-to-small">convert variable lables to factor, and order by average contribution so they go from big to small</h1>

<p>tf$var&lt;-factor(tf$var, levels=tf$var[order(tf$avgc)])
#conver to data table
tf&lt;-data.table(tf)</p>

<p>p&lt;-
  ggplot(data=tf, aes(x=var, y=lp,fill = cont,label=value,frame=.frame)) +
  geom_rect(aes(x = var, xmin = id - 0.45, xmax = id + 0.45, ymin = end,ymax = start))  +
  theme_minimal()+coord_flip()+   geom_text(data=tf[date %in% myd , ] ,hjust=tf[date %in% myd , ]$myjust)+
  labs(title=&ldquo;Contributions to Percent Change in Real Gross Domestic Product&rdquo;,x=&ldquo;&rdquo;,y=&ldquo;&rdquo;,
       subtitle=&ldquo;Seasonally adjusted at annual rates&rdquo;,
       caption=&ldquo;@lenkiefer Source: U.S. Bureau of Economic Analysis, Table 1.1.2, accessed 8/26/2016.&ldquo;)+
  scale_fill_manual(name=&ldquo;&rdquo;,values=c(&ldquo;red&rdquo;,&ldquo;lightblue&rdquo;,&ldquo;gray&rdquo;))+
  theme(plot.title=element_text(size=12))+
  geom_text(data=tf[cont==&ldquo;total&rdquo; ,  ] ,aes(y=0,x=7.25,label=dlabel),hjust=0,size=4,fontface=&ldquo;bold&rdquo;)  +
  theme(plot.caption=element_text(hjust=0,vjust=1,margin=margin(t=10),size=10))+
  theme(legend.justification=c(0,0), legend.position=&ldquo;none&rdquo;)</p>

<p>gg_animate(p, &ldquo;contributions to gdp 2016q2.gif&rdquo;, title_frame = F, ani.width = 740,
           ani.height = 550, interval=.1)</p>

<h4 id="gdp-contributions-time-series-gdp">GDP contributions time series @gdp</h4>

<p>ggplot(data=gdata[year&gt;1980 &amp; cont!=&ldquo;total&rdquo;,])+facet_wrap(~var)+
  theme_minimal()+ theme(plot.title=element_text(size=12))+
  scale_color_viridis(discrete=T,direction=-1,end=0.85)+
  theme(plot.caption=element_text(hjust=0,vjust=1,margin=margin(t=10),size=10))+
  theme(legend.justification=c(0,0), legend.position=&ldquo;none&rdquo;)+
  geom_rect(data=subset(recessions.df,Peak&gt;=&ldquo;1980-01-01&rdquo;),
            aes(xmin=Peak, xmax=Trough, ymin=-Inf, ymax=+Inf), fill=&ldquo;gray&rdquo;, alpha=0.35)+
  geom_line(aes(x=date,y=value,color=var),size=1.1)+
  labs(x=&ldquo;&rdquo;,y=&ldquo;&rdquo;,title=&ldquo;Contributions to Percent Change in Real Gross Domestic Product&rdquo;,
       subtitle=&ldquo;Seasonally adjusted at annual rates&rdquo;,
       caption=&ldquo;@lenkiefer Source: U.S. Bureau of Economic Analysis, Table 1.1.2, accessed 8/26/2016.\nShaded area NBER Recession dates&rdquo;)</p>

<h6 id="home-sales-charts-sales">Home sales charts @sales</h6>

<p>mydata&lt;-read_excel(&ldquo;data/chartbook aug 2016.xlsx&rdquo;,sheet=&ldquo;sales&rdquo;)
mydata$date&lt;-as.Date(mydata$date, format=&ldquo;%m/%d/%Y&rdquo;)</p>

<p>mydata$date&lt;-as.Date(mydata$date, format=&ldquo;%m/%d/%Y&rdquo;)
ggplot(data=mydata, aes(x=date,y=nhs.sa, label = nhs.sa))+geom_line(data=mydata)+
  scale_y_continuous(limits = c(200, 1600), breaks=seq(200,1600,200)) +
  geom_point(data=tail(mydata,1),colour = plasma(5)[1], size = 3)+
  scale_x_date(labels= date_format(&ldquo;%b-%Y&rdquo;), limits = as.Date(c(&lsquo;2000-01-01&rsquo;,&lsquo;2016-08-31&rsquo;))) +
  geom_ribbon(data=mydata,aes(x=date,ymin=down,ymax=up),fill=plasma(5)[5],alpha=0.5)  +
  geom_hline(yintercept=tail(mydata,1)$nhs.sa,linetype=2,color=plasma(5)[1])+
  theme(axis.title.x = element_blank()) +   # Remove x-axis label
  ylab(&ldquo;&rdquo;)+xlab(&ldquo;&rdquo;)+
  theme_minimal()+
  labs(x=NULL, y=NULL,
       title=&ldquo;New Home Sales (Ths. SAAR)&rdquo;,
       subtitle=paste(as.character(tail(mydata,1)$date,format=&ldquo;%b-%Y&rdquo;),&rdquo;:&ldquo;,tail(mydata,1)$nhs.sa),
       caption=&ldquo;@lenkiefer Source: Census/HUD, shaded area denotes confidence interval&rdquo;)+
  theme(plot.caption=element_text(hjust=0,vjust=1,margin=margin(t=10)))+
  theme(plot.subtitle=element_text(color=plasma(5)[1]))+
  theme(plot.margin=unit(c(0.5,0.5,0.5,0.75),&ldquo;cm&rdquo;))</p>

<p>mydata&lt;-data.table(mydata)<br />
mydata[, ehsc:=cumsum(ehs), by=year]  #computer cumulative sales YTD</p>

<p>#Make plot
ggplot(data=mydata[year&gt;2006 &amp; month&lt;8],
       aes(x = factor(year), y = ehs,fill=reorder(mname,month),label=mname)) +
  geom_bar(color = &ldquo;gray&rdquo;, stat = &ldquo;identity&rdquo;,alpha=0.75)+
  scale_fill_viridis(discrete=T,end=0.95,direction=1,option=&ldquo;D&rdquo;)+  #use viridis color scale
  theme_minimal()+
  geom_text(data=mydata[month==7 &amp; year==2016],aes(y=ehsc),nudge_y=0.25,hjust=-.2)+
  geom_hline(yintercept=mydata[ month==7 &amp; year==2016]$ehsc,linetype=2,color=&ldquo;black&rdquo;)+
  xlab(&ldquo;&rdquo;)+ylab(&ldquo;&rdquo;)+
  labs(title=&ldquo;Existing Home Sales (Ths. NSA)&rdquo;,
       subtitle=&ldquo;dotted line 2016 YTD&rdquo;,
       caption=&ldquo;@lenkiefer Source:NAR&rdquo;)+
  theme(plot.title=element_text(size=14))+
  theme(legend.justification=c(0,0), legend.position=&ldquo;none&rdquo;)+
  theme(plot.caption=element_text(hjust=0,vjust=1,margin=margin(t=10)))+
  theme(plot.margin=unit(c(0.25,0.25,0.25,0.25),&ldquo;cm&rdquo;))+
  coord_flip()  #flip so that the bars are horizontal rather than vertical</p>

<h2 id="make-animated-home-sales-chart">Make animated home sales chart:</h2>

<p>myf3&lt;-function(m){
  DT&lt;-copy(mydata)
  DT&lt;-DT[month&gt;m,ehs:=0]
  DT$mm&lt;-m
  DT %&gt;% map_if(is.character, as.factor) %&gt;% as.data.frame() -&gt;DT
  as.data.frame(DT)}</p>

<p>my.list3&lt;-lapply(c(seq(1,7,1),0),myf3)  #the animation will loop through each of the first five months of the year an then meet back at 0.
tf &lt;- tween_states(my.list3, tweenlength= 2, statelength=3, ease=rep(&lsquo;cubic-in-out&rsquo;,17),nframes=70)
tf&lt;-data.table(tf)</p>

<p>oopt = ani.options(interval = 0.125)
saveGIF({for (i in 1:max(tf$.frame)) {
  g&lt;-
    ggplot(data=tf[year&gt;2006 &amp; .frame==i &amp; month&lt;8], aes(x = factor(year), y = ehs,fill=reorder(mname,month),label=mname)) + geom_bar(color = &ldquo;gray&rdquo;, stat = &ldquo;identity&rdquo;,alpha=0.75)+
    scale_fill_viridis(discrete=T,end=0.95,direction=-1,option=&ldquo;D&rdquo;)+  #use viridis color scale
    theme_minimal()+
    geom_text(data=tf[month==mm&amp; year==2016 &amp; .frame==i],aes(y=ehsc),nudge_y=0.25,hjust=-.2)+
    geom_hline(yintercept=tf[.frame==i &amp; month==mm &amp; year==2016]$ehsc,linetype=2,color=&ldquo;black&rdquo;)+
    xlab(&ldquo;&rdquo;)+ylab(&ldquo;&rdquo;)+
    labs(title=&ldquo;Existing Home Sales (Ths. NSA)&rdquo;,
         subtitle=&ldquo;dotted line 2016 YTD&rdquo;,
         caption=&ldquo;@lenkiefer Source:NAR&rdquo;)+
    theme(plot.title=element_text(size=14))+
    theme(legend.justification=c(0,0), legend.position=&ldquo;none&rdquo;)+
    theme(plot.caption=element_text(hjust=0,vjust=1,margin=margin(t=10)))+
    theme(plot.margin=unit(c(0.25,0.25,0.25,0.25),&ldquo;cm&rdquo;))+</p>

<pre><code>scale_y_continuous(limits=c(0,3500),labels=comma)+coord_flip()
</code></pre>

<p>print(g)
  ani.pause()
}
},movie.name=&ldquo;ehs ytd july 2016.gif&rdquo;,ani.width = 600, ani.height = 450)</p>

<h6 id="housing-starts-starts">Housing starts @starts</h6>

<p>mydata&lt;-read_excel(&ldquo;data/chartbook aug 2016.xlsx&rdquo;,sheet=&ldquo;startserr&rdquo;)
mydata$date&lt;-as.Date(mydata$date, format=&ldquo;%m/%d/%Y&rdquo;)
mydata$sales&lt;-mydata$nsales
mydata$slabel&lt;-round(mydata$starts,0)
mydata$slabel2&lt;-round(mydata$hmi,0)
mydata&lt;-data.table(mydata)
ggplot(data=mydata, aes(x=date,y=starts, label = slabel))+geom_line(data=mydata)+
  scale_y_continuous(limits = c(400, 2300), breaks=seq(400,2300,200)) +
  geom_point(data=tail(mydata,2),colour = viridis(5)[1], size = 3)+
  scale_x_date(labels= date_format(&ldquo;%b-%Y&rdquo;),
               limits = as.Date(c(&lsquo;2000-01-01&rsquo;,&lsquo;2016-12-31&rsquo;))) +
  geom_ribbon(data=mydata,aes(x=date,ymin=down,ymax=up),fill=viridis(5)[5],alpha=0.5)  +
  coord_cartesian(xlim=as.Date(c(&lsquo;2000-01-01&rsquo;,&lsquo;2016-08-31&rsquo;)))+
  geom_hline(yintercept=tail(mydata,2)$starts,linetype=2,color=viridis(5)[5])+
  theme(axis.title.x = element_blank()) +   # Remove x-axis label
  ylab(&ldquo;&rdquo;)+xlab(&ldquo;&rdquo;)+
  theme_minimal()+
  labs(x=NULL, y=NULL,
       title=&ldquo;Housing Starts (Ths. SAAR)&rdquo;,
       #subtitle=paste(as.character(mydata$date[i],format=&ldquo;%b-%Y&rdquo;),&rdquo;:&ldquo;,tail(mydata$slabel[i]),
       caption=&ldquo;@lenkiefer Source: Census/HUD, shaded area denotes confidence interval&rdquo;)+
  theme(plot.caption=element_text(hjust=0,vjust=1,margin=margin(t=10)))+
  theme(plot.subtitle=element_text(color=plasma(5)[1]))+
  theme(plot.margin=unit(c(0.5,0.5,0.5,0.75),&ldquo;cm&rdquo;))</p>

<h6 id="house-price-chart-price">House price chart @price  ######</h6>

<p>#read data:
fhfa.data&lt;-fread(&ldquo;<a href="http://www.fhfa.gov/DataTools/Downloads/Documents/HPI/HPI_PO_state.txt&quot;">http://www.fhfa.gov/DataTools/Downloads/Documents/HPI/HPI_PO_state.txt&quot;</a>)</p>

<p>fhfa.data[,hpa12:=index_sa/shift(index_sa,4)-1,by=state]
fhfa.data[,lag4:=shift(index_sa,4)-1,by=state]</p>

<p>fhfa.data[,iso_3166_2:=state]
fhfa.data[,date:=as.Date(ISOdate(yr,qtr*3,1))]
fhfa.data[,map.color:=min(0.2,max(-0.2,hpa12)),by=list(state,date)]</p>

<p>#reset index so that Q1 2000 =100
b.data&lt;-fhfa.data[yr==2001 &amp; qtr==1,list(hpi00Q1=index_sa),by=state]</p>

<p>fhfa.data&lt;-merge(fhfa.data,b.data,by=&ldquo;state&rdquo;)
fhfa.data[,index_sa2:=100*index_sa/hpi00Q1]
fhfa.data[,max4:=rollapply(index_sa2,4,max,align=&ldquo;right&rdquo;,fill=NA),by=state]
fhfa.data[,min4:=rollapply(index_sa2,4,min,align=&ldquo;right&rdquo;,fill=NA),by=state]</p>

<p>states&lt;-usa_composite()
smap&lt;-fortify(states,region=&ldquo;fips_state&rdquo;)
smap.all&lt;-smap</p>

<p>states@data &lt;- left_join(states@data, fhfa.data, by = &ldquo;iso_3166_2&rdquo;)</p>

<h3 id="function-for-preparing-graph-data">Function for preparing graph data</h3>

<p>make_graph_data&lt;-function(d){
  yy&lt;-year(d)
  qq&lt;-quarter(d)
  start.date&lt;- as.Date(ISOdate(yy-2,qq*3,1) )
  end.date&lt;- as.Date(ISOdate(yy,qq*3,1) )
  mygraph.data&lt;-subset(fhfa.data,date==d)
  mygraph.data %&gt;% map_if(is.character, as.factor) %&gt;% as.data.frame() -&gt;mygraph.data<br />
  return(mygraph.data)
}</p>

<h3 id="function-for-creating-plot">Function for creating plot</h3>

<p>mycombo&lt;-function(indata){
  states&lt;-usa_composite()
  states@data &lt;- left_join(states@data, indata, by = &ldquo;iso_3166_2&rdquo;)
  d&lt;-max(indata$date)
  yy&lt;-year(d)
  qq&lt;-quarter(d)
map1&lt;-
    ggplot() +
    geom_map(data = smap.all, map = smap.all,
             aes(x = long, y = lat, map_id = id),
             color = &ldquo;#2b2b2b&rdquo;, size = 0.05, fill = NA) +
    geom_map(data =  states@data, map = smap.all,
             aes( map_id = fips_state,fill=map.color),
             color = &ldquo;gray&rdquo;, size = .25) +
    theme_map( base_size = 12) +
    theme(plot.title=element_text( size = 12, margin=margin(b=10))) +
    theme(plot.subtitle=element_text(size = 10, margin=margin(b=-20))) +
    theme(plot.caption=element_text(size = 9, margin=margin(t=-15))) +
    coord_proj(us_laea_proj) +   labs(title=&ldquo;&rdquo;,subtitle=&ldquo;&rdquo; ) +
    scale_fill_viridis(name = &ldquo; &ldquo;, discrete=F,option=&ldquo;C&rdquo;,end=1,
                       direction=-1,         limits=c(-0.2,0.2),label=percent)+
    theme(legend.position = &ldquo;top&rdquo;) +theme(plot.caption=element_text(hjust=0,vjust=1,margin=margin(t=10)))+
    labs(x=&ldquo;&rdquo;,y=&ldquo;&rdquo;,
         title=paste0(&ldquo;Annual House Price Growth (Y/Y %) Q&rdquo;,qq,&rdquo;:&ldquo;,yy),
         caption=&ldquo;@lenkiefer Source: FHFA Purchase-Only House Price Index (SA)&ldquo;)</p>

<p>graph1&lt;-
    ggplot(data=indata,aes(x=index_sa2,y=state,color=map.color))+geom_point(size=2)+
    theme_minimal()+ theme(legend.position = &ldquo;none&rdquo;) +
    scale_x_log10(breaks=c(100,150,200,300,400),limits=c(75,400))+
    scale_color_viridis(name = &ldquo;&rdquo;, discrete=F,option=&ldquo;C&rdquo;,end=1,
                        direction=-1,         limits=c(-0.2,0.2),label=percent)+
    geom_segment(aes(x=min4,xend=max4,y=state,yend=state),size=1.05,alpha=0.6)+  theme(axis.text=element_text(size=8))+
    labs(x=&ldquo;House Price Index\nlog scale,Q1:2001=100&rdquo;,y=&ldquo;&rdquo;,title=paste0(&ldquo;House Price Index Q&rdquo;,qq,&rdquo;:&ldquo;,yy),
         caption=&ldquo;dot is value, line 4 trailing quarter min/max&rdquo;)+
    theme(plot.caption=element_text(hjust=0,vjust=1,margin=margin(t=10)))</p>

<p>multiplot(graph1,map1,cols=2)
}</p>

<p>mycombo(make_graph_data(&ldquo;2016-06-01&rdquo;))</p>

<h4 id="make-the-animated-gif">Make the animated gif</h4>

<p>d.list&lt;-unique(subset(fhfa.data,yr&gt;2000)$date)</p>

<h1 id="d-list-unique-subset-fhfa-data-yr-2000-qtr-2-date-alternative-if-you-want-to-go-4-quarters-at-a-time">d.list&lt;-unique(subset(fhfa.data,yr&gt;2000 &amp; qtr==2)$date)  # alternative if you want to go 4 quarters at a time</h1>

<p>my.list&lt;-lapply(c(d.list,d.list[1]),make_graph_data)
tf &lt;- tween_states(my.list,tweenlength= 3, statelength=2, ease=rep(&lsquo;cubic-in-out&rsquo;,2),nframes=length(d.list)*8)
tf&lt;-data.table(tf) #data.table useful for subsetting
N&lt;-max(tf$.frame)  #number of frames</p>

<p>#create the animation
oopt = ani.options(interval = 0.15)
saveGIF({for (i in 1:N) {
  mycombo(tf[.frame==i])
  print(i)
  ani.pause()  }
},movie.name=&ldquo;fhfa hpa4.gif&rdquo;,ani.width = 800, ani.height = 450)
{% endhighlight</p>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="/2016/08/26/more-on-pop-distribution/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="/2016/08/26/more-on-pop-distribution/">Density squared</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="/2016/09/02/consumer-spend/">What we spend: Consumer Expenditures in 2015</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="/2016/09/02/consumer-spend/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  

</div>
<footer class="post-footer clearfix">
    
        <p class="post-tags">
            <span>Tagged:</span>
            
            
                <a href="/tags/dataviz/">dataviz</a>, 
            
                <a href="/tags/economy/">economy</a>, 
            
                <a href="/tags/r/">R</a>, 
            
                <a href="/tags/housing/">housing</a>
            
        </p>
    

    <div class="share">
        
            <a class="icon-twitter" href="https://twitter.com/share?url=http://lenkiefer.com%2f2016%2f08%2f27%2fhousing-market-update%2f&text=Recent%20economic%20and%20housing%20market%20trends%3a%20August%202016 via %40lenkiefer"
                onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fa fa-twitter"></i>
                <span class="hidden">Twitter</span>
            </a>
        

        
            <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://lenkiefer.com%2f2016%2f08%2f27%2fhousing-market-update%2f"
                onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                <i class="fa fa-facebook"></i>
                <span class="hidden">Facebook</span>
            </a>
        


        
    </div>
</footer>
</div>
</div>
<script src="/js/ui.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66905937-1', 'auto');
  ga('send', 'pageview');

</script>






</body>
</html>

